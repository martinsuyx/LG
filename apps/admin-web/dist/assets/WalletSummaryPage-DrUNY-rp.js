import{d as at,a as st,r as u,c as b,w as nt,o as ot,b as n,e as t,f as it,i as k,v as T,j as U,F as d,h as c,t as i,k as ut,n as j,m as D,p as rt,q as o,_ as dt}from"./index-DvtP9USg.js";import{E as ct}from"./ExportsService-BVSn6J7L.js";import{W as F}from"./WalletService-Clh4FYxu.js";import"./request-Bu45iIRO.js";const vt={class:"summary"},_t={class:"summary__head"},bt={class:"summary__actions"},mt=["disabled"],ft={class:"filters__group"},yt={class:"filters__row"},ht={class:"filters__field"},pt={class:"filters__field"},kt={class:"filters__field"},wt=["value"],gt={class:"filters__field"},St=["value"],Ct={class:"filters__actions"},Mt=["disabled"],xt=["disabled"],Dt={class:"kpis"},Ft={class:"kpi-card__label"},Ot={class:"kpi-card__value"},zt={class:"charts"},Wt={class:"chart-card"},Nt={class:"chart-card__head"},Vt={key:0,class:"chart"},Et={key:1,class:"chart"},It={class:"chart-card table-card"},Pt={class:"chart-card__head"},$t={key:0},Bt={key:1},Lt=["onClick"],Tt=["disabled"],Ut={key:2},jt={key:0,class:"feedback feedback--error"},qt={key:1,class:"feedback"},At=at({__name:"WalletSummaryPage",setup(Ht){const q=rt(),O=new Date,z=O.toISOString().slice(0,10),w=new Date(O);w.setDate(w.getDate()-6);const W=w.toISOString().slice(0,10),s=st({start:W,end:z,dimension:"platform",status:[]}),r=u(null),g=u(null),S=u(null),C=u([]),v=u(!1),_=u(""),m=u(""),y=u("balance"),N=[{value:"platform",label:"平台"},{value:"company",label:"公司"},{value:"team",label:"团队"},{value:"store",label:"门店"},{value:"promoter",label:"推广人"},{value:"individual",label:"个人"}],A=["normal","frozen","closed"],H=b(()=>{var e,l,a,x,B,L;return[{key:"total_balance",label:"总余额",value:((e=r.value)==null?void 0:e.total_balance)??0},{key:"frozen",label:"冻结金额",value:((l=r.value)==null?void 0:l.frozen)??0},{key:"available",label:"可用余额",value:((a=r.value)==null?void 0:a.available)??0},{key:"withdrawable",label:"可提现金额",value:((x=r.value)==null?void 0:x.withdrawable)??0},{key:"in_7d",label:"近7日入账",value:((B=r.value)==null?void 0:B.in_7d)??0},{key:"out_7d",label:"近7日出账",value:((L=r.value)==null?void 0:L.out_7d)??0}]}),V=b(()=>{var e;return((e=g.value)==null?void 0:e.points)??[]}),E=b(()=>{var e;return((e=S.value)==null?void 0:e.points)??[]}),R=b(()=>Math.max(...V.value.map(e=>e.balance??0),1)),I=b(()=>{const e=E.value.flatMap(l=>[l.inflow??0,l.outflow??0]);return Math.max(...e,1)}),Y=b(()=>{const e=N.find(l=>l.value===s.dimension);return e?e.label:s.dimension}),G=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY",minimumFractionDigits:2}),J=new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});function f(e){return e==null?"-":G.format(e)}function K(e){if(!e)return"-";try{return J.format(new Date(e))}catch{return e}}function M(e,l){return!e||l<=0?"0%":`${Math.round(e/l*100)}%`}function P(e){y.value=e,e==="balance"&&!g.value?h("balance"):e==="in_out"&&!S.value&&h("in_out")}function Q(){s.start=W,s.end=z,s.dimension="platform",s.status=[],p()}function X(){p()}function $(e,l="加载钱包摘要失败，请稍后再试。"){return e?e.includes("Failed to fetch")||e.includes("NetworkError")?"无法连接到钱包接口，请确认 Mock 服务已启动或网络可用。":e:l}async function Z(){m.value="",_.value="";try{await ct.exportWalletSummary(),m.value="已创建导出任务，请前往导出中心查看。"}catch(e){_.value=$(e==null?void 0:e.message,"导出失败，请稍后再试。")}}function tt(e){q.push({path:"/wallet/ledger",query:{dimension:s.dimension,entity_id:e.entity_id,entity_name:e.entity_name}})}async function et(){r.value=await F.getWalletSummaryOverview(s.start||void 0,s.end||void 0,s.dimension,void 0,void 0,s.status.length?s.status:void 0)}async function h(e){const l=await F.getWalletSummarySeries(s.start||void 0,s.end||void 0,s.dimension,e);e==="balance"?g.value=l:S.value=l}async function lt(){const e=await F.listWalletSummary(s.start||void 0,s.end||void 0,s.dimension,1,20,s.status.length?s.status:void 0);C.value=e.items??[]}async function p(){v.value=!0,_.value="",m.value="";try{await Promise.all([et(),h("balance"),h("in_out"),lt()])}catch(e){_.value=$(e==null?void 0:e.message)}finally{v.value=!1}}return nt(()=>[s.dimension,s.status.join(",")],()=>{p()}),ot(()=>{p()}),(e,l)=>(o(),n("section",vt,[t("header",_t,[l[6]||(l[6]=t("div",null,[t("h1",{class:"summary__title"},"钱包摘要"),t("p",{class:"summary__subtitle"},"查看平台余额、冻结与可提现情况，并按维度分析资金分布。")],-1)),t("div",bt,[t("button",{type:"button",class:"btn",onClick:Z,disabled:v.value},"导出当前视图",8,mt)])]),t("form",{class:"filters",onSubmit:ut(X,["prevent"])},[t("fieldset",ft,[l[11]||(l[11]=t("legend",null,"筛选条件",-1)),t("div",yt,[t("label",ht,[l[7]||(l[7]=t("span",null,"开始日期",-1)),k(t("input",{class:"input",type:"date","onUpdate:modelValue":l[0]||(l[0]=a=>s.start=a)},null,512),[[T,s.start]])]),t("label",pt,[l[8]||(l[8]=t("span",null,"结束日期",-1)),k(t("input",{class:"input",type:"date","onUpdate:modelValue":l[1]||(l[1]=a=>s.end=a)},null,512),[[T,s.end]])]),t("label",kt,[l[9]||(l[9]=t("span",null,"维度",-1)),k(t("select",{class:"input","onUpdate:modelValue":l[2]||(l[2]=a=>s.dimension=a)},[(o(),n(d,null,c(N,a=>t("option",{key:a.value,value:a.value},i(a.label),9,wt)),64))],512),[[U,s.dimension]])]),t("label",gt,[l[10]||(l[10]=t("span",null,"账户状态",-1)),k(t("select",{class:"input",multiple:"","onUpdate:modelValue":l[3]||(l[3]=a=>s.status=a)},[(o(),n(d,null,c(A,a=>t("option",{key:a,value:a},i(a),9,St)),64))],512),[[U,s.status]])])]),t("div",Ct,[t("button",{type:"submit",class:"btn",disabled:v.value},"应用筛选",8,Mt),t("button",{type:"button",class:"btn btn--ghost",onClick:Q,disabled:v.value},"重置",8,xt)])])],32),t("section",Dt,[(o(!0),n(d,null,c(H.value,a=>(o(),n("article",{class:"kpi-card",key:a.key},[t("header",null,[t("span",Ft,i(a.label),1)]),t("strong",Ot,i(f(a.value)),1)]))),128))]),t("section",zt,[t("article",Wt,[t("header",Nt,[l[12]||(l[12]=t("h2",null,"余额趋势",-1)),t("button",{type:"button",class:j(["btn btn--tiny",{"is-active":y.value==="balance"}]),onClick:l[4]||(l[4]=a=>P("balance"))}," 余额 ",2),t("button",{type:"button",class:j(["btn btn--tiny",{"is-active":y.value==="in_out"}]),onClick:l[5]||(l[5]=a=>P("in_out"))}," 入出账 ",2)]),y.value==="balance"?(o(),n("div",Vt,[(o(!0),n(d,null,c(V.value,a=>(o(),n("div",{key:a.ts,class:"chart__bar"},[t("div",{class:"chart__balance",style:D({height:M(a.balance,R.value)})},null,4),t("time",null,i(a.ts),1)]))),128))])):(o(),n("div",Et,[(o(!0),n(d,null,c(E.value,a=>(o(),n("div",{key:a.ts,class:"chart__bar"},[t("div",{class:"chart__inflow",style:D({height:M(a.inflow||0,I.value)})},null,4),t("div",{class:"chart__outflow",style:D({height:M(a.outflow||0,I.value)})},null,4),t("time",null,i(a.ts),1)]))),128))]))]),t("article",It,[t("header",Pt,[t("h2",null,"账户汇总（"+i(Y.value)+"）",1)]),t("table",null,[l[15]||(l[15]=t("thead",null,[t("tr",null,[t("th",null,"名称"),t("th",null,"余额"),t("th",null,"冻结"),t("th",null,"可用"),t("th",null,"可提现"),t("th",null,"最后交易时间"),t("th",null,"状态"),t("th",null,"操作")])],-1)),v.value?(o(),n("tbody",$t,[(o(),n(d,null,c(3,a=>t("tr",{key:`loading-${a}`},[...l[13]||(l[13]=[t("td",{colspan:8},[t("div",{class:"skeleton"})],-1)])])),64))])):C.value.length?(o(),n("tbody",Bt,[(o(!0),n(d,null,c(C.value,a=>(o(),n("tr",{key:a.entity_id},[t("td",null,i(a.entity_name),1),t("td",null,i(f(a.balance)),1),t("td",null,i(f(a.frozen)),1),t("td",null,i(f(a.available)),1),t("td",null,i(f(a.withdrawable)),1),t("td",null,i(K(a.last_tx_time)),1),t("td",null,i(a.status),1),t("td",null,[t("button",{type:"button",class:"link-btn",onClick:x=>tt(a)},"查看流水",8,Lt),t("button",{type:"button",class:"link-btn",disabled:a.withdrawable<=0},"去提现",8,Tt)])]))),128))])):(o(),n("tbody",Ut,[...l[14]||(l[14]=[t("tr",null,[t("td",{colspan:8,class:"placeholder"},"暂无数据，请调整筛选条件。")],-1)])]))])])]),_.value?(o(),n("p",jt,i(_.value),1)):m.value?(o(),n("p",qt,i(m.value),1)):it("",!0)]))}}),Kt=dt(At,[["__scopeId","data-v-b27dfcb4"]]);export{Kt as default};
