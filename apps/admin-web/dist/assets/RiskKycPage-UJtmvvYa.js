import{d as Ge,a as Ce,r as m,c as M,w as Je,o as Qe,b as i,e as l,f,A as k,B as d,t as s,i as A,v as I,j as N,F as U,h as z,k as Te,q as n,s as _,E as Xe,_ as Ze}from"./index-DvtP9USg.js";import{B as x}from"./Button-BaguUGDy.js";import{P as el}from"./Pagination-3ermIvaY.js";import{T as ll}from"./Table-BsZuLW91.js";import{M as al}from"./Modal-CtEdl0zk.js";import{K as V}from"./risk-DnqpjeeB.js";const tl={class:"kyc-console"},sl={class:"kyc-console__header"},nl={class:"kyc-console__actions"},il={key:0,class:"kyc-console__summary"},rl={class:"summary-card"},ol={class:"summary-card"},ul={class:"summary-card"},dl={class:"summary-card summary-card--critical"},vl={class:"summary-card"},cl={class:"summary-card"},_l=["disabled"],pl=["disabled"],ml=["disabled"],fl=["value"],bl=["disabled"],yl=["value"],gl=["disabled"],kl=["value"],hl=["disabled"],wl=["value"],Cl=["disabled"],Tl=["value"],Ml={class:"filters__actions"},Ul={class:"kyc-console__layout"},zl={class:"kyc-console__table",role:"region","aria-label":"KYC 案件列表"},xl=["data-level"],Al=["data-status"],Dl={key:0,class:"kyc-console__drawer","aria-label":"KYC 案件详情"},Kl={class:"drawer__header"},Ll={key:0,class:"drawer__body"},Vl={key:1,class:"drawer__body"},Fl={class:"drawer-section"},Ol={class:"drawer-grid"},Sl=["data-level"],$l={class:"drawer-section"},El={key:0,class:"materials"},Pl={key:0},Yl=["src"],jl={key:1},Rl=["src"],Nl={key:2},Bl=["src"],ql=["src","alt"],Il={key:1,class:"drawer__placeholder"},Hl={key:2,class:"material-metrics"},Wl={class:"drawer-section"},Gl={class:"drawer-grid"},Jl={class:"drawer-section"},Ql={class:"diff-table"},Xl=["data-mismatch"],Zl={key:0},ea={key:0,class:"drawer-section"},la={class:"timeline"},aa={class:"timeline__time"},ta={class:"timeline__body"},sa={class:"timeline__action"},na={key:0,class:"timeline__note"},ia={class:"drawer-actions"},ra={key:2,class:"drawer__body"},oa={key:1,class:"feedback"},ua={key:2,class:"feedback feedback--error"},da={key:0},va={key:1},Me="2025-10-03",Ue="2025-09-30",ca=Ge({__name:"RiskKycPage",setup(_a){const r=Ce({start_date:Ue,end_date:Me,status:"",risk_level:"",channel:"",source:"",id_type:"",page:1,page_size:20}),ze=[{value:"pending",label:"待审核"},{value:"need_more",label:"待补资料"},{value:"approved",label:"已通过"},{value:"rejected",label:"已拒绝"},{value:"callback_error",label:"回调异常"}],xe=[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"},{value:"critical",label:"极高"}],Ae=[{value:"wechat",label:"微信"},{value:"h5",label:"H5"},{value:"app",label:"APP"},{value:"api",label:"API"}],De=[{value:"auto",label:"自动"},{value:"manual",label:"人工"}],Ke=[{value:"cn_id",label:"大陆身份证"},{value:"hkid",label:"港澳居民证"},{value:"passport",label:"护照"},{value:"other",label:"其他"}],Le=[{key:"created_at",title:"提交时间",width:"11rem",sortable:!0},{key:"case_id",title:"案件号",width:"10rem"},{key:"status",title:"状态",width:"6rem"},{key:"risk_level",title:"风险等级",width:"7rem"},{key:"channel",title:"渠道",width:"6rem"},{key:"source",title:"来源",width:"6rem"},{key:"id_type",title:"证件类型",width:"8rem"},{key:"order_id",title:"订单号",width:"9rem"},{key:"user_id",title:"用户 ID",width:"8rem"},{key:"assignee_id",title:"指派",width:"6rem"}],w=m([]),B=m(0),p=m(!1),$=m(""),E=m(""),H=m(!1),o=m(null),b=Ce({}),W=m(!1),D=m(!1),v=m(null),C=m(""),P=m(""),T=m(!1),Y=m(!1);function K(a){const e=`<svg xmlns="http://www.w3.org/2000/svg" width="320" height="200"><rect width="100%" height="100%" fill="#F3F4F6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#6B7280" font-family="Arial,Helvetica,sans-serif" font-size="20">${a}</text></svg>`;return`data:image/svg+xml;utf8,${encodeURIComponent(e)}`}const F=[{case_id:"KYC20251003001",created_at:"2025-10-03T09:30:00+08:00",status:"pending",risk_level:"high",channel:"wechat",source:"auto",id_type:"cn_id",order_id:"O20251002001",user_id:"U138000",assignee_id:null},{case_id:"KYC20251002008",created_at:"2025-10-02T14:12:00+08:00",status:"need_more",risk_level:"medium",channel:"h5",source:"manual",id_type:"passport",order_id:"O20251001088",user_id:"U556677",assignee_id:"U2005"},{case_id:"KYC20250930015",created_at:"2025-09-30T11:05:00+08:00",status:"callback_error",risk_level:"critical",channel:"api",source:"auto",id_type:"cn_id",order_id:"O20250928022",user_id:"U998800",assignee_id:"U2002"}],q={KYC20251003001:{case_id:"KYC20251003001",created_at:"2025-10-03T09:30:00+08:00",status:"pending",risk_level:"high",channel:"wechat",source:"auto",id_type:"cn_id",order_id:"O20251002001",user_id:"U138000",assignee_id:null,double_review:!0,materials:{id_front_url:K("证件正面"),id_back_url:K("证件背面"),selfie_url:K("自拍"),liveness_score:.92,psl_similarity:.88},ocr:{name:"张三",id_number:"4401********1234",birth_date:"1995-06-18",gender:"M",address:"广东省广州市天河区体育西路 1 号",valid_from:"2021-01-01",valid_to:"2031-01-01",confidence:.94},form:{name:"张三",id_number:"4401********1234",birth_date:"1995-06-18",gender:"M",address:"广东省广州市天河区体育西路 1 号"},diffs:[{key:"name",ocr_value:"张三",form_value:"张三",confidence:.94,mismatch:!1},{key:"id_number",ocr_value:"4401********1234",form_value:"4401********1234",confidence:.92,mismatch:!1},{key:"address",ocr_value:"广东省广州市天河区体育西路一号",form_value:"广东省广州市天河区体育西路 1 号",confidence:.76,mismatch:!0}],actions:[{time:"2025-10-03T09:31:00+08:00",actor:"系统",action:"auto_review",note:"触发人工复核"}]},KYC20251002008:{case_id:"KYC20251002008",created_at:"2025-10-02T14:12:00+08:00",status:"need_more",risk_level:"medium",channel:"h5",source:"manual",id_type:"passport",order_id:"O20251001088",user_id:"U556677",assignee_id:"U2005",double_review:!1,materials:{id_front_url:K("证件正面"),selfie_url:K("自拍"),extra_images:[K("补充材料")]},ocr:{name:"LEE KA",id_number:"P12345678",birth_date:"1992-03-08",gender:"F",valid_from:"2020-06-01",valid_to:"2030-05-31"},form:{name:"LEE KA",id_number:"P12345678",birth_date:"1992-03-08",gender:"F",address:"香港九龙弥敦道 99 号"},diffs:[{key:"address",ocr_value:"——",form_value:"香港九龙弥敦道 99 号",confidence:.4,mismatch:!0}],actions:[{time:"2025-10-02T14:20:00+08:00",actor:"李秀",action:"request_more",note:"请补充住址证明"}]},KYC20250930015:{case_id:"KYC20250930015",created_at:"2025-09-30T11:05:00+08:00",status:"callback_error",risk_level:"critical",channel:"api",source:"auto",id_type:"cn_id",order_id:"O20250928022",user_id:"U998800",assignee_id:"U2002",double_review:!0,materials:{id_front_url:K("证件正面"),selfie_url:K("自拍")},ocr:{name:"李四",id_number:"3301********5678",birth_date:"1988-11-20",gender:"M",address:"浙江省杭州市西湖区灵隐路 18 号",valid_from:"2022-05-01",valid_to:"2032-04-30"},form:{name:"李四",id_number:"3301********5678",birth_date:"1988-11-20",gender:"M",address:"浙江省杭州市西湖区灵隐路 18 号"},diffs:[{key:"liveness_score",ocr_value:"0.62",form_value:"0.90",confidence:.62,mismatch:!0}],actions:[{time:"2025-09-30T11:07:00+08:00",actor:"三方供应商",action:"callback_error",note:"签名校验失败"},{time:"2025-09-30T11:09:00+08:00",actor:"系统",action:"auto_retry",note:"等待重放"}]}},O=M(()=>{const a={pending:0,needMore:0,approved:0,callbackError:0,processedToday:0,approvalRate:"0%"},e=new Date().toISOString().slice(0,10);let u=0,L=0;if(w.value.forEach(h=>{h.status==="pending"&&(a.pending+=1),h.status==="need_more"&&(a.needMore+=1),h.status==="approved"&&(a.approved+=1,L+=1),h.status==="callback_error"&&(a.callbackError+=1),h.status!=="pending"&&(u+=1),h.created_at.startsWith(e)&&(a.processedToday+=1)}),u>0){const h=Math.round(L/u*100);a.approvalRate=`${h}%`}return a}),X=M(()=>Math.max(1,Math.ceil(B.value/(r.page_size||10)))),y=M(()=>o.value&&w.value.find(a=>a.case_id===o.value)||null),c=M(()=>o.value?b[o.value]:null),Ve=M(()=>{var e,u;const a=(e=c.value)==null?void 0:e.materials;return a?!!(a.id_front_url||a.id_back_url||a.selfie_url||(((u=a.extra_images)==null?void 0:u.length)||0)>0):!1}),Z=M(()=>{var u;const a=(u=c.value)==null?void 0:u.materials;if(!a)return[];const e=[];return typeof a.liveness_score=="number"&&e.push({label:"活体得分",value:(a.liveness_score*100).toFixed(0)+"%"}),typeof a.psl_similarity=="number"&&e.push({label:"证照相似度",value:(a.psl_similarity*100).toFixed(0)+"%"}),e}),ee=M(()=>{var a,e;return(e=(a=c.value)==null?void 0:a.diffs)!=null&&e.length?c.value.diffs:[]}),Fe=M(()=>{var e;const a=(e=c.value)==null?void 0:e.ocr;return a?{name:a.name,id_number:a.id_number,birth_date:a.birth_date,gender:a.gender,address:a.address,issued_by:a.issued_by,valid_from:a.valid_from,valid_to:a.valid_to,confidence:a.confidence!==void 0?`${Math.round((a.confidence||0)*100)}%`:void 0}:{}}),Oe=M(()=>!D.value||!v.value?"":v.value==="approve"?"确认通过案件":v.value==="reject"?"拒绝案件":"请求补充材料"),le=M(()=>!D.value||!v.value||!o.value?!1:v.value==="approve"?!T.value:v.value==="reject"?C.value.trim().length>=5&&!T.value:v.value==="request_more"?C.value.trim().length>=5&&P.value.trim().length>0&&!T.value:!1);Je(D,a=>{a||(v.value=null,C.value="",P.value="")}),Qe(()=>{S()});async function S(){p.value=!0;try{const e=await V.list({...r})||{},u=Array.isArray(e.items)?e.items:[];u.length?(w.value=u,B.value=typeof e.total=="number"?e.total:u.length):(w.value=[...F],B.value=F.length)}catch(a){w.value=[...F],B.value=F.length,R(a.message||"加载 KYC 案件失败")}finally{p.value=!1,o.value&&!w.value.some(a=>a.case_id===o.value)&&ae()}}function Se(){r.page=1,S()}function $e(){r.start_date=Ue,r.end_date=Me,r.status="",r.risk_level="",r.channel="",r.source="",r.id_type="",r.page=1,r.page_size=20,S()}function Ee(a){r.page=a,S()}function Pe(a){r.page_size=a,r.page=1,S()}function Ye(a){o.value=a.case_id,H.value=!0,je(a.case_id)}function ae(){H.value=!1,o.value=null}async function je(a){if(!b[a]){W.value=!0;try{const e=await V.getDetail(a);e?b[a]=e:b[a]=q[a]||q[F[0].case_id]}catch(e){R(e.message||"获取案件详情失败，将展示示例数据"),b[a]=q[a]||q[F[0].case_id]}finally{W.value=!1}}}function G(a){o.value&&(v.value=a,D.value=!0)}function Re(){D.value=!1}async function te(){if(!(!v.value||!o.value)&&le.value){T.value=!0;try{if(v.value==="approve")await V.approve(o.value,C.value?{note:C.value}:void 0),J(o.value,"approved"),j("案件已通过");else if(v.value==="reject")await V.reject(o.value,{note:C.value,reason_code:"manual_review"}),J(o.value,"rejected"),j("案件已拒绝");else{const a=P.value.split(",").map(e=>e.trim()).filter(e=>e.length);await V.requestMore(o.value,{note:C.value,required_fields:a}),J(o.value,"need_more"),j("已请求补充材料")}b[o.value]&&(b[o.value]={...b[o.value],status:v.value==="approve"?"approved":v.value==="reject"?"rejected":"need_more",actions:se(b[o.value].actions,v.value,C.value)}),D.value=!1}catch(a){R(a.message||"执行操作失败")}finally{T.value=!1}}}async function Ne(){if(!(!o.value||Y.value)){Y.value=!0;try{await V.syncCallback(o.value),j("已触发回调同步"),b[o.value]&&(b[o.value]={...b[o.value],actions:se(b[o.value].actions,"sync_callback","手动同步回调")})}catch(a){R(a.message||"回调同步失败")}finally{Y.value=!1}}}async function Be(){try{await V.exportCases({...r}),j("导出任务已创建，请前往导出中心查看")}catch(a){R(a.message||"导出失败")}}function J(a,e){w.value=w.value.map(u=>u.case_id===a?{...u,status:e}:u)}function se(a,e,u){const L=Array.isArray(a)?[...a]:[];return L.unshift({time:new Date().toISOString(),actor:"当前用户",action:e,note:u}),L}function j(a){$.value=a,window.setTimeout(()=>{$.value===a&&($.value="")},3e3)}function R(a){E.value=a,window.setTimeout(()=>{E.value===a&&(E.value="")},4e3)}function Q(a){if(!a)return"—";try{const e=new Date(a);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}catch{return a}}function qe(a){return a==null||Number.isNaN(a)?"—":`${Math.round(a*100)}%`}function ne(a){return{pending:"待审核",need_more:"待补资料",approved:"已通过",rejected:"已拒绝",callback_error:"回调异常"}[a]||a}function ie(a){return{low:"低",medium:"中",high:"高",critical:"极高"}[a]||a}function re(a){return{wechat:"微信",h5:"H5",app:"APP",api:"API"}[a]||a||"—"}function oe(a){return a==="auto"?"自动":a==="manual"?"人工":"—"}function ue(a){return{cn_id:"大陆身份证",hkid:"港澳居民证",passport:"护照",other:"其他"}[a]||a||"—"}function Ie(a){return{name:"姓名",id_number:"证件号",birth_date:"出生日期",gender:"性别",address:"地址",issued_by:"签发机关",valid_from:"有效期自",valid_to:"有效期至",confidence:"整体置信度"}[a]||a}function He(a){return{name:"姓名",id_number:"证件号",birth_date:"出生日期",gender:"性别",address:"地址",liveness_score:"活体得分",psl_similarity:"相似度"}[a]||a}function We(a){return{auto_review:"自动分流",assign:"指派",approve:"通过",reject:"拒绝",request_more:"请求补充",sync_callback:"同步回调",auto_retry:"自动重试",callback_error:"回调异常"}[a]||a}return(a,e)=>{var u,L,h,de,ve,ce,_e,pe,me,fe,be,ye,ge,ke,he;return n(),i("section",tl,[l("header",sl,[e[16]||(e[16]=l("div",null,[l("h1",{class:"kyc-console__title"},"KYC 审核 Console"),l("p",{class:"kyc-console__subtitle"},"集中查看实名材料、OCR 差异与风险等级，实现一键通过、拒绝或补充。")],-1)),l("div",nl,[k(x,{size:"sm",variant:"ghost",disabled:p.value,onClick:Be},{default:d(()=>[...e[14]||(e[14]=[_("导出当前列表",-1)])]),_:1},8,["disabled"]),k(x,{size:"sm",variant:"secondary",disabled:p.value,onClick:S},{default:d(()=>[...e[15]||(e[15]=[_("刷新",-1)])]),_:1},8,["disabled"])])]),w.value.length?(n(),i("section",il,[l("article",rl,[e[17]||(e[17]=l("h3",null,"待审核",-1)),l("strong",null,s(O.value.pending),1)]),l("article",ol,[e[18]||(e[18]=l("h3",null,"待补资料",-1)),l("strong",null,s(O.value.needMore),1)]),l("article",ul,[e[19]||(e[19]=l("h3",null,"已通过",-1)),l("strong",null,s(O.value.approved),1)]),l("article",dl,[e[20]||(e[20]=l("h3",null,"回调异常",-1)),l("strong",null,s(O.value.callbackError),1)]),l("article",vl,[e[21]||(e[21]=l("h3",null,"今日处理",-1)),l("strong",null,s(O.value.processedToday),1)]),l("article",cl,[e[22]||(e[22]=l("h3",null,"通过率",-1)),l("strong",null,s(O.value.approvalRate),1)])])):f("",!0),l("form",{class:"kyc-console__filters",onSubmit:Te(Se,["prevent"])},[l("label",null,[e[23]||(e[23]=l("span",null,"开始日期",-1)),A(l("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>r.start_date=t),disabled:p.value},null,8,_l),[[I,r.start_date]])]),l("label",null,[e[24]||(e[24]=l("span",null,"结束日期",-1)),A(l("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>r.end_date=t),disabled:p.value},null,8,pl),[[I,r.end_date]])]),l("label",null,[e[26]||(e[26]=l("span",null,"状态",-1)),A(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.status=t),disabled:p.value},[e[25]||(e[25]=l("option",{value:""},"全部",-1)),(n(),i(U,null,z(ze,t=>l("option",{key:t.value,value:t.value},s(t.label),9,fl)),64))],8,ml),[[N,r.status]])]),l("label",null,[e[28]||(e[28]=l("span",null,"风险等级",-1)),A(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.risk_level=t),disabled:p.value},[e[27]||(e[27]=l("option",{value:""},"全部",-1)),(n(),i(U,null,z(xe,t=>l("option",{key:t.value,value:t.value},s(t.label),9,yl)),64))],8,bl),[[N,r.risk_level]])]),l("label",null,[e[30]||(e[30]=l("span",null,"渠道",-1)),A(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.channel=t),disabled:p.value},[e[29]||(e[29]=l("option",{value:""},"全部",-1)),(n(),i(U,null,z(Ae,t=>l("option",{key:t.value,value:t.value},s(t.label),9,kl)),64))],8,gl),[[N,r.channel]])]),l("label",null,[e[32]||(e[32]=l("span",null,"来源",-1)),A(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.source=t),disabled:p.value},[e[31]||(e[31]=l("option",{value:""},"全部",-1)),(n(),i(U,null,z(De,t=>l("option",{key:t.value,value:t.value},s(t.label),9,wl)),64))],8,hl),[[N,r.source]])]),l("label",null,[e[34]||(e[34]=l("span",null,"证件类型",-1)),A(l("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>r.id_type=t),disabled:p.value},[e[33]||(e[33]=l("option",{value:""},"全部",-1)),(n(),i(U,null,z(Ke,t=>l("option",{key:t.value,value:t.value},s(t.label),9,Tl)),64))],8,Cl),[[N,r.id_type]])]),l("div",Ml,[k(x,{size:"sm",type:"submit",loading:p.value},{default:d(()=>[...e[35]||(e[35]=[_("应用",-1)])]),_:1},8,["loading"]),k(x,{size:"sm",type:"button",variant:"ghost",disabled:p.value,onClick:$e},{default:d(()=>[...e[36]||(e[36]=[_("重置",-1)])]),_:1},8,["disabled"])])],32),l("div",Ul,[l("section",zl,[k(ll,{columns:Le,rows:w.value,loading:p.value,"row-key":t=>t.case_id,"default-sort-key":"created_at","default-sort-order":"desc",onRowClick:Ye},{"cell:created_at":d(({row:t})=>[_(s(Q(t.created_at)),1)]),"cell:risk_level":d(({row:t})=>[l("span",{class:"risk-chip","data-level":t.risk_level},s(ie(t.risk_level)),9,xl)]),"cell:status":d(({row:t})=>[l("span",{class:"status-chip","data-status":t.status},s(ne(t.status)),9,Al)]),"cell:channel":d(({row:t})=>[_(s(re(t.channel)),1)]),"cell:source":d(({row:t})=>[_(s(oe(t.source)),1)]),"cell:id_type":d(({row:t})=>[_(s(ue(t.id_type)),1)]),"cell:assignee_id":d(({row:t})=>[_(s(t.assignee_id||"未指派"),1)]),empty:d(()=>[_(s(p.value?"加载中…":"暂无案件"),1)]),pagination:d(()=>[X.value>1?(n(),Xe(el,{key:0,page:r.page,pages:X.value,"page-size":r.page_size,"onUpdate:page":Ee,"onUpdate:pageSize":Pe},null,8,["page","pages","page-size"])):f("",!0)]),_:1},8,["rows","loading","row-key"])]),H.value?(n(),i("aside",Dl,[l("header",Kl,[l("div",null,[l("h2",null,s((u=y.value)==null?void 0:u.case_id),1),l("p",null,s(Q(((L=y.value)==null?void 0:L.created_at)||""))+" · "+s(ne(((h=y.value)==null?void 0:h.status)||"pending")),1)]),l("button",{class:"drawer__close",type:"button","aria-label":"关闭",onClick:ae},"×")]),W.value?(n(),i("div",Ll,[...e[37]||(e[37]=[l("p",{class:"drawer__placeholder"},"详情加载中…",-1)])])):c.value?(n(),i("div",Vl,[l("section",Fl,[e[46]||(e[46]=l("h3",null,"基础信息",-1)),l("dl",Ol,[l("div",null,[e[38]||(e[38]=l("dt",null,"风险等级",-1)),l("dd",null,[l("span",{class:"risk-chip","data-level":((de=y.value)==null?void 0:de.risk_level)||"low"},s(ie(((ve=y.value)==null?void 0:ve.risk_level)||"low")),9,Sl)])]),l("div",null,[e[39]||(e[39]=l("dt",null,"渠道",-1)),l("dd",null,s(re(((ce=y.value)==null?void 0:ce.channel)||"")),1)]),l("div",null,[e[40]||(e[40]=l("dt",null,"来源",-1)),l("dd",null,s(oe(((_e=y.value)==null?void 0:_e.source)||"manual")),1)]),l("div",null,[e[41]||(e[41]=l("dt",null,"证件类型",-1)),l("dd",null,s(ue(((pe=y.value)==null?void 0:pe.id_type)||"")),1)]),l("div",null,[e[42]||(e[42]=l("dt",null,"订单号",-1)),l("dd",null,s(((me=y.value)==null?void 0:me.order_id)||"—"),1)]),l("div",null,[e[43]||(e[43]=l("dt",null,"用户 ID",-1)),l("dd",null,s(((fe=y.value)==null?void 0:fe.user_id)||"—"),1)]),l("div",null,[e[44]||(e[44]=l("dt",null,"指派人",-1)),l("dd",null,s(c.value.assignee_id||"未指派"),1)]),l("div",null,[e[45]||(e[45]=l("dt",null,"双人复核",-1)),l("dd",null,s(c.value.double_review?"要求":"否"),1)])])]),l("section",$l,[e[50]||(e[50]=l("h3",null,"材料预览",-1)),Ve.value?(n(),i("div",El,[(be=c.value.materials)!=null&&be.id_front_url?(n(),i("figure",Pl,[l("img",{src:c.value.materials.id_front_url,alt:"证件正面",loading:"lazy"},null,8,Yl),e[47]||(e[47]=l("figcaption",null,"证件正面",-1))])):f("",!0),(ye=c.value.materials)!=null&&ye.id_back_url?(n(),i("figure",jl,[l("img",{src:c.value.materials.id_back_url,alt:"证件背面",loading:"lazy"},null,8,Rl),e[48]||(e[48]=l("figcaption",null,"证件背面",-1))])):f("",!0),(ge=c.value.materials)!=null&&ge.selfie_url?(n(),i("figure",Nl,[l("img",{src:c.value.materials.selfie_url,alt:"自拍/活体照",loading:"lazy"},null,8,Bl),e[49]||(e[49]=l("figcaption",null,"自拍/活体照",-1))])):f("",!0),(n(!0),i(U,null,z(((ke=c.value.materials)==null?void 0:ke.extra_images)||[],(t,g)=>{var we;return n(),i("figure",{key:`${(we=y.value)==null?void 0:we.case_id}-extra-${g}`},[l("img",{src:t,alt:`补充材料 ${g+1}`,loading:"lazy"},null,8,ql),l("figcaption",null,"补充材料 "+s(g+1),1)])}),128))])):(n(),i("p",Il,"暂无材料图片")),Z.value.length?(n(),i("ul",Hl,[(n(!0),i(U,null,z(Z.value,t=>(n(),i("li",{key:t.label},[l("span",null,s(t.label),1),l("strong",null,s(t.value),1)]))),128))])):f("",!0)]),l("section",Wl,[e[51]||(e[51]=l("h3",null,"OCR 结果",-1)),l("dl",Gl,[(n(!0),i(U,null,z(Fe.value,(t,g)=>(n(),i("div",{key:`ocr-${g}`},[l("dt",null,s(Ie(g)),1),l("dd",null,s(t||"—"),1)]))),128))])]),l("section",Jl,[e[54]||(e[54]=l("h3",null,"差异高亮",-1)),l("table",Ql,[e[53]||(e[53]=l("thead",null,[l("tr",null,[l("th",null,"字段"),l("th",null,"OCR"),l("th",null,"表单"),l("th",null,"置信度")])],-1)),l("tbody",null,[(n(!0),i(U,null,z(ee.value,t=>{var g;return n(),i("tr",{key:`${(g=y.value)==null?void 0:g.case_id}-${t.key}`,"data-mismatch":t.mismatch},[l("td",null,s(He(t.key)),1),l("td",null,s(t.ocr_value||"—"),1),l("td",null,s(t.form_value||"—"),1),l("td",null,s(qe(t.confidence)),1)],8,Xl)}),128)),ee.value.length?f("",!0):(n(),i("tr",Zl,[...e[52]||(e[52]=[l("td",{colspan:"4",class:"placeholder"},"暂无差异",-1)])]))])])]),(he=c.value.actions)!=null&&he.length?(n(),i("section",ea,[e[55]||(e[55]=l("h3",null,"处理记录",-1)),l("ul",la,[(n(!0),i(U,null,z(c.value.actions,t=>{var g;return n(),i("li",{key:`${(g=y.value)==null?void 0:g.case_id}-${t.time}`},[l("span",aa,s(Q(t.time)),1),l("div",ta,[l("strong",null,s(t.actor),1),l("span",sa,s(We(t.action)),1),t.note?(n(),i("span",na,s(t.note),1)):f("",!0)])])}),128))])])):f("",!0),l("div",ia,[k(x,{size:"sm",variant:"secondary",onClick:e[7]||(e[7]=t=>G("approve")),disabled:!o.value||T.value},{default:d(()=>[...e[56]||(e[56]=[_(" 通过 ",-1)])]),_:1},8,["disabled"]),k(x,{size:"sm",variant:"danger",onClick:e[8]||(e[8]=t=>G("reject")),disabled:!o.value||T.value},{default:d(()=>[...e[57]||(e[57]=[_(" 拒绝 ",-1)])]),_:1},8,["disabled"]),k(x,{size:"sm",variant:"secondary",onClick:e[9]||(e[9]=t=>G("request_more")),disabled:!o.value||T.value},{default:d(()=>[...e[58]||(e[58]=[_(" 补充材料 ",-1)])]),_:1},8,["disabled"]),k(x,{size:"sm",variant:"ghost",onClick:Ne,loading:Y.value,disabled:!o.value||Y.value},{default:d(()=>[...e[59]||(e[59]=[_(" 同步三方回调 ",-1)])]),_:1},8,["loading","disabled"])])])):(n(),i("div",ra,[...e[60]||(e[60]=[l("p",{class:"drawer__placeholder"},"请选择一个案件查看详情。",-1)])]))])):f("",!0)]),$.value?(n(),i("p",oa,s($.value),1)):f("",!0),E.value?(n(),i("p",ua,s(E.value),1)):f("",!0),k(al,{modelValue:D.value,"onUpdate:modelValue":e[13]||(e[13]=t=>D.value=t),onConfirm:te},{title:d(()=>[_(s(Oe.value),1)]),footer:d(()=>[k(x,{variant:"secondary",onClick:Re,disabled:T.value},{default:d(()=>[...e[62]||(e[62]=[_("取消",-1)])]),_:1},8,["disabled"]),k(x,{variant:"primary",loading:T.value,onClick:te,disabled:!le.value},{default:d(()=>[...e[63]||(e[63]=[_(" 确认 ",-1)])]),_:1},8,["loading","disabled"])]),default:d(()=>[l("form",{class:"modal-form",onSubmit:e[12]||(e[12]=Te(()=>{},["prevent"]))},[v.value==="request_more"?(n(),i("label",da,[e[61]||(e[61]=l("span",null,"需要补充的字段（逗号分隔）",-1)),A(l("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=t=>P.value=t),placeholder:"如 身份证正面, 住所证明"},null,512),[[I,P.value,void 0,{trim:!0}]])])):f("",!0),v.value!==null?(n(),i("label",va,[l("span",null,"备注"+s(v.value==="approve"?"（可选）":"（至少 5 字）"),1),A(l("textarea",{"onUpdate:modelValue":e[11]||(e[11]=t=>C.value=t),rows:"3",placeholder:"填写处理说明"},null,512),[[I,C.value,void 0,{trim:!0}]])])):f("",!0)],32)]),_:1},8,["modelValue"])])}}}),ka=Ze(ca,[["__scopeId","data-v-937d1060"]]);export{ka as default};
