import{O as ue,d as qe,a as J,r as P,c as oe,o as Pe,z as Me,b as _,e as t,f as T,A as E,B as f,t as i,i as x,v as D,j as W,F as L,h as H,H as Oe,n as de,k as Re,q as c,s as k,E as Ve,m as Fe,_ as Ie}from"./index-DvtP9USg.js";import{B as C}from"./Button-BaguUGDy.js";import{P as Ae}from"./Pagination-3ermIvaY.js";import{T as Je}from"./Table-BsZuLW91.js";function M(){return{"Content-Type":"application/json",...ue.HEADERS||{}}}function O(u,d){var n;const p=((n=ue.BASE)==null?void 0:n.replace(/\/$/,""))||"";if(!d||Object.keys(d).length===0)return`${p}${u}`;const $=new URLSearchParams;Object.entries(d).forEach(([w,v])=>{if(!(v==null||v==="")){if(Array.isArray(v)){v.length&&$.append(w,v.join(","));return}$.append(w,String(v))}});const a=$.toString();return a?`${p}${u}?${a}`:`${p}${u}`}async function R(u,d){const p=await fetch(u,d);if(!p.ok){let a=`Request failed with ${p.status}`,n=null;const w=p.headers.get("content-type")||"";try{if(w.includes("application/json")){n=await p.json();const b=n==null?void 0:n.message;typeof b=="string"&&b.trim()&&(a=b)}else{const b=await p.text();b.trim()&&(a=b)}}catch{}const v=new Error(a);throw n&&typeof n=="object"&&Object.assign(v,{details:n}),v}return p.status===204?void 0:(p.headers.get("content-type")||"").includes("application/json")?await p.json():await p.text()}const V={async list(u){const d=O("/api/v1/exports",u||{});return R(d,{method:"GET",headers:M()})},async get(u){const d=O(`/api/v1/exports/${encodeURIComponent(u)}`);return R(d,{method:"GET",headers:M()})},async retry(u){const d=O(`/api/v1/exports/${encodeURIComponent(u)}/retry`);return R(d,{method:"POST",headers:M()})},async cancel(u){const d=O(`/api/v1/exports/${encodeURIComponent(u)}/cancel`);return R(d,{method:"POST",headers:M()})},async deleteExpired(){const u=O("/api/v1/exports/batch_delete_expired");return R(u,{method:"POST",headers:M()})}},Le={class:"exports-center"},He={class:"exports-center__header"},Xe={class:"exports-center__actions"},Ge={class:"exports-center__stats"},Ye={class:"stats-card"},We={class:"stats-card__value"},Ke={class:"stats-card"},Qe={class:"stats-card__value"},Ze={class:"stats-card"},et={class:"stats-card__value"},tt={class:"stats-card"},st={class:"stats-card__value"},lt={class:"filters__group"},at={class:"filters__grid"},nt={class:"filters__field"},it=["disabled"],rt={class:"filters__field"},ot=["disabled"],dt={class:"filters__field"},ut=["disabled"],ct=["value"],pt={class:"filters__field"},_t=["disabled"],ft=["value"],vt={class:"filters__field"},bt=["disabled"],yt={class:"filters__field"},mt=["disabled"],gt={class:"filters__field"},wt=["disabled"],kt={class:"filters__field"},ht=["disabled"],xt={class:"filters__field"},St=["disabled"],zt={class:"filters__actions"},Tt={class:"quick-range"},Et=["disabled","onClick"],$t={class:"filters__buttons"},Ct={class:"exports-center__content"},Ut=["data-status"],jt={class:"progress"},Dt={class:"file-cell"},Bt={key:0,class:"file-cell__meta"},Nt={key:1,class:"file-cell__meta"},qt={class:"row-actions"},Pt=["onClick"],Mt=["disabled","onClick","title"],Ot=["disabled","onClick"],Rt=["disabled","onClick"],Vt={key:0,class:"job-drawer"},Ft={class:"job-drawer__header"},It={key:0,class:"job-drawer__body"},At={key:1,class:"job-drawer__body"},Jt={class:"drawer-section"},Lt={class:"drawer-grid"},Ht=["data-status"],Xt={class:"drawer-buttons"},Gt={class:"drawer-section"},Yt={class:"drawer-pre"},Wt={key:0,class:"drawer-section"},Kt={class:"drawer-pre logs"},Qt={key:1,class:"drawer-section"},Zt={class:"drawer-error"},es={key:2,class:"drawer-section"},ts={class:"downloads"},ss={key:2,class:"job-drawer__body"},ls=qe({__name:"ExportsCenterPage",setup(u){const d=new Date,p=h(d),$=h(Y(d,-6)),a=J({start:$,end:p,status:"",type:"",createdBy:"",source:"",fileType:"",minSize:void 0,maxSize:void 0,page:1,pageSize:20}),n=J({list:!1,detail:!1,retry:!1,cancel:!1,deleteExpired:!1}),w=P([]),v=P(0),b=J({open:!1,jobId:""}),r=P(null),S=J({message:"",error:!1}),ce=[{value:"today",label:"今日"},{value:"7d",label:"近 7 天"},{value:"30d",label:"近 30 天"}],X=P("7d"),pe=[{value:"queued",label:"排队中"},{value:"processing",label:"进行中"},{value:"ready",label:"已完成"},{value:"failed",label:"失败"},{value:"canceled",label:"已取消"},{value:"expired",label:"已过期"}],K=[{value:"orders",label:"订单明细"},{value:"wallet_ledger",label:"钱包流水"},{value:"wallet_summary",label:"钱包汇总"},{value:"withdraws",label:"提现"},{value:"campaigns",label:"营销活动"},{value:"tasks",label:"任务列表"},{value:"teams",label:"团队"},{value:"members",label:"成员"},{value:"users",label:"用户"},{value:"roles",label:"角色"},{value:"risk_hits",label:"风控命中"},{value:"risk_tickets",label:"风控工单"},{value:"risk_lists",label:"名单导出"},{value:"risk_rules",label:"规则配置"},{value:"kyc_cases",label:"KYC 案件"},{value:"reports_custom",label:"自定义报表"}],_e=[{key:"job_id",title:"任务号",width:"10rem"},{key:"type",title:"类型",width:"8rem"},{key:"status",title:"状态",width:"7rem"},{key:"progress",title:"进度",width:"8rem"},{key:"file",title:"文件信息",width:"16rem"},{key:"created_by",title:"发起人",width:"8rem"},{key:"created_at",title:"创建时间",width:"12rem"},{key:"finished_at",title:"完成时间",width:"12rem"},{key:"source",title:"来源",width:"10rem"},{key:"actions",title:"操作",width:"12rem"}],B={total:5,page:1,page_size:20,items:[{job_id:"E20251003001",type:"orders",status:"processing",progress:65,file_name:null,file_type:"csv",file_size:null,download_url:null,expires_at:null,params:{start:"2025-09-01",end:"2025-09-30",status:"approved"},created_by:"U1001",created_at:"2025-10-03T10:00:00+08:00",finished_at:null,source:"/orders",retry_of:null,error:null},{job_id:"E20251003002",type:"wallet_ledger",status:"ready",progress:100,file_name:"wallet_ledger_202509.csv",file_type:"csv",file_size:10485760,download_url:"https://mock/exports/E20251003002?sig=ready",expires_at:"2025-10-04T10:00:00+08:00",params:{start:"2025-09-01",end:"2025-09-30",dimension:"store"},created_by:"U2001",created_at:"2025-10-03T09:30:00+08:00",finished_at:"2025-10-03T09:45:12+08:00",source:"/wallet/ledger",retry_of:null,error:null},{job_id:"E20251003003",type:"risk_hits",status:"failed",progress:80,file_name:null,file_type:"csv",file_size:null,download_url:null,expires_at:null,params:{start:"2025-09-28",end:"2025-10-03"},created_by:"U3001",created_at:"2025-10-03T08:00:00+08:00",finished_at:"2025-10-03T08:20:00+08:00",source:"/risk/hits",retry_of:null,error:{code:"EXPORT_TIMEOUT",message:"Job exceeded 20m limit"}},{job_id:"E20251003004",type:"reports_custom",status:"queued",progress:5,file_name:null,file_type:"xlsx",file_size:null,download_url:null,expires_at:null,params:{preset:"channel_weekly",period:"2025-W39"},created_by:"U1002",created_at:"2025-10-03T10:30:00+08:00",finished_at:null,source:"/reports/overview",retry_of:null,error:null},{job_id:"E20251002011",type:"withdraws",status:"expired",progress:100,file_name:"withdraws_20250925.csv",file_type:"csv",file_size:5242880,download_url:null,expires_at:"2025-10-02T22:00:00+08:00",params:{start:"2025-09-25",end:"2025-09-25"},created_by:"U2002",created_at:"2025-10-02T20:15:00+08:00",finished_at:"2025-10-02T20:35:00+08:00",source:"/withdraws",retry_of:null,error:null}]},fe={job_id:"E20251003002",type:"wallet_ledger",status:"ready",progress:100,file_name:"wallet_ledger_202509.csv",file_type:"csv",file_size:10485760,download_url:"https://mock/exports/E20251003002?sig=ready",expires_at:"2025-10-04T10:00:00+08:00",params:{start:"2025-09-01",end:"2025-09-30",dimension:"store"},created_by:"U2001",created_at:"2025-10-03T09:30:00+08:00",finished_at:"2025-10-03T09:45:12+08:00",source:"/wallet/ledger",retry_of:null,error:null,logs_tail:`2025-10-03 09:30:01 queued
2025-10-03 09:30:05 pulling data...
2025-10-03 09:36:12 writing csv chunk 5/5
2025-10-03 09:37:01 uploading to storage
2025-10-03 09:45:12 job completed.`,downloads:[{time:"2025-10-03T09:50:00+08:00",actor:"U2001",channel:"web",ip:"10.10.1.8"}]},ve={job_id:"E20251003003",type:"risk_hits",status:"failed",progress:80,file_name:null,file_type:"csv",file_size:null,download_url:null,expires_at:null,params:{start:"2025-09-28",end:"2025-10-03"},created_by:"U3001",created_at:"2025-10-03T08:00:00+08:00",finished_at:"2025-10-03T08:20:00+08:00",source:"/risk/hits",retry_of:null,error:{code:"EXPORT_TIMEOUT",message:"Job exceeded 20m limit"},logs_tail:`2025-10-03 08:00:00 queued
2025-10-03 08:02:12 processing rules hit data…
2025-10-03 08:16:40 uploading chunk 7/10
2025-10-03 08:20:00 timeout reached, aborting job
2025-10-03 08:20:01 job marked as failed`,downloads:[]},F=P(null),Q=oe(()=>Math.max(1,Math.ceil(v.value/a.pageSize))),I=oe(()=>Ce(w.value)),Z=["admin"];Pe(()=>{g(),Ee()}),Me(()=>{ne()});function be(){a.page=1,g()}function ye(){a.start=$,a.end=p,a.status="",a.type="",a.createdBy="",a.source="",a.fileType="",a.minSize=void 0,a.maxSize=void 0,a.page=1,a.pageSize=20,X.value="7d",g()}function me(s){X.value=s,s==="today"?(a.start=h(d),a.end=h(d)):s==="7d"?(a.start=h(Y(d,-6)),a.end=h(d)):(a.start=h(Y(d,-29)),a.end=h(d)),a.page=1,g()}function ge(s){a.page=s,g(!1)}function we(s){a.pageSize=s,a.page=1,g(!1)}async function g(s=!0){n.list=!0;try{const e=await V.list($e()),o=e&&Array.isArray(e.items)&&e.items.length?e:B;w.value=o.items,v.value=typeof o.total=="number"?o.total:o.items.length,s&&y("导出任务已刷新。",!1)}catch(e){w.value=B.items,v.value=B.total,y(e.message||"加载导出任务失败，已展示示例数据。",!0)}finally{n.list=!1}}async function ee(s){n.detail=!0;try{const e=await V.get(s);r.value=e??te(s)}catch(e){r.value=te(s),y(e.message||"获取任务详情失败，展示示例数据。",!0)}finally{n.detail=!1}}function te(s){return s==="E20251003003"?ve:s==="E20251003002"?fe:{...B.items.find(o=>o.job_id===s)||B.items[0]}}function ke(s){b.open=!0,b.jobId=s.job_id,r.value=s,ee(s.job_id)}function he(){b.open=!1,b.jobId="",r.value=null}function A(s){return!s||!s.download_url||s.status!=="ready"?!1:s.file_type&&["wallet_ledger","wallet_summary","withdraws","orders"].includes(s.type)?Z.includes("admin")||Z.includes("finance"):!0}function xe(s){return A(s)?"下载文件":s.download_url?"权限不足，联系管理员开通":"文件尚未生成或已过期"}function se(s){!s||!A(s)||!s.download_url||(window.open(s.download_url,"_blank","noopener"),y("已打开下载链接。",!1))}async function Se(s){if(le(s)){n.retry=!0;try{const e=await V.retry(s.job_id);y(`已重新排队任务，新的任务号：${(e==null?void 0:e.new_job_id)||"未知"}`,!1),g(!1)}catch(e){y(e.message||"重试失败，请稍后重试。",!0)}finally{n.retry=!1}}}async function ze(s){if(ae(s)&&window.confirm(`确认取消任务 ${s.job_id} 吗？`)){n.cancel=!0;try{await V.cancel(s.job_id),y("任务已取消。",!1),g(!1),b.open&&b.jobId===s.job_id&&ee(s.job_id)}catch(e){y(e.message||"取消任务失败。",!0)}finally{n.cancel=!1}}}async function Te(){if(window.confirm("确认删除所有已过期的导出任务记录？")){n.deleteExpired=!0;try{const s=await V.deleteExpired(),e=typeof(s==null?void 0:s.deleted)=="number"?s.deleted:0;y(`已删除 ${e} 条过期任务。`,!1),g(!1)}catch(s){y(s.message||"删除过期任务失败。",!0)}finally{n.deleteExpired=!1}}}function le(s){return["failed","expired","canceled","ready"].includes(s.status)}function ae(s){return["queued","processing"].includes(s.status)}function y(s,e){S.message=s,S.error=e,s&&window.setTimeout(()=>{S.message===s&&(S.message="",S.error=!1)},e?5e3:3e3)}function Ee(){ne(),F.value=window.setInterval(()=>{w.value.some(e=>e.status==="queued"||e.status==="processing")&&g(!1)},5e3)}function ne(){F.value&&(window.clearInterval(F.value),F.value=null)}function $e(){return{start:a.start,end:a.end,status:a.status||void 0,type:a.type||void 0,created_by:a.createdBy||void 0,source:a.source||void 0,file_type:a.fileType||void 0,min_size:a.minSize?a.minSize*1024*1024:void 0,max_size:a.maxSize?a.maxSize*1024*1024:void 0,page:a.page,page_size:a.pageSize}}function Ce(s){const e=h(d);let o=0,m=0,N=0,q=0,l=0;s.forEach(z=>{if(z.created_at&&z.created_at.startsWith(e)&&(o+=1),z.status==="ready"&&(m+=1),z.status==="failed"&&(N+=1),z.created_at&&z.finished_at){const re=Ne(z.created_at,z.finished_at);re>=0&&(q+=re,l+=1)}});const j=l?`${Math.round(q/l*10)/10} 分钟`:"—";return{today:o,ready:m,failed:N,avgDuration:j}}function G(s){return{queued:"排队中",processing:"进行中",ready:"已完成",failed:"失败",canceled:"已取消",expired:"已过期"}[s]||s}function Ue(s){return K.reduce((o,m)=>(o[m.value]=m.label,o),{})[s]||s}function U(s){if(!s)return"—";const e=new Date(s);return Number.isNaN(e.getTime())?s:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function ie(s){if(!s||Number.isNaN(s))return"—";const e=s/(1024*1024);return e>=1024?`${(e/1024).toFixed(1)} GB`:`${e.toFixed(1)} MB`}function je(s){return s?JSON.stringify(s,null,2):"{}"}function De(s){var e;s.download_url&&((e=navigator.clipboard)==null||e.writeText(s.download_url).then(()=>y("下载链接已复制。",!1),()=>y("复制失败，请手动复制。",!0)))}function Be(s){var o;if(!s.download_url)return;const e=`curl -H "Authorization: Bearer mocktoken" "${s.download_url}" -o "${s.file_name||s.job_id}.csv"`;(o=navigator.clipboard)==null||o.writeText(e).then(()=>y("cURL 命令已复制。",!1),()=>y("复制失败，请手动复制。",!0))}function Y(s,e){const o=new Date(s);return o.setDate(o.getDate()+e),o}function h(s){const e=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0");return`${e}-${o}-${m}`}function Ne(s,e){const o=new Date(s).getTime(),m=new Date(e).getTime();return Number.isNaN(o)||Number.isNaN(m)||m<o?-1:(m-o)/6e4}return(s,e)=>{var o,m,N,q;return c(),_("section",Le,[t("header",He,[e[14]||(e[14]=t("div",null,[t("h1",{class:"exports-center__title"},"导出中心"),t("p",{class:"exports-center__subtitle"},"管理异步导出任务，追踪进度并下载结果。")],-1)),t("div",Xe,[E(C,{size:"sm",variant:"ghost",disabled:n.list,onClick:g},{default:f(()=>[...e[12]||(e[12]=[k("刷新",-1)])]),_:1},8,["disabled"]),E(C,{size:"sm",variant:"secondary",loading:n.deleteExpired,onClick:Te},{default:f(()=>[...e[13]||(e[13]=[k(" 删除已过期 ",-1)])]),_:1},8,["loading"])])]),t("section",Ge,[t("article",Ye,[e[15]||(e[15]=t("span",{class:"stats-card__label"},"今日发起",-1)),t("strong",We,i(I.value.today),1)]),t("article",Ke,[e[16]||(e[16]=t("span",{class:"stats-card__label"},"已完成",-1)),t("strong",Qe,i(I.value.ready),1)]),t("article",Ze,[e[17]||(e[17]=t("span",{class:"stats-card__label"},"失败",-1)),t("strong",et,i(I.value.failed),1)]),t("article",tt,[e[18]||(e[18]=t("span",{class:"stats-card__label"},"平均耗时",-1)),t("strong",st,i(I.value.avgDuration),1)])]),t("form",{class:"exports-center__filters",onSubmit:Re(be,["prevent"])},[t("fieldset",lt,[e[34]||(e[34]=t("legend",{class:"sr-only"},"筛选导出任务",-1)),t("div",at,[t("label",nt,[e[19]||(e[19]=t("span",null,"开始日期",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=l=>a.start=l),disabled:n.list},null,8,it),[[D,a.start]])]),t("label",rt,[e[20]||(e[20]=t("span",null,"结束日期",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=l=>a.end=l),disabled:n.list},null,8,ot),[[D,a.end]])]),t("label",dt,[e[22]||(e[22]=t("span",null,"状态",-1)),x(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.status=l),disabled:n.list},[e[21]||(e[21]=t("option",{value:""},"全部",-1)),(c(),_(L,null,H(pe,l=>t("option",{key:l.value,value:l.value},i(l.label),9,ct)),64))],8,ut),[[W,a.status]])]),t("label",pt,[e[24]||(e[24]=t("span",null,"类型",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.type=l),disabled:n.list},[e[23]||(e[23]=t("option",{value:""},"全部",-1)),(c(),_(L,null,H(K,l=>t("option",{key:l.value,value:l.value},i(l.label),9,ft)),64))],8,_t),[[W,a.type]])]),t("label",vt,[e[25]||(e[25]=t("span",null,"发起人",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>a.createdBy=l),placeholder:"用户 ID",disabled:n.list},null,8,bt),[[D,a.createdBy,void 0,{trim:!0}]])]),t("label",yt,[e[26]||(e[26]=t("span",null,"来源",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=l=>a.source=l),placeholder:"/orders",disabled:n.list},null,8,mt),[[D,a.source,void 0,{trim:!0}]])]),t("label",gt,[e[28]||(e[28]=t("span",null,"文件类型",-1)),x(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.fileType=l),disabled:n.list},[...e[27]||(e[27]=[Oe('<option value="" data-v-eb2c9bf1>全部</option><option value="csv" data-v-eb2c9bf1>CSV</option><option value="xlsx" data-v-eb2c9bf1>XLSX</option><option value="json" data-v-eb2c9bf1>JSON</option><option value="parquet" data-v-eb2c9bf1>Parquet</option>',5)])],8,wt),[[W,a.fileType]])]),t("label",kt,[e[29]||(e[29]=t("span",null,"最小大小(MB)",-1)),x(t("input",{type:"number",min:"0","onUpdate:modelValue":e[7]||(e[7]=l=>a.minSize=l),disabled:n.list},null,8,ht),[[D,a.minSize,void 0,{number:!0}]])]),t("label",xt,[e[30]||(e[30]=t("span",null,"最大大小(MB)",-1)),x(t("input",{type:"number",min:"0","onUpdate:modelValue":e[8]||(e[8]=l=>a.maxSize=l),disabled:n.list},null,8,St),[[D,a.maxSize,void 0,{number:!0}]])])]),t("div",zt,[t("div",Tt,[e[31]||(e[31]=t("span",null,"快速选择：",-1)),(c(),_(L,null,H(ce,l=>t("button",{key:l.value,type:"button",class:de(["quick-range__btn",{"is-active":X.value===l.value}]),disabled:n.list,onClick:j=>me(l.value)},i(l.label),11,Et)),64))]),t("div",$t,[E(C,{size:"sm",type:"submit",loading:n.list},{default:f(()=>[...e[32]||(e[32]=[k("应用",-1)])]),_:1},8,["loading"]),E(C,{size:"sm",variant:"ghost",type:"button",disabled:n.list,onClick:ye},{default:f(()=>[...e[33]||(e[33]=[k("重置",-1)])]),_:1},8,["disabled"])])])])],32),t("section",Ct,[E(Je,{columns:_e,rows:w.value,loading:n.list,"row-key":l=>l.job_id,"default-sort-key":"created_at","default-sort-order":"desc"},{"cell:status":f(({row:l})=>[t("span",{class:"status-chip","data-status":l.status},i(G(l.status)),9,Ut)]),"cell:progress":f(({row:l})=>[t("div",jt,[t("div",{class:"progress__bar",style:Fe({width:`${l.progress}%`})},null,4),t("span",null,i(l.progress)+"%",1)])]),"cell:file":f(({row:l})=>[t("div",Dt,[t("strong",null,i(l.file_name||"—"),1),l.file_size?(c(),_("span",Bt,i(ie(l.file_size)),1)):T("",!0),l.expires_at?(c(),_("span",Nt,"过期："+i(U(l.expires_at)),1)):T("",!0)])]),"cell:created_at":f(({row:l})=>[k(i(U(l.created_at)),1)]),"cell:finished_at":f(({row:l})=>[k(i(l.finished_at?U(l.finished_at):"—"),1)]),"cell:actions":f(({row:l})=>[t("div",qt,[t("button",{type:"button",class:"link-btn",onClick:j=>ke(l)},"详情",8,Pt),t("button",{type:"button",class:"link-btn",disabled:!A(l),onClick:j=>se(l),title:xe(l)}," 下载 ",8,Mt),t("button",{type:"button",class:"link-btn",disabled:!le(l),onClick:j=>Se(l)},"重试",8,Ot),t("button",{type:"button",class:"link-btn",disabled:!ae(l),onClick:j=>ze(l)},"取消",8,Rt)])]),empty:f(()=>[k(i(n.list?"加载任务中…":"暂无导出任务，尝试调整筛选条件。"),1)]),pagination:f(()=>[Q.value>1?(c(),Ve(Ae,{key:0,page:a.page,pages:Q.value,"page-size":a.pageSize,"onUpdate:page":ge,"onUpdate:pageSize":we},null,8,["page","pages","page-size"])):T("",!0)]),_:1},8,["rows","loading","row-key"])]),b.open?(c(),_("aside",Vt,[t("header",Ft,[t("div",null,[t("h2",null,"任务 "+i((o=r.value)==null?void 0:o.job_id),1),t("p",null,i(G(((m=r.value)==null?void 0:m.status)||"queued"))+" · "+i(U(((N=r.value)==null?void 0:N.created_at)||"")),1)]),t("button",{class:"job-drawer__close",type:"button","aria-label":"关闭详情",onClick:he},"×")]),n.detail?(c(),_("div",It,[...e[35]||(e[35]=[t("p",{class:"job-drawer__placeholder"},"详情加载中…",-1)])])):r.value?(c(),_("div",At,[t("section",Jt,[e[47]||(e[47]=t("h3",null,"任务信息",-1)),t("dl",Lt,[t("div",null,[e[36]||(e[36]=t("dt",null,"类型",-1)),t("dd",null,i(Ue(r.value.type)),1)]),t("div",null,[e[37]||(e[37]=t("dt",null,"状态",-1)),t("dd",null,[t("span",{class:"status-chip","data-status":r.value.status},i(G(r.value.status)),9,Ht)])]),t("div",null,[e[38]||(e[38]=t("dt",null,"进度",-1)),t("dd",null,i(r.value.progress)+"%",1)]),t("div",null,[e[39]||(e[39]=t("dt",null,"发起人",-1)),t("dd",null,i(r.value.created_by),1)]),t("div",null,[e[40]||(e[40]=t("dt",null,"来源",-1)),t("dd",null,i(r.value.source||"—"),1)]),t("div",null,[e[41]||(e[41]=t("dt",null,"完成时间",-1)),t("dd",null,i(r.value.finished_at?U(r.value.finished_at):"—"),1)]),t("div",null,[e[42]||(e[42]=t("dt",null,"文件",-1)),t("dd",null,i(r.value.file_name||"—"),1)]),t("div",null,[e[43]||(e[43]=t("dt",null,"大小",-1)),t("dd",null,i(r.value.file_size?ie(r.value.file_size):"—"),1)])]),t("div",Xt,[E(C,{size:"sm",variant:"primary",disabled:!A(r.value),onClick:e[9]||(e[9]=l=>se(r.value))},{default:f(()=>[...e[44]||(e[44]=[k(" 下载文件 ",-1)])]),_:1},8,["disabled"]),E(C,{size:"sm",variant:"secondary",disabled:!r.value.download_url,onClick:e[10]||(e[10]=l=>De(r.value))},{default:f(()=>[...e[45]||(e[45]=[k(" 复制下载链接 ",-1)])]),_:1},8,["disabled"]),E(C,{size:"sm",variant:"secondary",disabled:!r.value.download_url,onClick:e[11]||(e[11]=l=>Be(r.value))},{default:f(()=>[...e[46]||(e[46]=[k(" 复制 cURL ",-1)])]),_:1},8,["disabled"])])]),t("section",Gt,[e[48]||(e[48]=t("h3",null,"筛选参数",-1)),t("pre",Yt,i(je(r.value.params)),1)]),r.value.logs_tail?(c(),_("section",Wt,[e[49]||(e[49]=t("h3",null,"日志",-1)),t("pre",Kt,i(r.value.logs_tail),1)])):T("",!0),r.value.error?(c(),_("section",Qt,[e[50]||(e[50]=t("h3",null,"错误信息",-1)),t("p",Zt,i(r.value.error.code||"FAILED")+" · "+i(r.value.error.message||"无详细信息"),1)])):T("",!0),(q=r.value.downloads)!=null&&q.length?(c(),_("section",es,[e[51]||(e[51]=t("h3",null,"下载记录",-1)),t("ul",ts,[(c(!0),_(L,null,H(r.value.downloads,l=>(c(),_("li",{key:l.time},[t("span",null,i(U(l.time)),1),t("span",null,i(l.actor),1),t("span",null,i(l.channel||"-"),1),t("span",null,i(l.ip||"-"),1)]))),128))])])):T("",!0)])):(c(),_("div",ss,[...e[52]||(e[52]=[t("p",{class:"job-drawer__placeholder"},"未找到任务详情。",-1)])]))])):T("",!0),S.message?(c(),_("p",{key:1,class:de(["feedback",S.error?"feedback--error":""]),role:"alert"},i(S.message),3)):T("",!0)])}}}),os=Ie(ls,[["__scopeId","data-v-eb2c9bf1"]]);export{os as default};
