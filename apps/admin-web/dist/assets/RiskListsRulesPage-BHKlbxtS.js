import{d as de,r as p,a as F,o as _e,c as ce,b as r,q as u,e as t,A as y,f as T,i as _,j as P,F as D,h as U,t as a,v as S,B as n,s as v,k as ye,_ as re,E as fe}from"./index-DvtP9USg.js";import{B as k}from"./Button-BaguUGDy.js";import{M as oe}from"./Modal-CtEdl0zk.js";import{T as be}from"./Table-BsZuLW91.js";import{b as W,c as Y}from"./risk-DnqpjeeB.js";const ke={class:"lists-view"},ge={class:"lists-view__toolbar"},we={class:"filters",role:"search"},$e=["disabled"],he=["value"],Le=["disabled"],Ce=["value"],Ve={class:"filters__keyword"},Te=["disabled"],Re={class:"actions"},xe={class:"layout"},De={class:"table-card"},Ue=["data-type"],Se=["data-status"],Ne={key:0,class:"drawer"},Oe={class:"drawer__header"},Fe={class:"drawer__body"},Ie={class:"drawer-grid"},Me=["data-status"],ze={key:0,class:"drawer-section"},Ae={key:1,class:"drawer-section"},Ee={class:"history"},Pe={class:"history__time"},Be={class:"history__actor"},Je={key:0,class:"history__note"},je=["value"],qe=["value"],Ge=["value"],Qe={key:0,class:"dedup-body"},We={key:0,class:"feedback"},Ye={key:1,class:"feedback feedback--error"},He=de({__name:"ListsView",setup(ve){const I=[{list_id:"L202510030001",type:"blacklist",entity_type:"phone",entity_value:"13800000000",status:"active",source:"import",hit_count:42,expire_at:"2026-10-03T00:00:00+08:00",note:"高风险号码",created_at:"2025-10-03T08:00:00+08:00",updated_at:"2025-10-03T09:30:00+08:00"},{list_id:"L202510030002",type:"whitelist",entity_type:"store",entity_value:"STORE-001",status:"active",source:"manual",hit_count:3,note:"合作门店"},{list_id:"L202510020001",type:"greylist",entity_type:"device",entity_value:"DEV-9A7",status:"active",source:"api",hit_count:15,expire_at:"2025-12-31T00:00:00+08:00",note:"待观察设备"},{list_id:"L202509300001",type:"blacklist",entity_type:"id_number",entity_value:"4401***********1234",status:"archived",source:"import",hit_count:8,note:"人工审核归档"}],$={L202510030001:{...I[0],history:[{time:"2025-10-03T09:30:00+08:00",action:"review",actor:"林杉",note:"确认有效"},{time:"2025-10-03T08:00:00+08:00",action:"import",actor:"系统",note:"批量导入"}]}},Q=[{value:"blacklist",label:"黑名单"},{value:"whitelist",label:"白名单"},{value:"greylist",label:"灰名单"}],q=[{value:"phone",label:"手机号"},{value:"id_number",label:"证件号"},{value:"device",label:"设备"},{value:"ip",label:"IP"},{value:"store",label:"门店"},{value:"user",label:"用户"}],M=[{key:"entity_value",title:"主体值"},{key:"type",title:"名单类型",width:"6rem"},{key:"entity_type",title:"主体类型",width:"6rem"},{key:"status",title:"状态",width:"6rem"},{key:"source",title:"来源",width:"6rem"},{key:"hit_count",title:"命中次数",width:"6rem"},{key:"expire_at",title:"有效期",width:"10rem"}],w=p([]),N=p([]),c=p(!1),m=p(null),h=F({}),d=F({type:"",entity_type:"",keyword:""}),o=p(!1),z=p(!1),R=p(!1),C=p(!1),A=p(""),x=p(""),f=F({type:"blacklist",entity_type:"phone",entity_value:"",note:""}),V=F({type:"blacklist",file_name:""}),E=p(null),O=p(null);_e(()=>{H()});async function H(){c.value=!0;try{const l=await W.list(),e=Array.isArray(l==null?void 0:l.items)?l.items:[];w.value=e.length?e:I}catch(l){w.value=I,L(l.message||"加载名单失败")}finally{N.value=[...w.value],c.value=!1}}function B(){let l=[...w.value];if(d.type&&(l=l.filter(e=>e.type===d.type)),d.entity_type&&(l=l.filter(e=>e.entity_type===d.entity_type)),d.keyword){const e=d.keyword.toLowerCase();l=l.filter(g=>`${g.entity_value}${g.note??""}`.toLowerCase().includes(e))}N.value=l}function J(){d.type="",d.entity_type="",d.keyword="",B()}async function X(l){if(m.value=l.list_id,!h[l.list_id])try{const e=await W.getDetail(l.list_id);e?h[l.list_id]=e:$[l.list_id]&&(h[l.list_id]=$[l.list_id])}catch(e){$[l.list_id]?h[l.list_id]=$[l.list_id]:L(e.message||"加载详情失败")}}const b=ce(()=>m.value&&(h[m.value]||$[m.value])||null);function se(){f.type="blacklist",f.entity_type="phone",f.entity_value="",f.note="",o.value=!0}async function Z(){if(!f.entity_value.trim()){L("请填写主体值");return}C.value=!0;try{const l={...f};await W.create(l);const e={list_id:`LOCAL-${Date.now()}`,type:f.type,entity_type:f.entity_type,entity_value:f.entity_value.trim(),status:"active",source:"manual",note:f.note,hit_count:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};w.value.unshift(e),N.value.unshift(e),h[e.list_id]={...e},j("已创建名单条目"),o.value=!1}catch(l){L(l.message||"创建失败")}finally{C.value=!1}}function ae(){V.file_name="",V.type="blacklist",z.value=!0,E.value=null}async function ee(){if(!V.file_name.trim()){L("请填写文件名称");return}C.value=!0;try{const l=await W.import({file_name:V.file_name.trim(),type:V.type});E.value=l,j("导入任务已提交"),setTimeout(async()=>{const e=await W.getImportTask(l.task_id);E.value=e,j("导入完成")},1200),z.value=!1}catch(l){L(l.message||"导入失败")}finally{C.value=!1}}async function ie(){C.value=!0;try{const l=await W.previewDedup({sample:5});O.value=l,R.value=!0}catch(l){L(l.message||"去重预览失败")}finally{C.value=!1}}function te(l){if(!l)return"—";const e=new Date(l);return Number.isNaN(e.getTime())?l:e.toLocaleDateString()}function K(l){if(!l)return"—";const e=new Date(l);return Number.isNaN(e.getTime())?l:`${e.toLocaleDateString()} ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function G(l){return{blacklist:"黑名单",whitelist:"白名单",greylist:"灰名单"}[l]}function ne(l){return{phone:"手机号",id_number:"证件号",device:"设备",ip:"IP",store:"门店",user:"用户"}[l]}function le(l){return l==="active"?"启用":"已归档"}function ue(l){return{manual:"人工",import:"导入",api:"API"}[l]||l}function j(l){A.value=l,x.value="",window.setTimeout(()=>{A.value===l&&(A.value="")},3e3)}function L(l){x.value=l,window.setTimeout(()=>{x.value===l&&(x.value="")},4e3)}return(l,e)=>{var g;return u(),r("section",ke,[t("header",ge,[t("div",we,[t("label",null,[e[20]||(e[20]=t("span",null,"名单类型",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.type=s),disabled:c.value},[e[19]||(e[19]=t("option",{value:""},"全部",-1)),(u(),r(D,null,U(Q,s=>t("option",{key:s.value,value:s.value},a(s.label),9,he)),64))],8,$e),[[P,d.type]])]),t("label",null,[e[22]||(e[22]=t("span",null,"主体类型",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.entity_type=s),disabled:c.value},[e[21]||(e[21]=t("option",{value:""},"全部",-1)),(u(),r(D,null,U(q,s=>t("option",{key:s.value,value:s.value},a(s.label),9,Ce)),64))],8,Le),[[P,d.entity_type]])]),t("label",Ve,[e[23]||(e[23]=t("span",null,"关键词",-1)),_(t("input",{type:"search","onUpdate:modelValue":e[2]||(e[2]=s=>d.keyword=s),disabled:c.value,placeholder:"主体值 / 备注"},null,8,Te),[[S,d.keyword,void 0,{trim:!0}]])]),y(k,{size:"sm",disabled:c.value,onClick:B},{default:n(()=>[...e[24]||(e[24]=[v("筛选",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"ghost",disabled:c.value,onClick:J},{default:n(()=>[...e[25]||(e[25]=[v("重置",-1)])]),_:1},8,["disabled"])]),t("div",Re,[y(k,{size:"sm",variant:"secondary",onClick:se},{default:n(()=>[...e[26]||(e[26]=[v("新建条目",-1)])]),_:1}),y(k,{size:"sm",variant:"secondary",onClick:ae},{default:n(()=>[...e[27]||(e[27]=[v("批量导入",-1)])]),_:1}),y(k,{size:"sm",variant:"ghost",onClick:ie},{default:n(()=>[...e[28]||(e[28]=[v("去重预览",-1)])]),_:1})])]),t("div",xe,[t("section",De,[y(be,{columns:M,rows:N.value,loading:c.value,"row-key":s=>s.list_id,"default-sort-key":"created_at","default-sort-order":"desc",onRowClick:X},{"cell:type":n(({row:s})=>[t("span",{class:"type-chip","data-type":s.type},a(G(s.type)),9,Ue)]),"cell:status":n(({row:s})=>[t("span",{class:"status-chip","data-status":s.status},a(le(s.status)),9,Se)]),"cell:hit_count":n(({row:s})=>[v(a(s.hit_count??0),1)]),"cell:expire_at":n(({row:s})=>[v(a(te(s.expire_at)),1)]),empty:n(()=>[v(a(c.value?"加载中…":"暂无名单"),1)]),_:1},8,["rows","loading","row-key"])]),b.value?(u(),r("aside",Ne,[t("header",Oe,[t("div",null,[t("h2",null,a(b.value.entity_value),1),t("p",null,a(G(b.value.type))+" · "+a(ne(b.value.entity_type)),1)]),t("button",{type:"button",class:"drawer__close","aria-label":"关闭",onClick:e[3]||(e[3]=s=>m.value=null)},"×")]),t("div",Fe,[t("dl",Ie,[t("div",null,[e[29]||(e[29]=t("dt",null,"状态",-1)),t("dd",null,[t("span",{class:"status-chip","data-status":b.value.status},a(le(b.value.status)),9,Me)])]),t("div",null,[e[30]||(e[30]=t("dt",null,"来源",-1)),t("dd",null,a(ue(b.value.source)),1)]),t("div",null,[e[31]||(e[31]=t("dt",null,"命中次数",-1)),t("dd",null,a(b.value.hit_count??0),1)]),t("div",null,[e[32]||(e[32]=t("dt",null,"有效期",-1)),t("dd",null,a(te(b.value.expire_at)),1)]),t("div",null,[e[33]||(e[33]=t("dt",null,"创建时间",-1)),t("dd",null,a(K(b.value.created_at)),1)]),t("div",null,[e[34]||(e[34]=t("dt",null,"更新时间",-1)),t("dd",null,a(K(b.value.updated_at)),1)])]),b.value.note?(u(),r("section",ze,[e[35]||(e[35]=t("h3",null,"备注",-1)),t("p",null,a(b.value.note),1)])):T("",!0),(g=b.value.history)!=null&&g.length?(u(),r("section",Ae,[e[36]||(e[36]=t("h3",null,"历史记录",-1)),t("ul",Ee,[(u(!0),r(D,null,U(b.value.history,s=>(u(),r("li",{key:s.time},[t("span",Pe,a(K(s.time)),1),t("span",Be,a(s.actor),1),t("span",null,a(s.action),1),s.note?(u(),r("span",Je,a(s.note),1)):T("",!0)]))),128))])])):T("",!0)])])):T("",!0)]),y(oe,{modelValue:o.value,"onUpdate:modelValue":e[10]||(e[10]=s=>o.value=s),onConfirm:Z},{title:n(()=>[...e[37]||(e[37]=[v("新建名单条目",-1)])]),footer:n(()=>[y(k,{variant:"secondary",onClick:e[9]||(e[9]=s=>o.value=!1),disabled:C.value},{default:n(()=>[...e[42]||(e[42]=[v("取消",-1)])]),_:1},8,["disabled"]),y(k,{variant:"primary",loading:C.value,onClick:Z},{default:n(()=>[...e[43]||(e[43]=[v("保存",-1)])]),_:1},8,["loading"])]),default:n(()=>[t("form",{class:"modal-form",onSubmit:e[8]||(e[8]=ye(()=>{},["prevent"]))},[t("label",null,[e[38]||(e[38]=t("span",null,"名单类型",-1)),_(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>f.type=s)},[(u(),r(D,null,U(Q,s=>t("option",{key:s.value,value:s.value},a(s.label),9,je)),64))],512),[[P,f.type]])]),t("label",null,[e[39]||(e[39]=t("span",null,"主体类型",-1)),_(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>f.entity_type=s)},[(u(),r(D,null,U(q,s=>t("option",{key:s.value,value:s.value},a(s.label),9,qe)),64))],512),[[P,f.entity_type]])]),t("label",null,[e[40]||(e[40]=t("span",null,"主体值",-1)),_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>f.entity_value=s),placeholder:"如 13800000000"},null,512),[[S,f.entity_value,void 0,{trim:!0}]])]),t("label",null,[e[41]||(e[41]=t("span",null,"备注",-1)),_(t("textarea",{rows:"3","onUpdate:modelValue":e[7]||(e[7]=s=>f.note=s),placeholder:"可选"},null,512),[[S,f.note,void 0,{trim:!0}]])])],32)]),_:1},8,["modelValue"]),y(oe,{modelValue:z.value,"onUpdate:modelValue":e[15]||(e[15]=s=>z.value=s),onConfirm:ee},{title:n(()=>[...e[44]||(e[44]=[v("批量导入名单",-1)])]),footer:n(()=>[y(k,{variant:"secondary",onClick:e[14]||(e[14]=s=>z.value=!1),disabled:C.value},{default:n(()=>[...e[47]||(e[47]=[v("取消",-1)])]),_:1},8,["disabled"]),y(k,{variant:"primary",loading:C.value,onClick:ee},{default:n(()=>[...e[48]||(e[48]=[v("上传",-1)])]),_:1},8,["loading"])]),default:n(()=>[t("form",{class:"modal-form",onSubmit:e[13]||(e[13]=ye(()=>{},["prevent"]))},[t("label",null,[e[45]||(e[45]=t("span",null,"文件名称",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=s=>V.file_name=s),placeholder:"blacklist.csv"},null,512),[[S,V.file_name,void 0,{trim:!0}]])]),t("label",null,[e[46]||(e[46]=t("span",null,"名单类型",-1)),_(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>V.type=s)},[(u(),r(D,null,U(Q,s=>t("option",{key:s.value,value:s.value},a(s.label),9,Ge)),64))],512),[[P,V.type]])])],32)]),_:1},8,["modelValue"]),y(oe,{modelValue:R.value,"onUpdate:modelValue":e[17]||(e[17]=s=>R.value=s),onConfirm:e[18]||(e[18]=()=>R.value=!1)},{title:n(()=>[...e[49]||(e[49]=[v("去重预览",-1)])]),footer:n(()=>[y(k,{variant:"primary",onClick:e[16]||(e[16]=s=>R.value=!1)},{default:n(()=>[...e[50]||(e[50]=[v("关闭",-1)])]),_:1})]),default:n(()=>[O.value?(u(),r("section",Qe,[t("h4",null,"重复 "+a(O.value.duplicates.length)+" 项",1),t("ul",null,[(u(!0),r(D,null,U(O.value.duplicates,s=>(u(),r("li",{key:s.entity_value},a(s.entity_value)+" · 已存在（"+a(G(s.type))+"） ",1))),128))]),t("h4",null,"冲突 "+a(O.value.conflicts.length)+" 项",1),t("ul",null,[(u(!0),r(D,null,U(O.value.conflicts,s=>(u(),r("li",{key:s.entity_value},a(s.entity_value)+" · 已在 "+a(G(s.existing_type))+"，导入为 "+a(G(s.new_type)),1))),128))])])):T("",!0)]),_:1},8,["modelValue"]),A.value?(u(),r("p",We,a(A.value),1)):T("",!0),x.value?(u(),r("p",Ye,a(x.value),1)):T("",!0)])}}}),Ke=re(He,[["__scopeId","data-v-02137f2e"]]),Xe={class:"rules-view"},Ze={class:"rules-view__toolbar"},et={class:"filters",role:"search"},tt=["disabled"],lt=["value"],st=["disabled"],at=["value"],it={class:"filters__keyword"},nt=["disabled"],ut={class:"actions"},ot={class:"layout"},dt={class:"table-card"},rt=["data-status"],vt=["data-level"],pt={key:0,class:"editor"},mt={class:"editor__header"},yt={class:"editor__body"},ft={class:"editor-group"},_t={class:"editor-grid"},ct=["value"],bt={class:"editor-group"},kt={class:"editor-group"},gt={class:"simulate-form"},wt={key:0,class:"simulate-result"},$t={class:"editor-group"},ht={class:"publish-form"},Lt={key:0,class:"hint"},Ct={class:"editor-group"},Vt={class:"replay-form"},Tt={key:0,class:"hint"},Rt={class:"editor__footer"},xt={key:0,class:"feedback"},Dt={key:1,class:"feedback feedback--error"},Ut=de({__name:"RulesView",setup(ve){const I=[{rule_id:"R2025100301",code:"GEOFENCE_OUT",name:"越界地理围栏",level:"high",status:"published",version:12,weight:1.2,threshold:80,package:"geo",hit_7d:128,updated_by:"林杉",updated_at:"2025-10-03T09:20:00+08:00"},{rule_id:"R2025100201",code:"FREQ_APPLY",name:"短期高频提交",level:"medium",status:"draft",version:3,weight:1,threshold:65,package:"behavior",hit_7d:76,updated_by:"朱敏",updated_at:"2025-10-02T18:00:00+08:00"}],$={R2025100301:{...I[0],expr:"distance_to_store_km > 10 AND device_recent_orders_24h > 3",datasource_map:{distance_to_store_km:"geo.distance",device_recent_orders_24h:"device.orders_24h"},changelog:"调整阈值至 80，新增距门店条件",simulations:[{simulation_id:"SIM-20251003-01",dataset:"last_7d",metrics:{precision:.86,recall:.72,coverage:.35,hit_count:128},created_at:"2025-10-03T09:05:00+08:00"}],versions:[{version:12,updated_at:"2025-10-03T09:20:00+08:00",comment:"灰度 20% 发布"},{version:11,updated_at:"2025-09-28T18:00:00+08:00",comment:"修复距离计算"}]}},Q=[{key:"code",title:"编码",width:"8rem"},{key:"name",title:"名称"},{key:"level",title:"等级",width:"6rem"},{key:"status",title:"状态",width:"7rem"},{key:"version",title:"版本",width:"6rem"},{key:"hit_7d",title:"近 7 日命中",width:"7rem"},{key:"updated_at",title:"更新时间",width:"10rem"}],q=[{value:"draft",label:"草稿"},{value:"published",label:"已发布"},{value:"offline",label:"已下线"},{value:"deprecated",label:"已废弃"}],M=[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"},{value:"critical",label:"致命"}],w=p([]),N=p([]),c=p(!1),m=p(null),h=F({}),d=F({status:"",level:"",keyword:""}),o=F({}),z=F({dataset:"last_7d"}),R=p(null),C=p(!1),A=F({percent:20}),x=p(null),f=p(!1),V=F({range:"2025-09-20~2025-09-30"}),E=p(null),O=p(!1),H=p(!1),B=p(""),J=p("");_e(()=>{X()});async function X(){c.value=!0;try{const l=await Y.list(),e=Array.isArray(l==null?void 0:l.items)?l.items:[];w.value=e.length?e:I}catch(l){w.value=I,L(l.message||"加载规则失败")}finally{N.value=[...w.value],c.value=!1}}function b(){let l=[...w.value];if(d.status&&(l=l.filter(e=>e.status===d.status)),d.level&&(l=l.filter(e=>e.level===d.level)),d.keyword){const e=d.keyword.toLowerCase();l=l.filter(g=>`${g.code}${g.name}`.toLowerCase().includes(e))}N.value=l}function se(){d.status="",d.level="",d.keyword="",b()}async function Z(l){if(m.value=l.rule_id,!h[l.rule_id])try{const g=await Y.getDetail(l.rule_id);h[l.rule_id]=g||$[l.rule_id]||l}catch(g){$[l.rule_id]?h[l.rule_id]=$[l.rule_id]:(h[l.rule_id]=l,L(g.message||"加载规则详情失败"))}const e=h[l.rule_id]||$[l.rule_id]||l;Object.assign(o,JSON.parse(JSON.stringify(e))),R.value=null,x.value=null,E.value=null}const ae=ce(()=>m.value&&(h[m.value]||$[m.value])||null);function ee(){const l={rule_id:`LOCAL-${Date.now()}`,code:"",name:"",level:"medium",status:"draft",version:1,weight:1,threshold:60};h[l.rule_id]=l,w.value=[l,...w.value],N.value=[l,...N.value],m.value=l.rule_id,Object.assign(o,JSON.parse(JSON.stringify(l)))}async function ie(){if(m.value){if(!o.code||!o.name){L("请填写规则编码和名称");return}H.value=!0;try{const l=await Y.save(m.value.startsWith("LOCAL")?null:m.value,{code:o.code,name:o.name,level:o.level,weight:o.weight,threshold:o.threshold,expr:o.expr});h[m.value]=l;const e=w.value.findIndex(g=>g.rule_id===m.value);e>=0&&w.value.splice(e,1,l),N.value=[...w.value],j("已保存草稿")}catch(l){L(l.message||"保存失败")}finally{H.value=!1}}}async function te(){if(m.value){C.value=!0;try{const l=await Y.simulate(m.value,{dataset:z.dataset});R.value=l,j("仿真完成")}catch(l){L(l.message||"仿真失败")}finally{C.value=!1}}}async function K(){if(m.value){f.value=!0;try{const l=await Y.publish(m.value,{mode:"gray",percent:A.percent});x.value=l,j("发布任务已创建")}catch(l){L(l.message||"发布失败")}finally{f.value=!1}}}async function G(){if(m.value){O.value=!0;try{const l=await Y.replay(m.value,{range:V.range});E.value=l,j("回放任务已创建")}catch(l){L(l.message||"回放失败")}finally{O.value=!1}}}function ne(l){return{draft:"草稿",published:"已发布",offline:"已下线",deprecated:"已废弃"}[l]||l}function le(l){return{low:"低",medium:"中",high:"高",critical:"致命"}[l]||l}function ue(l){if(!l)return"—";const e=new Date(l);return Number.isNaN(e.getTime())?l:`${e.toLocaleDateString()} ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function j(l){B.value=l,J.value="",window.setTimeout(()=>{B.value===l&&(B.value="")},3e3)}function L(l){J.value=l,window.setTimeout(()=>{J.value===l&&(J.value="")},4e3)}return(l,e)=>{var g,s,pe,me;return u(),r("section",Xe,[t("header",Ze,[t("div",et,[t("label",null,[e[14]||(e[14]=t("span",null,"状态",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>d.status=i),disabled:c.value},[e[13]||(e[13]=t("option",{value:""},"全部",-1)),(u(),r(D,null,U(q,i=>t("option",{key:i.value,value:i.value},a(i.label),9,lt)),64))],8,tt),[[P,d.status]])]),t("label",null,[e[16]||(e[16]=t("span",null,"等级",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>d.level=i),disabled:c.value},[e[15]||(e[15]=t("option",{value:""},"全部",-1)),(u(),r(D,null,U(M,i=>t("option",{key:i.value,value:i.value},a(i.label),9,at)),64))],8,st),[[P,d.level]])]),t("label",it,[e[17]||(e[17]=t("span",null,"关键词",-1)),_(t("input",{type:"search","onUpdate:modelValue":e[2]||(e[2]=i=>d.keyword=i),placeholder:"编码 / 名称",disabled:c.value},null,8,nt),[[S,d.keyword,void 0,{trim:!0}]])]),y(k,{size:"sm",disabled:c.value,onClick:b},{default:n(()=>[...e[18]||(e[18]=[v("筛选",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"ghost",disabled:c.value,onClick:se},{default:n(()=>[...e[19]||(e[19]=[v("重置",-1)])]),_:1},8,["disabled"])]),t("div",ut,[y(k,{size:"sm",variant:"secondary",onClick:ee},{default:n(()=>[...e[20]||(e[20]=[v("新建规则",-1)])]),_:1}),y(k,{size:"sm",variant:"ghost",onClick:X},{default:n(()=>[...e[21]||(e[21]=[v("刷新",-1)])]),_:1})])]),t("div",ot,[t("section",dt,[y(be,{columns:Q,rows:N.value,loading:c.value,"row-key":i=>i.rule_id,"default-sort-key":"updated_at","default-sort-order":"desc",onRowClick:Z},{"cell:status":n(({row:i})=>[t("span",{class:"status-chip","data-status":i.status},a(ne(i.status)),9,rt)]),"cell:level":n(({row:i})=>[t("span",{class:"level-chip","data-level":i.level},a(le(i.level)),9,vt)]),"cell:updated_at":n(({row:i})=>[v(a(ue(i.updated_at)),1)]),empty:n(()=>[v(a(c.value?"加载中…":"暂无规则"),1)]),_:1},8,["rows","loading","row-key"])]),ae.value&&o?(u(),r("aside",pt,[t("header",mt,[t("div",null,[t("h2",null,a(o.name||"新建规则"),1),t("p",null,a(o.code)+" · 版本 "+a(o.version),1)]),t("button",{type:"button",class:"editor__close","aria-label":"关闭",onClick:e[3]||(e[3]=i=>m.value=null)},"×")]),t("div",yt,[t("section",ft,[e[27]||(e[27]=t("h3",null,"基本信息",-1)),t("div",_t,[t("label",null,[e[22]||(e[22]=t("span",null,"规则编码",-1)),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.code=i),placeholder:"唯一编码"},null,512),[[S,o.code,void 0,{trim:!0}]])]),t("label",null,[e[23]||(e[23]=t("span",null,"规则名称",-1)),_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>o.name=i),placeholder:"规则名称"},null,512),[[S,o.name,void 0,{trim:!0}]])]),t("label",null,[e[24]||(e[24]=t("span",null,"等级",-1)),_(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.level=i)},[(u(),r(D,null,U(M,i=>t("option",{key:i.value,value:i.value},a(i.label),9,ct)),64))],512),[[P,o.level]])]),t("label",null,[e[25]||(e[25]=t("span",null,"权重",-1)),_(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=i=>o.weight=i),step:"0.1"},null,512),[[S,o.weight,void 0,{number:!0}]])]),t("label",null,[e[26]||(e[26]=t("span",null,"阈值",-1)),_(t("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=i=>o.threshold=i)},null,512),[[S,o.threshold,void 0,{number:!0}]])])])]),t("section",bt,[e[28]||(e[28]=t("h3",null,"规则逻辑",-1)),_(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=i=>o.expr=i),rows:"6",class:"dsl-input",placeholder:"编写 DSL 或逻辑描述"},null,512),[[S,o.expr]])]),t("section",kt,[e[32]||(e[32]=t("h3",null,"仿真测试",-1)),t("div",gt,[t("label",null,[e[30]||(e[30]=t("span",null,"样本集",-1)),_(t("select",{"onUpdate:modelValue":e[10]||(e[10]=i=>z.dataset=i)},[...e[29]||(e[29]=[t("option",{value:"last_7d"},"近 7 天",-1),t("option",{value:"last_30d"},"近 30 天",-1),t("option",{value:"custom"},"自定义",-1)])],512),[[P,z.dataset]])]),y(k,{size:"sm",loading:C.value,onClick:te},{default:n(()=>[...e[31]||(e[31]=[v("仿真",-1)])]),_:1},8,["loading"])]),R.value?(u(),r("div",wt,[t("p",null,"Precision: "+a(((g=R.value.metrics)==null?void 0:g.precision)??"-"),1),t("p",null,"Recall: "+a(((s=R.value.metrics)==null?void 0:s.recall)??"-"),1),t("p",null,"Coverage: "+a(((pe=R.value.metrics)==null?void 0:pe.coverage)??"-"),1)])):T("",!0)]),t("section",$t,[e[35]||(e[35]=t("h3",null,"灰度发布",-1)),t("div",ht,[t("label",null,[e[33]||(e[33]=t("span",null,"灰度比例 (%)",-1)),_(t("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=i=>A.percent=i),min:"0",max:"100"},null,512),[[S,A.percent,void 0,{number:!0}]])]),y(k,{size:"sm",loading:f.value,onClick:K},{default:n(()=>[...e[34]||(e[34]=[v("发布",-1)])]),_:1},8,["loading"])]),x.value?(u(),r("p",Lt,"已发布：部署 "+a(x.value.deployment_id)+"，灰度 "+a(x.value.percent??0)+"%",1)):T("",!0)]),t("section",Ct,[e[38]||(e[38]=t("h3",null,"历史回放",-1)),t("div",Vt,[t("label",null,[e[36]||(e[36]=t("span",null,"时间窗口",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=i=>V.range=i),placeholder:"例如 2025-09-20~2025-09-30"},null,512),[[S,V.range,void 0,{trim:!0}]])]),y(k,{size:"sm",loading:O.value,onClick:G},{default:n(()=>[...e[37]||(e[37]=[v("发起回放",-1)])]),_:1},8,["loading"])]),E.value?(u(),r("p",Tt,"回放 "+a(E.value.replay_id)+" 成功，命中增量："+a(((me=E.value.delta_metrics)==null?void 0:me.hit_count)??0),1)):T("",!0)])]),t("footer",Rt,[y(k,{size:"sm",variant:"primary",loading:H.value,onClick:ie},{default:n(()=>[...e[39]||(e[39]=[v("保存草稿",-1)])]),_:1},8,["loading"])])])):T("",!0)]),B.value?(u(),r("p",xt,a(B.value),1)):T("",!0),J.value?(u(),r("p",Dt,a(J.value),1)):T("",!0)])}}}),St=re(Ut,[["__scopeId","data-v-eb5655de"]]),Nt={class:"risk-config"},Ot={class:"risk-config__header"},Ft={class:"risk-config__tabs",role:"tablist"},It=["data-active","onClick"],Mt=de({__name:"RiskListsRulesPage",setup(ve){const I=[{value:"lists",label:"名单"},{value:"rules",label:"规则"}],$=p("lists");return(Q,q)=>(u(),r("section",Nt,[t("header",Ot,[q[0]||(q[0]=t("div",null,[t("h1",{class:"risk-config__title"},"黑白名单与规则"),t("p",{class:"risk-config__subtitle"},"维护名单库与规则策略，支持导入、仿真与灰度发布。")],-1)),t("nav",Ft,[(u(),r(D,null,U(I,M=>t("button",{key:M.value,type:"button",class:"risk-config__tab","data-active":$.value===M.value,role:"tab",onClick:w=>$.value=M.value},a(M.label),9,It)),64))])]),$.value==="lists"?(u(),fe(Ke,{key:0})):(u(),fe(St,{key:1}))]))}}),Jt=re(Mt,[["__scopeId","data-v-fd408dd8"]]);export{Jt as default};
