import{O as Ne,d as dt,a as te,r as g,c as de,w as ct,b as o,e,f as _,t as i,i as v,j as se,F as U,h as $,v as V,k as pt,s as k,y as Q,q as r,_ as vt}from"./index-DvtP9USg.js";function z(){return{"Content-Type":"application/json",...Ne.HEADERS||{}}}function L(m,f){var X;const w=((X=Ne.BASE)==null?void 0:X.replace(/\/$/,""))||"";if(!f)return`${w}${m}`;const j=new URLSearchParams;Object.entries(f).forEach(([le,M])=>{if(!(M==null||M===""))if(Array.isArray(M)){if(!M.length)return;j.append(le,M.join(","))}else j.append(le,String(M))});const G=j.toString();return G?`${w}${m}?${G}`:`${w}${m}`}async function A(m,f){const w=await fetch(m,f);if(!w.ok){const j=await w.text();throw new Error(j||`Request failed with ${w.status}`)}if(w.status!==204)return await w.json()}const E={async listCampaigns(m){const f=L("/api/v1/campaigns",m);return A(f,{method:"GET",headers:z()})},async getCampaign(m){const f=L(`/api/v1/campaigns/${encodeURIComponent(m)}`);return A(f,{method:"GET",headers:z()})},async createCampaign(m){const f=L("/api/v1/campaigns");return A(f,{method:"POST",headers:z(),body:JSON.stringify(m)})},async updateCampaign(m,f){const w=L(`/api/v1/campaigns/${encodeURIComponent(m)}`);return A(w,{method:"PUT",headers:z(),body:JSON.stringify(f)})},async publishCampaign(m){const f=L(`/api/v1/campaigns/${encodeURIComponent(m)}/publish`);return A(f,{method:"POST",headers:z()})},async offlineCampaign(m,f){const w=L(`/api/v1/campaigns/${encodeURIComponent(m)}/offline`);return A(w,{method:"POST",headers:z(),body:JSON.stringify({reason:f})})},async cloneCampaign(m){const f=L(`/api/v1/campaigns/${encodeURIComponent(m)}/clone`);return A(f,{method:"POST",headers:z()})},async exportCampaigns(m){const f=L("/api/v1/exports/campaigns");return A(f,{method:"POST",headers:z(),body:JSON.stringify(m)})}},mt={class:"campaigns"},ft={class:"campaigns__head"},_t={class:"campaigns__actions"},bt=["disabled"],yt=["disabled"],ht={class:"filters__row"},gt={class:"filters__field"},kt=["value"],wt={class:"filters__field"},Ct=["value"],St={class:"filters__field"},Ut=["value"],$t={class:"filters__field filters__field--keyword"},Vt={class:"filters__field"},Ot={class:"filters__field"},xt={class:"filters__actions"},Dt=["disabled"],Nt=["disabled"],Pt={class:"campaigns__table"},Tt={key:0},Et={key:1},Ft=["onClick"],jt=["data-status"],Mt={class:"metric"},It={class:"metric"},Rt={class:"metric"},qt={class:"col-actions"},Jt={class:"row-actions"},zt=["onClick","disabled"],Lt=["onClick","disabled"],At=["onClick","disabled"],Bt=["onClick","disabled"],Zt={key:2},Ht={key:0,class:"campaigns__pager"},Gt=["disabled"],Wt=["disabled"],Kt={class:"pager__size"},Qt=["value"],Xt=["value"],Yt={key:1,class:"feedback feedback--error"},es={key:2,class:"feedback"},ts={key:3,class:"campaigns-drawer"},ss={class:"campaigns-drawer__panel",role:"dialog","aria-modal":"true"},ls={class:"campaigns-drawer__header"},ns={class:"drawer-title"},as=["data-status"],is={class:"drawer-actions"},os=["disabled"],rs=["disabled"],us=["disabled"],ds={class:"campaigns-drawer__steps"},cs=["data-active","disabled","onClick"],ps={class:"drawer-step__index"},vs={class:"campaigns-drawer__body"},ms={key:0,class:"step-block"},fs={class:"form-grid"},_s=["data-error"],bs=["disabled"],ys={key:0,class:"form-error"},hs=["data-error"],gs=["disabled"],ks={key:0,class:"form-error"},ws=["data-error"],Cs=["disabled"],Ss=["data-error"],Us=["disabled"],$s={key:0,class:"form-error"},Vs=["data-error"],Os=["disabled"],xs={key:0,class:"form-error"},Ds=["data-error"],Ns={class:"checkbox-group"},Ps=["value","disabled"],Ts={key:0,class:"form-error"},Es={class:"form-field full"},Fs={class:"checkbox-group"},js=["value","disabled"],Ms={class:"form-field form-field--switch"},Is=["disabled"],Rs={key:1,class:"step-block"},qs={class:"plans-head"},Js=["disabled"],zs={key:0,class:"form-error"},Ls={key:1,class:"empty"},As=["data-error"],Bs={class:"plan-card__top"},Zs=["onClick","disabled"],Hs={class:"form-grid"},Gs={class:"form-field"},Ws=["onUpdate:modelValue","disabled"],Ks={class:"form-field"},Qs=["onUpdate:modelValue","disabled"],Xs={class:"form-field"},Ys=["value","onChange","disabled"],el={key:0,class:"form-field"},tl=["onUpdate:modelValue","disabled"],sl={key:1,class:"form-field"},ll=["onUpdate:modelValue","disabled"],nl={key:0,class:"tiers"},al={class:"form-field"},il=["onUpdate:modelValue","disabled"],ol={class:"form-field"},rl=["onUpdate:modelValue","disabled"],ul=["onClick","disabled"],dl=["onClick","disabled"],cl={class:"form-field"},pl=["value","onInput","disabled"],vl={key:1,class:"form-error"},ml={key:2,class:"step-block"},fl=["data-error"],_l={class:"checkbox-group"},bl=["value","disabled"],yl=["data-error"],hl={class:"checkbox-group"},gl=["value","disabled"],kl=["data-error"],wl={class:"checkbox-group checkbox-group--columns"},Cl=["value","disabled"],Sl={key:0,class:"form-error"},Ul={key:3,class:"step-block"},$l={class:"form-grid"},Vl=["data-error"],Ol=["disabled"],xl={class:"form-field"},Dl=["disabled"],Nl={key:0,class:"form-error"},Pl={key:4,class:"step-block"},Tl={class:"preview"},El={class:"preview-list"},Fl={class:"campaigns-drawer__footer"},jl=["disabled"],Ml=["disabled"],Il=["disabled"],Rl={key:4,class:"offline-modal"},ql={class:"offline-modal__panel",role:"dialog","aria-modal":"true"},Jl={key:0,class:"form-error"},zl=["disabled"],Ll=dt({__name:"CampaignsPage",setup(m){const f=[{value:"draft",label:"草稿"},{value:"published",label:"已发布"},{value:"offline",label:"已下架"},{value:"ended",label:"已结束"}],w={draft:"草稿",published:"已发布",offline:"已下架",ended:"已结束"},j=[{value:"GZ",label:"广州"},{value:"SZ",label:"深圳"},{value:"FS",label:"佛山"},{value:"DG",label:"东莞"}],G=[{value:"wechat",label:"微信"},{value:"h5",label:"H5"},{value:"scan",label:"扫码"},{value:"api",label:"API"}],X=[{value:"operator",label:"运营人员"},{value:"promoter",label:"推广人员"},{value:"store_owner",label:"门店负责人"}],le=["华南事业部","华中事业部","华北事业部"],M=[{value:"S001",label:"S001 天河路旗舰店"},{value:"S002",label:"S002 海珠江畔店"},{value:"SZ101",label:"SZ101 福田中心店"},{value:"FS001",label:"FS001 禅城一店"},{value:"FS002",label:"FS002 顺德乐从店"}],R=[{key:"basic",label:"基础信息"},{key:"plans",label:"套餐配置"},{key:"scope",label:"适用范围"},{key:"rules",label:"规则策略"},{key:"preview",label:"预览"}],u=te({status:"",city:"",channel:"",keyword:"",page:1,page_size:10,sort_key:"start_time",sort_order:"desc"}),ne=g([]),ce=g(0),I=g(!1),b=g(!1),ae=g(!1),C=g(""),N=g(""),Pe=[10,20,50],W=g(!1),S=g("create"),B=g(!1),y=g(0),P=te(R.map((l,t)=>t===0)),O=g("draft"),h=g(null),n=te({name:"",code:"",desc:"",start_time:"",end_time:"",channels:[],visible_to_roles:[],require_invite:!1,plans:[],scope:{companies:[],cities:[],stores:[]},form_dsl_id:"",risk_policy_id:""}),p=te({name:"",code:"",desc:"",start_time:"",end_time:"",channels:""}),T=te({}),q=g(""),K=g(""),Y=g(!1),Z=g(""),H=g(""),Te=de(()=>S.value==="create"?"新建活动":S.value==="edit"?"编辑活动":"活动详情"),ie=de(()=>u.page_size?Math.max(1,Math.ceil(ce.value/u.page_size)):1),oe=de(()=>R[y.value]),c=de(()=>S.value==="view");function be(l){return w[l]||l}function pe(l){return l==="draft"||l==="offline"}function ve(l){return l==="draft"||l==="offline"}function Ee(){n.name="",n.code="",n.desc="",n.start_time="",n.end_time="",n.channels=[],n.visible_to_roles=[],n.require_invite=!1,n.plans=[],n.scope.companies=[],n.scope.cities=[],n.scope.stores=[],n.form_dsl_id="",n.risk_policy_id=""}function ye(l){var t,s,a;n.name=l.name||"",n.code=l.code||"",n.desc=l.desc||"",n.start_time=l.start_time?l.start_time.slice(0,16):"",n.end_time=l.end_time?l.end_time.slice(0,16):"",n.channels=[...l.channels||[]],n.visible_to_roles=l.visible_to_roles?[...l.visible_to_roles]:[],n.require_invite=!!l.require_invite,n.plans=l.plans?l.plans.map(d=>({plan_id:d.plan_id,name:d.name,price:d.price,commission_scheme:JSON.parse(JSON.stringify(d.commission_scheme)),constraints:d.constraints?JSON.parse(JSON.stringify(d.constraints)):void 0})):[],n.scope.companies=(t=l.scope)!=null&&t.companies?[...l.scope.companies]:[],n.scope.cities=(s=l.scope)!=null&&s.cities?[...l.scope.cities]:[],n.scope.stores=(a=l.scope)!=null&&a.stores?[...l.scope.stores]:[],n.form_dsl_id=l.form_dsl_id||"",n.risk_policy_id=l.risk_policy_id||""}function J(l){return typeof l=="string"?l:l&&typeof l=="object"&&"message"in l?String(l.message):"操作失败，请稍后再试"}async function F(){I.value=!0,C.value="";try{const l=await E.listCampaigns({status:u.status,city:u.city,channel:u.channel,keyword:u.keyword,page:u.page,page_size:u.page_size,sort_key:u.sort_key,sort_order:u.sort_order});ne.value=l.items||[],ce.value=l.total||0}catch(l){C.value=J(l)}finally{I.value=!1}}function Fe(){u.page=1,F()}function je(){u.status="",u.city="",u.channel="",u.keyword="",u.page=1,u.page_size=10,u.sort_key="start_time",u.sort_order="desc",F()}function he(l){l<1||l>ie.value||(u.page=l,F())}function Me(l){const t=Number(l.target.value);u.page_size=t||10,u.page=1,F()}function Ie(){Ee(),p.name="",p.code="",p.desc="",p.start_time="",p.end_time="",p.channels="",Object.keys(T).forEach(l=>delete T[l]),q.value="",K.value="",S.value="create",W.value=!0,B.value=!1,b.value=!1,h.value=null,O.value="draft",y.value=0,P.fill(!1),P[0]=!0}async function Re(l){await ge("view",l),y.value=R.length-1,P.fill(!0)}async function qe(l){await ge("edit",l)}async function ge(l,t){S.value=l,W.value=!0,B.value=!1,b.value=!1,y.value=0,P.fill(!1),P[0]=!0;try{const s=await E.getCampaign(t.campaign_id);ye(s),h.value=s.campaign_id,O.value=s.status}catch(s){C.value=J(s),W.value=!1}}function re(){W.value=!1}function Je(){pe(O.value)&&(S.value="edit",y.value=0,P.fill(!1),P[0]=!0)}function ze(){y.value>=R.length-1||me(y.value)&&(y.value+=1,P[y.value]=!0)}function Le(){y.value!==0&&(y.value-=1)}function ke(l){if(c.value||l<=y.value)return!0;for(let t=0;t<=l-1;t+=1)if(!me(t))return!1;return!0}function Ae(l){ke(l)&&(y.value=l,P[y.value]=!0)}function me(l){const t=R[l].key;return t==="basic"?we():t==="plans"?Ce():t==="scope"?Se():(t==="rules"||we()&&Ce()&&Se())&&Ue()}function we(){var a;let l=!0;p.name="",p.code="",p.start_time="",p.end_time="",p.channels="",(!n.name||n.name.trim().length<2||n.name.trim().length>40)&&(p.name="请输入 2-40 字名称",l=!1);const t=(a=n.code)==null?void 0:a.trim();if(/^[A-Z0-9]{3,16}$/.test(t)||(p.code="活动码需为 3-16 位大写字母或数字",l=!1),n.start_time||(p.start_time="请选择开始时间",l=!1),n.end_time||(p.end_time="请选择结束时间",l=!1),n.start_time&&n.end_time){const d=new Date(n.start_time).getTime(),x=new Date(n.end_time).getTime();Number.isFinite(d)&&Number.isFinite(x)&&d>=x&&(p.end_time="结束时间需晚于开始时间",l=!1)}return(!n.channels||n.channels.length===0)&&(p.channels="至少选择一个渠道",l=!1),l}function Ce(){if(Object.keys(T).forEach(t=>delete T[t]),!n.plans.length)return T.__all="至少新增一个套餐",!1;let l=!0;return n.plans.forEach((t,s)=>{let a="";if(t.name.trim()||(a="请输入套餐名称"),(t.price===void 0||t.price===null||Number(t.price)<0)&&(a="价格需大于等于 0"),_e(t.commission_scheme)||ue(t.commission_scheme)){const d=Number(t.commission_scheme.value);Number.isFinite(d)||(a="请输入有效的佣金数值"),ue(t.commission_scheme)&&(d<0||d>100)&&(a="百分比需在 0-100 之间")}else ee(t.commission_scheme)&&(t.commission_scheme.tiers.length||(a="请至少添加一个梯度"));a&&(T[s]=a,l=!1)}),l}function Se(){var a,d,x;q.value="";const l=((a=n.scope.companies)==null?void 0:a.length)||0,t=((d=n.scope.cities)==null?void 0:d.length)||0,s=((x=n.scope.stores)==null?void 0:x.length)||0;return!l&&!t&&!s?(q.value="至少选择一个公司、城市或门店",!1):!0}function Ue(){return K.value="",n.form_dsl_id.trim()?!0:(K.value="请填写表单 DSL ID",!1)}function $e(){return R.every((l,t)=>me(t))}function fe(){var l,t,s;return{campaign_id:h.value||"",name:n.name.trim(),code:n.code.trim(),desc:((l=n.desc)==null?void 0:l.trim())||"",status:O.value,start_time:n.start_time?new Date(n.start_time).toISOString():"",end_time:n.end_time?new Date(n.end_time).toISOString():"",channels:[...n.channels],plans:n.plans.map((a,d)=>({plan_id:a.plan_id||`TEMP-${d}-${Date.now()}`,name:a.name.trim(),price:Number(a.price),commission_scheme:JSON.parse(JSON.stringify(a.commission_scheme)),constraints:a.constraints?JSON.parse(JSON.stringify(a.constraints)):void 0})),scope:{companies:n.scope.companies?[...n.scope.companies]:[],cities:n.scope.cities?[...n.scope.cities]:[],stores:n.scope.stores?[...n.scope.stores]:[]},form_dsl_id:n.form_dsl_id.trim(),risk_policy_id:((t=n.risk_policy_id)==null?void 0:t.trim())||"",visible_to_roles:n.visible_to_roles?[...n.visible_to_roles]:[],require_invite:!!n.require_invite,metrics:h.value?(s=ne.value.find(a=>a.campaign_id===h.value))==null?void 0:s.metrics:void 0}}async function Be(){if($e()){B.value=!0,C.value="",N.value="";try{const l=fe();if(h.value)await E.updateCampaign(h.value,l),N.value="草稿已保存";else{const t=await E.createCampaign(l);h.value=t.campaign_id,O.value=t.status||"draft",N.value="草稿创建成功"}await F(),re()}catch(l){C.value=J(l)}finally{B.value=!1}}}async function Ze(l){if(ve(l.status)){b.value=!0,C.value="";try{await E.publishCampaign(l.campaign_id),N.value="活动已发布",await F()}catch(t){C.value=J(t)}finally{b.value=!1}}}async function He(){if(h.value&&$e()){b.value=!0,C.value="";try{const l=fe();S.value!=="view"&&await E.updateCampaign(h.value,l),await E.publishCampaign(h.value),O.value="published",N.value="活动已发布",await F(),S.value="view"}catch(l){C.value=J(l)}finally{b.value=!1}}}function Ge(l){h.value=l.campaign_id,Z.value="",H.value="",Y.value=!0}function We(){h.value&&(Z.value="",H.value="",Y.value=!0)}function Ve(){Y.value=!1}async function Ke(){if(h.value){if(!Z.value||Z.value.trim().length<5){H.value="请输入不少于 5 个字的下架原因";return}H.value="",b.value=!0;try{await E.offlineCampaign(h.value,Z.value.trim()),N.value="活动已下架",O.value="offline",await F(),Y.value=!1,S.value!=="create"&&(S.value="view")}catch(l){H.value=J(l)}finally{b.value=!1}}}async function Oe(l){b.value=!0,C.value="";try{const t=await E.cloneCampaign(l.campaign_id);N.value="复制成功，已生成草稿",await F();const s=await E.getCampaign(t.campaign_id);ye(s),h.value=s.campaign_id,O.value="draft",S.value="edit",W.value=!0,y.value=0,P.fill(!1),P[0]=!0}catch(t){C.value=J(t)}finally{b.value=!1}}async function Qe(){h.value&&await Oe({...fe(),campaign_id:h.value,status:O.value,plans:n.plans})}async function Xe(){ae.value=!0,N.value="",C.value="";try{await E.exportCampaigns({status:u.status,city:u.city,channel:u.channel,keyword:u.keyword,sort_key:u.sort_key,sort_order:u.sort_order}),N.value="导出任务已提交至导出中心"}catch(l){C.value=J(l)}finally{ae.value=!1}}function Ye(){c.value||n.plans.push({name:"",price:0,commission_scheme:{type:"fixed",value:0}})}function et(l){c.value||n.plans.splice(l,1)}function tt(l,t){if(c.value)return;const s=t.target.value;s==="fixed"?n.plans[l].commission_scheme={type:"fixed",value:0}:s==="percent"?n.plans[l].commission_scheme={type:"percent",value:0}:n.plans[l].commission_scheme={type:"tier",tiers:[{threshold:0,value:0}]}}function _e(l){return l.type==="fixed"}function ue(l){return l.type==="percent"}function ee(l){return l.type==="tier"}function st(l){if(c.value)return;const t=n.plans[l].commission_scheme;ee(t)&&t.tiers.push({threshold:0,value:0})}function lt(l,t){if(c.value)return;const s=n.plans[l].commission_scheme;ee(s)&&s.tiers.splice(t,1)}function nt(l){if(!l)return"";try{return Object.entries(l).map(([t,s])=>`${t}:${s}`).join("; ")}catch{return""}}function at(l,t){if(c.value)return;const s=t.target.value;if(!s){n.plans[l].constraints=void 0;return}const a={};s.split(/;|；/).forEach(d=>{const[x,D]=d.split(/:|：/);x&&D&&(a[x.trim()]=D.trim())}),n.plans[l].constraints=a}function it(l){return _e(l)?`固定 ¥${Number(l.value).toFixed(2)}`:ue(l)?`比例 ${Number(l.value).toFixed(1)}%`:ee(l)?l.tiers.map(t=>`≥${t.threshold} 单 ¥${t.value}`).join("；"):"-"}function xe(l){if(!l||!l.length)return"-";const t=G.reduce((s,a)=>(s[a.value]=a.label,s),{});return l.map(s=>t[s]||s).join("、")}function ot(l){if(!l||!l.length)return"-";const t=X.reduce((s,a)=>(s[a.value]=a.label,s),{});return l.map(s=>t[s]||s).join("、")}function rt(l){const t=[];return l.companies&&l.companies.length&&t.push(`公司 ${l.companies.length}`),l.cities&&l.cities.length&&t.push(`城市 ${l.cities.length}`),l.stores&&l.stores.length&&t.push(`门店 ${l.stores.length}`),t.length?t.join(" · "):"-"}function ut(l){const t=j.reduce((s,a)=>(s[a.value]=a.label,s),{});return l.map(s=>t[s]||s).join("、")}function De(l,t){if(!l||!t)return"-";const s=new Date(l).toLocaleString("zh-CN",{hour12:!1}),a=new Date(t).toLocaleString("zh-CN",{hour12:!1});return`${s} ~ ${a}`}return ct(()=>n.code,l=>{if(typeof l!="string")return;const t=l.toUpperCase().replace(/[^A-Z0-9]/g,"");t!==l&&(n.code=t)}),F(),(l,t)=>(r(),o("section",mt,[e("header",ft,[t[23]||(t[23]=e("div",null,[e("h1",{class:"campaigns__title"},"活动管理"),e("p",{class:"campaigns__subtitle"},"配置套餐、适用范围与计佣规则，支持草稿、发布、复制与导出。")],-1)),e("div",_t,[e("button",{type:"button",class:"btn btn--ghost",onClick:Xe,disabled:I.value||ae.value},i(ae.value?"导出中…":"导出到导出中心"),9,bt),e("button",{type:"button",class:"btn",onClick:Ie,disabled:I.value},"新建活动",8,yt)])]),e("form",{class:"campaigns__filters",onSubmit:pt(Fe,["prevent"])},[e("div",ht,[e("label",gt,[t[25]||(t[25]=e("span",null,"状态",-1)),v(e("select",{class:"input","onUpdate:modelValue":t[0]||(t[0]=s=>u.status=s)},[t[24]||(t[24]=e("option",{value:""},"全部",-1)),(r(),o(U,null,$(f,s=>e("option",{key:s.value,value:s.value},i(s.label),9,kt)),64))],512),[[se,u.status]])]),e("label",wt,[t[27]||(t[27]=e("span",null,"城市",-1)),v(e("select",{class:"input","onUpdate:modelValue":t[1]||(t[1]=s=>u.city=s)},[t[26]||(t[26]=e("option",{value:""},"全部",-1)),(r(),o(U,null,$(j,s=>e("option",{key:s.value,value:s.value},i(s.label),9,Ct)),64))],512),[[se,u.city]])]),e("label",St,[t[29]||(t[29]=e("span",null,"渠道",-1)),v(e("select",{class:"input","onUpdate:modelValue":t[2]||(t[2]=s=>u.channel=s)},[t[28]||(t[28]=e("option",{value:""},"全部",-1)),(r(),o(U,null,$(G,s=>e("option",{key:s.value,value:s.value},i(s.label),9,Ut)),64))],512),[[se,u.channel]])]),e("label",$t,[t[30]||(t[30]=e("span",null,"关键词",-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>u.keyword=s),placeholder:"名称 / 活动码"},null,512),[[V,u.keyword,void 0,{trim:!0}]])]),e("label",Vt,[t[32]||(t[32]=e("span",null,"排序字段",-1)),v(e("select",{class:"input","onUpdate:modelValue":t[4]||(t[4]=s=>u.sort_key=s)},[...t[31]||(t[31]=[e("option",{value:"start_time"},"开始时间",-1),e("option",{value:"end_time"},"结束时间",-1),e("option",{value:"name"},"名称",-1)])],512),[[se,u.sort_key]])]),e("label",Ot,[t[34]||(t[34]=e("span",null,"排序方向",-1)),v(e("select",{class:"input","onUpdate:modelValue":t[5]||(t[5]=s=>u.sort_order=s)},[...t[33]||(t[33]=[e("option",{value:"desc"},"降序",-1),e("option",{value:"asc"},"升序",-1)])],512),[[se,u.sort_order]])])]),e("div",xt,[e("button",{type:"submit",class:"btn",disabled:I.value},"应用筛选",8,Dt),e("button",{type:"button",class:"btn btn--ghost",onClick:je,disabled:I.value},"重置",8,Nt)])],32),e("div",Pt,[e("table",null,[t[39]||(t[39]=e("thead",null,[e("tr",null,[e("th",null,"活动名称"),e("th",null,"活动码"),e("th",null,"状态"),e("th",null,"有效期"),e("th",null,"适用范围"),e("th",null,"渠道"),e("th",null,"提交 / 审核 / 结清"),e("th",{class:"col-actions"},"操作")])],-1)),I.value?(r(),o("tbody",Tt,[(r(),o(U,null,$(4,s=>e("tr",{key:`loading-${s}`},[...t[35]||(t[35]=[e("td",{colspan:8,class:"table-skeleton"},null,-1)])])),64))])):ne.value.length?(r(),o("tbody",Et,[(r(!0),o(U,null,$(ne.value,s=>{var a,d,x;return r(),o("tr",{key:s.campaign_id},[e("td",null,[e("button",{type:"button",class:"link-btn",onClick:D=>Re(s)},i(s.name),9,Ft)]),e("td",null,i(s.code),1),e("td",null,[e("span",{class:"status-tag","data-status":s.status},i(be(s.status)),9,jt)]),e("td",null,i(De(s.start_time,s.end_time)),1),e("td",null,i(rt(s.scope)),1),e("td",null,i(xe(s.channels)),1),e("td",null,[e("span",Mt,i(((a=s.metrics)==null?void 0:a.submitted)??0),1),t[36]||(t[36]=k(" / ",-1)),e("span",It,i(((d=s.metrics)==null?void 0:d.approved)??0),1),t[37]||(t[37]=k(" / ",-1)),e("span",Rt,i(((x=s.metrics)==null?void 0:x.settled)??0),1)]),e("td",qt,[e("div",Jt,[e("button",{type:"button",class:"link-btn",onClick:D=>qe(s),disabled:!pe(s.status)}," 编辑 ",8,zt),e("button",{type:"button",class:"link-btn",onClick:D=>Ze(s),disabled:!ve(s.status)||b.value}," 发布 ",8,Lt),e("button",{type:"button",class:"link-btn",onClick:D=>Ge(s),disabled:s.status!=="published"||b.value}," 下架 ",8,At),e("button",{type:"button",class:"link-btn",onClick:D=>Oe(s),disabled:b.value},"复制",8,Bt)])])])}),128))])):(r(),o("tbody",Zt,[...t[38]||(t[38]=[e("tr",null,[e("td",{colspan:8,class:"empty"},"暂无符合条件的活动")],-1)])]))])]),ie.value>1?(r(),o("footer",Ht,[e("button",{type:"button",class:"btn btn--ghost",disabled:u.page<=1||I.value,onClick:t[6]||(t[6]=s=>he(u.page-1))},"上一页",8,Gt),e("span",null,"第 "+i(u.page)+" / "+i(ie.value)+" 页",1),e("button",{type:"button",class:"btn btn--ghost",disabled:u.page>=ie.value||I.value,onClick:t[7]||(t[7]=s=>he(u.page+1))},"下一页",8,Wt),e("label",Kt,[t[40]||(t[40]=e("span",null,"每页",-1)),e("select",{class:"input",value:u.page_size,onChange:t[8]||(t[8]=s=>Me(s))},[(r(),o(U,null,$(Pe,s=>e("option",{key:s,value:s},i(s),9,Xt)),64))],40,Qt)]),e("span",null,"共 "+i(ce.value)+" 条",1)])):_("",!0),C.value?(r(),o("p",Yt,i(C.value),1)):N.value?(r(),o("p",es,i(N.value),1)):_("",!0),W.value?(r(),o("div",ts,[e("div",{class:"campaigns-drawer__backdrop",onClick:re}),e("aside",ss,[e("header",ls,[e("div",ns,[e("h2",null,i(Te.value),1),e("span",{class:"status-tag","data-status":O.value},i(be(O.value)),9,as)]),e("div",is,[S.value==="view"&&pe(O.value)?(r(),o("button",{key:0,type:"button",class:"btn btn--ghost",onClick:Je}," 编辑草稿 ")):_("",!0),S.value!=="create"&&ve(O.value)?(r(),o("button",{key:1,type:"button",class:"btn",onClick:He,disabled:B.value||b.value},i(b.value?"发布中…":"发布"),9,os)):_("",!0),S.value!=="create"&&O.value==="published"?(r(),o("button",{key:2,type:"button",class:"btn btn--ghost",onClick:We,disabled:b.value}," 下架 ",8,rs)):_("",!0),S.value!=="create"?(r(),o("button",{key:3,type:"button",class:"btn btn--ghost",onClick:Qe,disabled:b.value}," 复制 ",8,us)):_("",!0),e("button",{type:"button",class:"btn btn--ghost",onClick:re},"关闭")])]),e("nav",ds,[(r(),o(U,null,$(R,(s,a)=>e("button",{key:s.key,type:"button",class:"drawer-step","data-active":a===y.value,disabled:!ke(a),onClick:d=>Ae(a)},[e("span",ps,i(a+1),1),e("span",null,i(s.label),1)],8,cs)),64))]),e("section",vs,[oe.value.key==="basic"?(r(),o("div",ms,[e("div",fs,[e("label",{class:"form-field","data-error":p.name},[t[41]||(t[41]=e("span",null,[k("活动名称"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":t[9]||(t[9]=s=>n.name=s),disabled:c.value,placeholder:"2-40 字"},null,8,bs),[[V,n.name,void 0,{trim:!0}]]),p.name?(r(),o("span",ys,i(p.name),1)):_("",!0)],8,_s),e("label",{class:"form-field","data-error":p.code},[t[42]||(t[42]=e("span",null,[k("活动码"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":t[10]||(t[10]=s=>n.code=s),disabled:c.value,placeholder:"大写字母数字"},null,8,gs),[[V,n.code]]),p.code?(r(),o("span",ks,i(p.code),1)):_("",!0)],8,hs),e("label",{class:"form-field full","data-error":p.desc},[t[43]||(t[43]=e("span",null,"活动描述",-1)),v(e("textarea",{class:"textarea",rows:"3","onUpdate:modelValue":t[11]||(t[11]=s=>n.desc=s),disabled:c.value,placeholder:"不超过 200 字"},null,8,Cs),[[V,n.desc,void 0,{trim:!0}]])],8,ws),e("label",{class:"form-field","data-error":p.start_time},[t[44]||(t[44]=e("span",null,[k("开始时间"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"datetime-local","onUpdate:modelValue":t[12]||(t[12]=s=>n.start_time=s),disabled:c.value},null,8,Us),[[V,n.start_time]]),p.start_time?(r(),o("span",$s,i(p.start_time),1)):_("",!0)],8,Ss),e("label",{class:"form-field","data-error":p.end_time},[t[45]||(t[45]=e("span",null,[k("结束时间"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"datetime-local","onUpdate:modelValue":t[13]||(t[13]=s=>n.end_time=s),disabled:c.value},null,8,Os),[[V,n.end_time]]),p.end_time?(r(),o("span",xs,i(p.end_time),1)):_("",!0)],8,Vs),e("fieldset",{class:"form-field full","data-error":p.channels},[t[46]||(t[46]=e("legend",null,[k("适用渠道"),e("em",null,"*")],-1)),e("div",Ns,[(r(),o(U,null,$(G,s=>e("label",{key:s.value},[v(e("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":t[14]||(t[14]=a=>n.channels=a),disabled:c.value},null,8,Ps),[[Q,n.channels]]),k(" "+i(s.label),1)])),64))]),p.channels?(r(),o("span",Ts,i(p.channels),1)):_("",!0)],8,Ds),e("fieldset",Es,[t[47]||(t[47]=e("legend",null,"可见角色",-1)),e("div",Fs,[(r(),o(U,null,$(X,s=>e("label",{key:s.value},[v(e("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":t[15]||(t[15]=a=>n.visible_to_roles=a),disabled:c.value},null,8,js),[[Q,n.visible_to_roles]]),k(" "+i(s.label),1)])),64))])]),e("label",Ms,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=s=>n.require_invite=s),disabled:c.value},null,8,Is),[[Q,n.require_invite]]),t[48]||(t[48]=e("span",null,"需要邀请码才能参与",-1))])])])):oe.value.key==="plans"?(r(),o("div",Rs,[e("div",qs,[t[49]||(t[49]=e("h3",null,"套餐配置",-1)),e("button",{type:"button",class:"btn btn--ghost",onClick:Ye,disabled:c.value},"新增套餐",8,Js)]),T.__all?(r(),o("p",zs,i(T.__all),1)):_("",!0),n.plans.length?_("",!0):(r(),o("div",Ls,"暂无套餐，请点击「新增套餐」。")),(r(!0),o(U,null,$(n.plans,(s,a)=>(r(),o("section",{key:a,class:"plan-card","data-error":T[a]},[e("header",Bs,[e("h4",null,"套餐 "+i(a+1),1),e("button",{type:"button",class:"link-btn",onClick:d=>et(a),disabled:c.value},"删除",8,Zs)]),e("div",Hs,[e("label",Gs,[t[50]||(t[50]=e("span",null,[k("套餐名称"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":d=>s.name=d,disabled:c.value,placeholder:"如 59 元档"},null,8,Ws),[[V,s.name,void 0,{trim:!0}]])]),e("label",Ks,[t[51]||(t[51]=e("span",null,[k("价格 (¥)"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"number",min:"0",step:"0.01","onUpdate:modelValue":d=>s.price=d,disabled:c.value},null,8,Qs),[[V,s.price,void 0,{number:!0}]])]),e("label",Xs,[t[53]||(t[53]=e("span",null,[k("计佣类型"),e("em",null,"*")],-1)),e("select",{class:"input",value:s.commission_scheme.type,onChange:d=>tt(a,d),disabled:c.value},[...t[52]||(t[52]=[e("option",{value:"fixed"},"固定金额",-1),e("option",{value:"percent"},"百分比",-1),e("option",{value:"tier"},"梯度",-1)])],40,Ys)]),_e(s.commission_scheme)?(r(),o("label",el,[t[54]||(t[54]=e("span",null,[k("佣金 (¥)"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"number",min:"0",step:"0.01","onUpdate:modelValue":d=>s.commission_scheme.value=d,disabled:c.value},null,8,tl),[[V,s.commission_scheme.value,void 0,{number:!0}]])])):ue(s.commission_scheme)?(r(),o("label",sl,[t[55]||(t[55]=e("span",null,[k("佣金 (%)"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"number",min:"0",max:"100",step:"0.1","onUpdate:modelValue":d=>s.commission_scheme.value=d,disabled:c.value},null,8,ll),[[V,s.commission_scheme.value,void 0,{number:!0}]])])):_("",!0)]),ee(s.commission_scheme)?(r(),o("div",nl,[(r(!0),o(U,null,$(s.commission_scheme.tiers,(d,x)=>(r(),o("div",{key:x,class:"tier-row"},[e("label",al,[t[56]||(t[56]=e("span",null,"阈值",-1)),v(e("input",{class:"input",type:"number",min:"0",step:"1","onUpdate:modelValue":D=>d.threshold=D,disabled:c.value},null,8,il),[[V,d.threshold,void 0,{number:!0}]])]),e("label",ol,[t[57]||(t[57]=e("span",null,"佣金",-1)),v(e("input",{class:"input",type:"number",min:"0",step:"0.1","onUpdate:modelValue":D=>d.value=D,disabled:c.value},null,8,rl),[[V,d.value,void 0,{number:!0}]])]),e("button",{type:"button",class:"link-btn",onClick:D=>lt(a,x),disabled:c.value},"移除",8,ul)]))),128)),e("button",{type:"button",class:"btn btn--ghost",onClick:d=>st(a),disabled:c.value},"新增梯度",8,dl)])):_("",!0),e("label",cl,[t[58]||(t[58]=e("span",null,"限制条件",-1)),e("input",{class:"input",type:"text",value:nt(s.constraints),onInput:d=>at(a,d),disabled:c.value,placeholder:"示例：新用户专享"},null,40,pl)]),T[a]?(r(),o("p",vl,i(T[a]),1)):_("",!0)],8,As))),128))])):oe.value.key==="scope"?(r(),o("div",ml,[e("fieldset",{class:"form-field full","data-error":q.value},[t[59]||(t[59]=e("legend",null,"适用公司",-1)),e("div",_l,[(r(),o(U,null,$(le,s=>e("label",{key:s},[v(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[17]||(t[17]=a=>n.scope.companies=a),disabled:c.value},null,8,bl),[[Q,n.scope.companies]]),k(" "+i(s),1)])),64))])],8,fl),e("fieldset",{class:"form-field full","data-error":q.value},[t[60]||(t[60]=e("legend",null,"适用城市",-1)),e("div",hl,[(r(),o(U,null,$(j,s=>e("label",{key:s.value},[v(e("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":t[18]||(t[18]=a=>n.scope.cities=a),disabled:c.value},null,8,gl),[[Q,n.scope.cities]]),k(" "+i(s.label),1)])),64))])],8,yl),e("fieldset",{class:"form-field full","data-error":q.value},[t[61]||(t[61]=e("legend",null,"适用门店",-1)),e("div",wl,[(r(),o(U,null,$(M,s=>e("label",{key:s.value},[v(e("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":t[19]||(t[19]=a=>n.scope.stores=a),disabled:c.value},null,8,Cl),[[Q,n.scope.stores]]),k(" "+i(s.label),1)])),64))])],8,kl),q.value?(r(),o("span",Sl,i(q.value),1)):_("",!0)])):oe.value.key==="rules"?(r(),o("div",Ul,[e("div",$l,[e("label",{class:"form-field","data-error":K.value},[t[62]||(t[62]=e("span",null,[k("表单 DSL ID"),e("em",null,"*")],-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":t[20]||(t[20]=s=>n.form_dsl_id=s),disabled:c.value,placeholder:"如 F123"},null,8,Ol),[[V,n.form_dsl_id,void 0,{trim:!0}]])],8,Vl),e("label",xl,[t[63]||(t[63]=e("span",null,"风控策略 ID",-1)),v(e("input",{class:"input",type:"text","onUpdate:modelValue":t[21]||(t[21]=s=>n.risk_policy_id=s),disabled:c.value,placeholder:"如 R001"},null,8,Dl),[[V,n.risk_policy_id,void 0,{trim:!0}]])])]),K.value?(r(),o("span",Nl,i(K.value),1)):_("",!0)])):(r(),o("div",Pl,[e("article",Tl,[t[76]||(t[76]=e("h3",null,"基础信息",-1)),e("dl",null,[e("div",null,[t[64]||(t[64]=e("dt",null,"活动名称",-1)),e("dd",null,i(n.name),1)]),e("div",null,[t[65]||(t[65]=e("dt",null,"活动码",-1)),e("dd",null,i(n.code),1)]),e("div",null,[t[66]||(t[66]=e("dt",null,"有效期",-1)),e("dd",null,i(De(n.start_time,n.end_time)),1)]),e("div",null,[t[67]||(t[67]=e("dt",null,"渠道",-1)),e("dd",null,i(xe(n.channels)),1)]),e("div",null,[t[68]||(t[68]=e("dt",null,"描述",-1)),e("dd",null,i(n.desc||"-"),1)]),e("div",null,[t[69]||(t[69]=e("dt",null,"可见角色",-1)),e("dd",null,i(ot(n.visible_to_roles)),1)]),e("div",null,[t[70]||(t[70]=e("dt",null,"需要邀请码",-1)),e("dd",null,i(n.require_invite?"是":"否"),1)])]),t[77]||(t[77]=e("h3",null,"套餐",-1)),e("ul",El,[(r(!0),o(U,null,$(n.plans,(s,a)=>(r(),o("li",{key:a},[e("strong",null,i(s.name),1),e("span",null,"价格：¥"+i(s.price.toFixed(2)),1),e("span",null,"计佣："+i(it(s.commission_scheme)),1)]))),128))]),t[78]||(t[78]=e("h3",null,"适用范围",-1)),e("dl",null,[e("div",null,[t[71]||(t[71]=e("dt",null,"公司",-1)),e("dd",null,i(n.scope.companies&&n.scope.companies.length?n.scope.companies.join("、"):"-"),1)]),e("div",null,[t[72]||(t[72]=e("dt",null,"城市",-1)),e("dd",null,i(n.scope.cities&&n.scope.cities.length?ut(n.scope.cities):"-"),1)]),e("div",null,[t[73]||(t[73]=e("dt",null,"门店",-1)),e("dd",null,i(n.scope.stores&&n.scope.stores.length?n.scope.stores.join("、"):"-"),1)])]),t[79]||(t[79]=e("h3",null,"规则",-1)),e("dl",null,[e("div",null,[t[74]||(t[74]=e("dt",null,"表单 DSL",-1)),e("dd",null,i(n.form_dsl_id||"-"),1)]),e("div",null,[t[75]||(t[75]=e("dt",null,"风控策略",-1)),e("dd",null,i(n.risk_policy_id||"-"),1)])])])]))]),e("footer",Fl,[e("button",{type:"button",class:"btn btn--ghost",onClick:re},"取消"),e("button",{type:"button",class:"btn btn--ghost",onClick:Le,disabled:y.value===0},"上一步",8,jl),y.value<R.length-1?(r(),o("button",{key:0,type:"button",class:"btn",onClick:ze,disabled:c.value}," 下一步 ",8,Ml)):(r(),o("button",{key:1,type:"button",class:"btn",onClick:Be,disabled:B.value||c.value},i(B.value?"保存中…":"保存草稿"),9,Il))])])])):_("",!0),Y.value?(r(),o("div",Rl,[e("div",{class:"offline-modal__backdrop",onClick:Ve}),e("div",ql,[t[81]||(t[81]=e("header",null,[e("h3",null,"下架原因")],-1)),e("section",null,[t[80]||(t[80]=e("p",null,"请说明下架原因，以便留存审核记录。",-1)),v(e("textarea",{class:"textarea",rows:"4","onUpdate:modelValue":t[22]||(t[22]=s=>Z.value=s),placeholder:"输入不少于 5 个字的原因"},null,512),[[V,Z.value,void 0,{trim:!0}]]),H.value?(r(),o("p",Jl,i(H.value),1)):_("",!0)]),e("footer",null,[e("button",{type:"button",class:"btn btn--ghost",onClick:Ve},"取消"),e("button",{type:"button",class:"btn",onClick:Ke,disabled:b.value},i(b.value?"提交中…":"确认下架"),9,zl)])])])):_("",!0)]))}}),Bl=vt(Ll,[["__scopeId","data-v-239c6543"]]);export{Bl as default};
