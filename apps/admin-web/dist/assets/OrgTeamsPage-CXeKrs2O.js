import{O as Ie,d as ct,r as g,a as te,o as ft,z as _t,c as G,w as gt,b as r,e as l,A as y,B as m,f as F,k as Q,i as M,v as W,F as O,h as U,m as yt,t as d,E as ht,j as ue,q as o,s as h,y as bt,_ as kt}from"./index-DvtP9USg.js";import{B as k}from"./Button-BaguUGDy.js";import{M as pe}from"./Modal-CtEdl0zk.js";import{P as xt}from"./Pagination-3ermIvaY.js";function D(){return{"Content-Type":"application/json",...Ie.HEADERS||{}}}function P(v,i){var u;const p=((u=Ie.BASE)==null?void 0:u.replace(/\/$/,""))||"";if(!i||Object.keys(i).length===0)return`${p}${v}`;const $=new URLSearchParams;Object.entries(i).forEach(([L,x])=>{if(!(x==null||x==="")){if(Array.isArray(x)){x.length&&$.append(L,x.join(","));return}$.append(L,String(x))}});const E=$.toString();return E?`${p}${v}?${E}`:`${p}${v}`}async function z(v,i){const p=await fetch(v,i);if(!p.ok){let E=`Request failed with ${p.status}`,u=null;const L=p.headers.get("content-type")||"";try{if(L.includes("application/json")){if(u=await p.json(),u&&typeof u=="object"&&"message"in u){const j=u.message;typeof j=="string"&&j.trim().length&&(E=j)}}else{const j=await p.text();j.trim().length&&(E=j)}}catch{}const x=new Error(E);throw u&&typeof u=="object"&&Object.assign(x,{details:u}),x}return p.status===204?void 0:(p.headers.get("content-type")||"").includes("application/json")?await p.json():await p.text()}const I={async listTeams(v){const i=P("/api/v1/teams",v);return z(i,{method:"GET",headers:D()})},async getTeamDetail(v){const i=P(`/api/v1/teams/${encodeURIComponent(v)}`);return z(i,{method:"GET",headers:D()})},async getTeamChildren(v){const i=P(`/api/v1/teams/${encodeURIComponent(v)}/children`);return z(i,{method:"GET",headers:D()})},async getTeamMembers(v,i){const p=P(`/api/v1/teams/${encodeURIComponent(v)}/members`,i);return z(p,{method:"GET",headers:D()})},async moveTeam(v,i){const p=P(`/api/v1/teams/${encodeURIComponent(v)}/move`);return z(p,{method:"POST",headers:D(),body:JSON.stringify(i)})},async grantTeamRoles(v,i){const p=P(`/api/v1/teams/${encodeURIComponent(v)}/grant`);return z(p,{method:"POST",headers:D(),body:JSON.stringify(i)})},async batchMoveMembers(v){const i=P("/api/v1/members/batch_move");return z(i,{method:"POST",headers:D(),body:JSON.stringify(v)})},async createInvite(v){const i=P("/api/v1/invites");return z(i,{method:"POST",headers:D(),body:JSON.stringify(v)})},async importMembers(v){const i=P("/api/v1/members/import");return z(i,{method:"POST",headers:D(),body:JSON.stringify(v)})},async getImportTask(v){const i=P(`/api/v1/members/import/${encodeURIComponent(v)}`);return z(i,{method:"GET",headers:D()})},async exportMembers(v){const i=P("/api/v1/exports/members");return z(i,{method:"POST",headers:D(),body:JSON.stringify(v||{})})},async exportTeams(v){const i=P("/api/v1/exports/teams");return z(i,{method:"POST",headers:D(),body:JSON.stringify(v||{})})}},wt={class:"org-teams"},Tt={class:"org-teams__header"},Ct={class:"org-teams__header-actions"},St={class:"org-teams__content"},Mt={class:"org-teams__sidebar"},$t=["disabled"],Vt=["aria-busy"],Ot={key:0,class:"tree-placeholder"},Ut={key:1,class:"tree-placeholder"},Dt={key:2,class:"tree-list"},Pt=["data-active","data-drop"],zt=["onDragstart","onDragover","onDrop"],It=["aria-label","onClick"],Et={key:0},Nt={key:1},jt={key:1,class:"tree-row__spacer"},Rt=["onClick"],Ft={class:"tree-row__name"},Lt={class:"tree-row__meta"},qt={key:0,class:"tree-error"},Bt={class:"org-teams__main"},At={key:0,class:"team-summary"},Gt={class:"team-summary__head"},Jt={class:"team-summary__meta"},Ht=["data-status"],Kt={class:"team-summary__grid"},Qt={key:1},Wt={class:"team-summary__desc"},Xt={key:1,class:"import-task"},Yt={class:"import-task__info"},Zt=["data-status"],ea={class:"import-task__progress"},ta=["value","max"],aa={key:0,class:"import-task__errors"},la={class:"members"},na={class:"members__head"},sa={class:"members__actions"},oa=["disabled"],ra=["value"],ia=["disabled"],ua=["value"],da={class:"members__keyword"},va=["disabled"],ma={class:"members__table"},pa={class:"col-select"},ca=["checked"],fa={key:0},_a={key:1},ga=["value","checked","onChange"],ya={class:"member-name"},ha={key:0,class:"member-email"},ba=["data-role"],ka=["data-status"],xa={class:"member-contact"},wa={key:0,class:"member-hint"},Ta={key:1},Ca={key:2},Sa={key:2,class:"feedback"},Ma={key:3,class:"feedback feedback--error"},$a=["value"],Va=["value"],Oa={class:"checkbox"},Ua={class:"modal-tip"},Da={class:"modal-form"},Pa=["value","disabled"],za={class:"checkbox-group"},Ia=["value","checked","onChange"],Ea=ct({__name:"OrgTeamsPage",setup(v){const i=g([]),p=g(""),$=g(!1),E=g(""),u=g(null),L=te({}),x=g([]),j=g(0),R=g(!1),c=te({status:"",role:"",keyword:"",sort_key:"joined_at",sort_order:"desc",page:1,page_size:20}),_=g([]),ae=g(!1),le=g(!1),ne=g(!1),se=g(!1),C=te({target_team_id:"",quota:20,expires_at:ze()}),w=te({target_team_id:"",upload_token:"",notify_email:"",dry_run:!1}),X=te({target_team_id:""}),N=te({roles:[],expires_at:""}),S=g(null),de=g(!1);let q=null;const f=g(!1),Y=g(""),J=g(""),Z=g(null),ve=g(null);let oe=null;ft(()=>{we()}),_t(()=>{q&&clearTimeout(q)});function he(t){return{...t,expanded:!1,loaded:!t.has_children,loading:!1,loadingPromise:null,children:t.has_children?[]:void 0}}const Ee=[{value:"lead",label:"负责人"},{value:"staff",label:"运营人员"},{value:"promoter",label:"推广员"},{value:"store_owner",label:"门店负责人"},{value:"viewer",label:"访客"}],Ne=[{value:"active",label:"在岗"},{value:"frozen",label:"冻结"},{value:"left",label:"已离职"}],je=[{value:"team_lead",label:"团队负责人"},{value:"org_admin",label:"组织管理员"},{value:"auditor",label:"审核员"}],be=G(()=>Oe(i.value)),V=G(()=>{var t;return u.value?L[u.value]||De((t=re(u.value))==null?void 0:t.node):null}),ce=G(()=>{const t=new Set,e=[];return Ue(i.value).forEach(n=>{t.has(n.team_id)||(t.add(n.team_id),e.push(n))}),e}),ke=G(()=>Math.max(1,Math.ceil(j.value/c.page_size))),H=G(()=>x.value.map(t=>t.user_id)),fe=G(()=>H.value.length>0&&H.value.every(t=>_.value.includes(t))),xe=G(()=>{if(!H.value.length)return!1;const t=H.value.filter(e=>_.value.includes(e)).length;return t>0&&t<H.value.length}),Re=G(()=>_.value.length>0&&!f.value),_e=g(null);gt([fe,xe],()=>{_e.value&&(_e.value.indeterminate=xe.value&&!fe.value)},{immediate:!0});async function we(){var t;$.value=!0,E.value="";try{const e=await I.listTeams(p.value?{keyword:p.value}:void 0);i.value=e.teams.map(n=>he(n)),!u.value&&i.value.length?Te(i.value[0]):u.value&&(re(u.value)||(u.value=((t=i.value[0])==null?void 0:t.team_id)??null)),me(!0)}catch(e){E.value=e.message||"加载团队失败"}finally{$.value=!1}}function Fe(){we()}function Le(t){if(t.has_children){if(!t.loaded){ge(t,!0);return}t.expanded=!t.expanded}}async function ge(t,e=!0,n=!1){if(t.loaded){e&&(t.expanded=!0);return}if(t.loadingPromise){await t.loadingPromise,e&&t.loaded&&(t.expanded=!0);return}const s=(async()=>{t.loading=!0;try{const a=await I.getTeamChildren(t.team_id);t.children=a.teams.map(b=>he(b)),t.has_children=t.children.length>0,t.loaded=!0}catch(a){n||T(a.message||"加载子团队失败")}finally{t.loading=!1,t.loadingPromise=null}})();t.loadingPromise=s,await s,t.loaded&&(t.has_children?e&&(t.expanded=!0):t.expanded=!1)}function me(t=!1){if(!i.value.length)return Promise.resolve();if(!t&&oe)return oe;const e=[...i.value],n=(async()=>{var s;for(;e.length;){const a=e.shift();a&&a.has_children&&(await ge(a,!1,!0),(s=a.children)!=null&&s.length&&e.push(...a.children))}})();return oe=n,n.catch(()=>{}).finally(()=>{oe===n&&(oe=null)}),n}function Te(t){t&&(u.value=t.team_id,_.value=[],t.has_children&&ge(t,!0),qe(t.team_id),Ce(),ee())}async function qe(t){var e;try{const n=await I.getTeamDetail(t);L[t]=n}catch(n){const s=De((e=re(t))==null?void 0:e.node);s?L[t]=s:T(n.message||"获取团队详情失败")}}async function ee(){if(u.value){R.value=!0;try{const t=await I.getTeamMembers(u.value,{...c});x.value=t.items.map(rt),j.value=t.total,_.value=_.value.filter(e=>x.value.some(n=>n.user_id===e)),mt()}catch(t){T(t.message||"加载成员失败")}finally{R.value=!1}}}function Be(){c.page=1,ee()}function Ce(){c.status="",c.role="",c.keyword="",c.page=1,c.page_size=20,c.sort_key="joined_at",c.sort_order="desc"}function Ae(t){c.page=t,ee()}function Ge(t){c.page_size=t,c.page=1,ee()}function Je(t){_.value.includes(t)?_.value=_.value.filter(e=>e!==t):_.value=[..._.value,t]}function He(t){t.target.checked?_.value=Array.from(new Set([..._.value,...H.value])):_.value=_.value.filter(n=>!H.value.includes(n))}function Ke(t){return _.value.includes(t)}function Qe(){u.value&&(C.target_team_id=u.value,C.quota=20,C.expires_at=ze(),me(),ae.value=!0)}async function Se(){if(C.target_team_id){f.value=!0;try{const t={target_team_id:C.target_team_id,quota:C.quota,expires_at:C.expires_at},e=await I.createInvite(t);B(`邀请链接已生成：${e.invite_code}`),ae.value=!1}catch(t){T(t.message||"创建邀请失败")}finally{f.value=!1}}}function We(){u.value&&(w.target_team_id=u.value,w.upload_token="",w.notify_email="",w.dry_run=!1,me(),le.value=!0)}async function Me(){if(!w.target_team_id||!w.upload_token){T("请填写上传凭证");return}f.value=!0;try{const t=await I.importMembers({...w});S.value=t,B("导入任务已提交，开始校验…"),le.value=!1,Xe(t.task_id)}catch(t){T(t.message||"提交导入失败")}finally{f.value=!1}}function Xe(t){q&&clearTimeout(q),de.value=!0;const e=async()=>{try{const n=await I.getImportTask(t);if(S.value=n,n.status==="succeeded"||n.status==="failed"){de.value=!1,q=null,n.status==="succeeded"?(B("导入完成"),ee()):T("导入失败，请查看错误列表");return}}catch(n){T(n.message||"查询导入状态失败"),de.value=!1,q=null;return}q=setTimeout(e,2e3)};q=setTimeout(e,1800)}function Ye(){if(!_.value.length){T("请选择需要转移的成员");return}X.target_team_id="",me(),ne.value=!0}async function $e(){if(X.target_team_id){f.value=!0;try{const t={user_ids:_.value,target_team_id:X.target_team_id};await I.batchMoveMembers(t),B(`已转移 ${_.value.length} 人`),_.value=[],ne.value=!1,ee()}catch(t){T(t.message||"批量转移失败")}finally{f.value=!1}}}function Ze(){u.value&&(N.roles=["team_lead"],N.expires_at="",se.value=!0)}async function Ve(){if(u.value){f.value=!0;try{await I.grantTeamRoles(u.value,{roles:N.roles,expires_at:N.expires_at||void 0}),B("权限已更新"),se.value=!1}catch(t){T(t.message||"更新权限失败")}finally{f.value=!1}}}async function et(){if(u.value){f.value=!0;try{const t={team_id:u.value,status:c.status||void 0,role:c.role||void 0,keyword:c.keyword||void 0},e=await I.exportMembers(t);B(`导出任务已创建：${e.export_id}`)}catch(t){T(t.message||"导出失败")}finally{f.value=!1}}}async function tt(){f.value=!0;try{const t=await I.exportTeams(p.value?{keyword:p.value}:void 0);B(`团队导出任务：${t.export_id}`)}catch(t){T(t.message||"导出团队失败")}finally{f.value=!1}}function at(t,e){e.target.checked?N.roles.includes(t)||N.roles.push(t):N.roles=N.roles.filter(s=>s!==t)}function lt(t){Z.value=t.team_id,ve.value=null}function ye(){Z.value=null,ve.value=null}function nt(t){!Z.value||Z.value===t.team_id||(ve.value=t.team_id)}async function st(t){if(!Z.value)return;const e=re(Z.value);if(!e||e.node.team_id===t.team_id){ye();return}const n=ot(e,t);f.value=!0;try{const s=await I.moveTeam(e.node.team_id,{target_team_id:t.team_id});B(`已移动至 ${t.name}`),e.node.parent_id=s.new_parent_id}catch(s){n(),T(s.message||"团队移动失败")}finally{f.value=!1,ye()}}function ot(t,e){const{node:n,parent:s,list:a,index:b}=t,A=n.parent_id,ie=s?{hasChildren:s.has_children,expanded:s.expanded,children:s.children?[...s.children]:void 0}:null,K={hasChildren:e.has_children,expanded:e.expanded,loaded:e.loaded??!1,children:e.children?[...e.children]:void 0};a.splice(b,1),s&&(s.has_children=a.length>0,s.has_children||(s.expanded=!1),s.children=a.length?a:void 0);const pt=K.children?[...K.children,n]:[n];return e.children=pt,e.has_children=!0,e.expanded=!0,e.loaded=!0,n.parent_id=e.team_id,()=>{n.parent_id=A,a.splice(b,0,n),s&&ie&&(s.has_children=ie.hasChildren,s.expanded=ie.expanded,s.children=ie.children?[...ie.children]:void 0),e.has_children=K.hasChildren,e.expanded=K.expanded,e.loaded=K.loaded,e.children=K.children?[...K.children]:void 0}}function re(t,e=i.value,n=null){var s;for(let a=0;a<e.length;a+=1){const b=e[a];if(b.team_id===t)return{node:b,parent:n,list:e,index:a};if((s=b.children)!=null&&s.length){const A=re(t,b.children,b);if(A)return A}}return null}function Oe(t,e=0,n=[]){return t.forEach(s=>{var a;n.push({node:s,depth:e}),s.expanded&&((a=s.children)!=null&&a.length)&&Oe(s.children,e+1,n)}),n}function Ue(t,e=[]){return t.forEach(n=>{var s;e.push(n),(s=n.children)!=null&&s.length&&Ue(n.children,e)}),e}function rt(t){return{user_id:t.user_id,name:t.name,phone:t.phone,email:t.email??null,role:t.role,status:t.status,joined_at:t.joined_at,left_at:t.left_at??null,team_path:t.team_path,tags:t.tags,metrics:t.metrics,frozen_reason:t.frozen_reason??null}}function De(t){return t?{...t,status:"active",stores_count:0,created_at:null}:null}function Pe(t){if(!t)return"—";const e=new Date(t);return Number.isNaN(e.getTime())?t:`${e.toLocaleDateString()} ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function ze(){const t=new Date;return t.setDate(t.getDate()+30),t.toISOString().slice(0,16)}function it(t){return{lead:"负责人",staff:"运营人员",promoter:"推广员",store_owner:"门店负责人",viewer:"访客"}[t]??t}function ut(t){return{active:"在岗",frozen:"冻结",left:"已离职"}[t]??t}function dt(t){return t==="archived"?"已归档":"活跃"}function vt(t){switch(t){case"queued":return"排队中";case"processing":return"处理中";case"succeeded":return"已完成";case"failed":return"失败";default:return t}}function B(t){Y.value=t,J.value="",window.setTimeout(()=>{Y.value===t&&(Y.value="")},4e3)}function T(t){J.value=t,window.setTimeout(()=>{J.value===t&&(J.value="")},5e3)}function mt(){Y.value="",J.value=""}return(t,e)=>{var n,s;return o(),r("section",wt,[l("header",Tt,[e[25]||(e[25]=l("div",null,[l("h1",{class:"org-teams__title"},"团队与人员"),l("p",{class:"org-teams__subtitle"}," 按组织树维护团队结构，支持批量邀请、导入与跨团队转移，保障权限边界。 ")],-1)),l("div",Ct,[y(k,{variant:"ghost",size:"sm",onClick:tt,disabled:f.value||$.value},{default:m(()=>[...e[24]||(e[24]=[h("导出团队",-1)])]),_:1},8,["disabled"])])]),l("div",St,[l("aside",Mt,[l("form",{class:"tree-search",onSubmit:Q(Fe,["prevent"])},[M(l("input",{class:"tree-search__input",type:"search","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),disabled:$.value,placeholder:"搜索团队 / 负责人"},null,8,$t),[[W,p.value,void 0,{trim:!0}]]),y(k,{variant:"secondary",size:"sm",type:"submit",loading:$.value},{default:m(()=>[...e[26]||(e[26]=[h("搜索",-1)])]),_:1},8,["loading"])],32),l("div",{class:"tree-container","aria-busy":$.value?"true":"false"},[$.value?(o(),r("p",Ot,"加载中…")):be.value.length?(o(),r("ul",Dt,[(o(!0),r(O,null,U(be.value,a=>(o(),r("li",{key:a.node.team_id,class:"tree-row","data-active":a.node.team_id===u.value,"data-drop":ve.value===a.node.team_id,style:yt({"--depth":a.depth}),draggable:"false"},[l("div",{class:"tree-row__inner",draggable:"true",onDragstart:b=>lt(a.node),onDragend:ye,onDragover:Q(b=>nt(a.node),["prevent"]),onDrop:Q(b=>st(a.node),["prevent"])},[a.node.has_children?(o(),r("button",{key:0,class:"tree-row__toggle",type:"button","aria-label":a.node.expanded?"收起":"展开",onClick:b=>Le(a.node)},[a.node.loading?(o(),r("span",Et,"…")):(o(),r("span",Nt,d(a.node.expanded?"▾":"▸"),1))],8,It)):(o(),r("span",jt)),l("button",{type:"button",class:"tree-row__label",onClick:b=>Te(a.node)},[l("span",Ft,d(a.node.name),1),l("span",Lt,d(a.node.members_count)+" 人",1)],8,Rt)],40,zt)],12,Pt))),128))])):(o(),r("p",Ut,"暂无团队"))],8,Vt),E.value?(o(),r("p",qt,d(E.value),1)):F("",!0)]),l("section",Bt,[V.value?(o(),r("article",At,[l("header",Gt,[l("div",null,[l("h2",null,d(V.value.name),1),l("p",Jt,[l("span",null,"负责人："+d(V.value.lead_user_name||"—"),1),l("span",null,"成员："+d(V.value.members_count),1),l("span",null,"门店："+d(V.value.stores_count),1)])]),l("span",{class:"team-summary__status","data-status":V.value.status},d(dt(V.value.status)),9,Ht)]),l("dl",Kt,[l("div",null,[e[27]||(e[27]=l("dt",null,"绑定公司",-1)),l("dd",null,d((V.value.company_bindings||[]).join(" / ")||"—"),1)]),l("div",null,[e[28]||(e[28]=l("dt",null,"标签",-1)),l("dd",null,[(n=V.value.tags)!=null&&n.length?(o(!0),r(O,{key:0},U(V.value.tags,a=>(o(),r("span",{key:a,class:"tag-chip"},d(a),1))),128)):(o(),r("span",Qt,"—"))])]),l("div",null,[e[29]||(e[29]=l("dt",null,"创建时间",-1)),l("dd",null,d(Pe(V.value.created_at)),1)]),l("div",Wt,[e[30]||(e[30]=l("dt",null,"描述",-1)),l("dd",null,d(V.value.desc||"暂无描述"),1)])])])):F("",!0),S.value?(o(),r("div",Xt,[l("div",Yt,[l("strong",null,"导入任务 "+d(S.value.task_id),1),l("span",{"data-status":S.value.status},d(vt(S.value.status)),9,Zt)]),l("div",ea,[l("progress",{value:Math.min(S.value.processed,S.value.total),max:S.value.total||1},null,8,ta),l("span",null,d(S.value.processed)+" / "+d(S.value.total),1)]),(s=S.value.error_rows)!=null&&s.length?(o(),r("ul",aa,[(o(!0),r(O,null,U(S.value.error_rows,a=>(o(),r("li",{key:`${a.row}-${a.message}`}," 第 "+d(a.row)+" 行："+d(a.message),1))),128))])):F("",!0)])):F("",!0),l("section",la,[l("header",na,[l("div",sa,[y(k,{size:"sm",variant:"secondary",disabled:!u.value||f.value,onClick:Qe},{default:m(()=>[...e[31]||(e[31]=[h("批量邀请",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"secondary",disabled:!u.value||f.value,onClick:We},{default:m(()=>[...e[32]||(e[32]=[h("批量导入",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"secondary",disabled:!Re.value,onClick:Ye},{default:m(()=>[...e[33]||(e[33]=[h("批量转移",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"secondary",disabled:!u.value||f.value,onClick:Ze},{default:m(()=>[...e[34]||(e[34]=[h("授予权限",-1)])]),_:1},8,["disabled"]),y(k,{size:"sm",variant:"ghost",disabled:R.value||!u.value,onClick:et},{default:m(()=>[...e[35]||(e[35]=[h("导出成员",-1)])]),_:1},8,["disabled"])]),l("form",{class:"members__filters",onSubmit:Q(Be,["prevent"])},[l("label",null,[e[37]||(e[37]=l("span",null,"角色",-1)),M(l("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>c.role=a),disabled:R.value},[e[36]||(e[36]=l("option",{value:""},"全部",-1)),(o(),r(O,null,U(Ee,a=>l("option",{key:a.value,value:a.value},d(a.label),9,ra)),64))],8,oa),[[ue,c.role]])]),l("label",null,[e[39]||(e[39]=l("span",null,"状态",-1)),M(l("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>c.status=a),disabled:R.value},[e[38]||(e[38]=l("option",{value:""},"全部",-1)),(o(),r(O,null,U(Ne,a=>l("option",{key:a.value,value:a.value},d(a.label),9,ua)),64))],8,ia),[[ue,c.status]])]),l("label",da,[e[40]||(e[40]=l("span",null,"关键词",-1)),M(l("input",{type:"search","onUpdate:modelValue":e[3]||(e[3]=a=>c.keyword=a),disabled:R.value,placeholder:"姓名 / 电话"},null,8,va),[[W,c.keyword,void 0,{trim:!0}]])]),y(k,{size:"sm",type:"submit",loading:R.value},{default:m(()=>[...e[41]||(e[41]=[h("应用筛选",-1)])]),_:1},8,["loading"]),y(k,{size:"sm",variant:"ghost",type:"button",onClick:Ce,disabled:R.value},{default:m(()=>[...e[42]||(e[42]=[h("重置",-1)])]),_:1},8,["disabled"])],32)]),l("div",ma,[l("table",null,[l("thead",null,[l("tr",null,[l("th",pa,[l("input",{ref_key:"pageSelectRef",ref:_e,type:"checkbox",checked:fe.value,onChange:He},null,40,ca)]),e[43]||(e[43]=l("th",null,"姓名",-1)),e[44]||(e[44]=l("th",null,"角色",-1)),e[45]||(e[45]=l("th",null,"状态",-1)),e[46]||(e[46]=l("th",null,"联系方式",-1)),e[47]||(e[47]=l("th",null,"加入时间",-1)),e[48]||(e[48]=l("th",null,"所在路径",-1)),e[49]||(e[49]=l("th",null,"标签",-1))])]),R.value?(o(),r("tbody",fa,[(o(),r(O,null,U(5,a=>l("tr",{key:`loading-${a}`},[...e[50]||(e[50]=[l("td",{colspan:"8",class:"table-skeleton"},null,-1)])])),64))])):x.value.length?(o(),r("tbody",_a,[(o(!0),r(O,null,U(x.value,a=>{var b;return o(),r("tr",{key:a.user_id},[l("td",null,[l("input",{type:"checkbox",value:a.user_id,checked:Ke(a.user_id),onChange:A=>Je(a.user_id)},null,40,ga)]),l("td",null,[l("div",ya,[l("strong",null,d(a.name),1),a.email?(o(),r("span",ha,d(a.email),1)):F("",!0)])]),l("td",null,[l("span",{class:"chip","data-role":a.role},d(it(a.role)),9,ba)]),l("td",null,[l("span",{class:"status-tag","data-status":a.status},d(ut(a.status)),9,ka)]),l("td",null,[l("div",xa,[l("span",null,d(a.phone||"—"),1),a.frozen_reason?(o(),r("span",wa,"原因："+d(a.frozen_reason),1)):F("",!0)])]),l("td",null,d(Pe(a.joined_at)),1),l("td",null,d((a.team_path||[]).join(" / ")||"—"),1),l("td",null,[(b=a.tags)!=null&&b.length?(o(!0),r(O,{key:0},U(a.tags,A=>(o(),r("span",{class:"tag-chip",key:`${a.user_id}-${A}`},d(A),1))),128)):(o(),r("span",Ta,"—"))])])}),128))])):(o(),r("tbody",Ca,[...e[51]||(e[51]=[l("tr",null,[l("td",{colspan:"8",class:"table-empty"},"暂无成员")],-1)])]))])]),ke.value>1?(o(),ht(xt,{key:0,page:c.page,pages:ke.value,"page-size":c.page_size,"onUpdate:page":Ae,"onUpdate:pageSize":Ge},null,8,["page","pages","page-size"])):F("",!0)]),Y.value?(o(),r("p",Sa,d(Y.value),1)):F("",!0),J.value?(o(),r("p",Ma,d(J.value),1)):F("",!0)])]),y(pe,{modelValue:ae.value,"onUpdate:modelValue":e[9]||(e[9]=a=>ae.value=a),onConfirm:Se},{title:m(()=>[...e[52]||(e[52]=[h("批量邀请成员",-1)])]),footer:m(()=>[y(k,{variant:"secondary",onClick:e[8]||(e[8]=a=>ae.value=!1)},{default:m(()=>[...e[56]||(e[56]=[h("取消",-1)])]),_:1}),y(k,{variant:"primary",loading:f.value,onClick:Se},{default:m(()=>[...e[57]||(e[57]=[h("生成邀请",-1)])]),_:1},8,["loading"])]),default:m(()=>[l("form",{class:"modal-form",onSubmit:e[7]||(e[7]=Q(()=>{},["prevent"]))},[l("label",null,[e[53]||(e[53]=l("span",null,"目标团队",-1)),M(l("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>C.target_team_id=a)},[(o(!0),r(O,null,U(ce.value,a=>(o(),r("option",{key:a.team_id,value:a.team_id},d(a.name),9,$a))),128))],512),[[ue,C.target_team_id]])]),l("label",null,[e[54]||(e[54]=l("span",null,"邀请配额",-1)),M(l("input",{type:"number",min:"1","onUpdate:modelValue":e[5]||(e[5]=a=>C.quota=a)},null,512),[[W,C.quota,void 0,{number:!0}]])]),l("label",null,[e[55]||(e[55]=l("span",null,"有效期",-1)),M(l("input",{type:"datetime-local","onUpdate:modelValue":e[6]||(e[6]=a=>C.expires_at=a)},null,512),[[W,C.expires_at]])])],32)]),_:1},8,["modelValue"]),y(pe,{modelValue:le.value,"onUpdate:modelValue":e[16]||(e[16]=a=>le.value=a),onConfirm:Me},{title:m(()=>[...e[58]||(e[58]=[h("批量导入成员",-1)])]),footer:m(()=>[y(k,{variant:"secondary",onClick:e[15]||(e[15]=a=>le.value=!1)},{default:m(()=>[...e[63]||(e[63]=[h("取消",-1)])]),_:1}),y(k,{variant:"primary",loading:f.value||de.value,onClick:Me},{default:m(()=>[...e[64]||(e[64]=[h("提交导入",-1)])]),_:1},8,["loading"])]),default:m(()=>[l("form",{class:"modal-form",onSubmit:e[14]||(e[14]=Q(()=>{},["prevent"]))},[l("label",null,[e[59]||(e[59]=l("span",null,"目标团队",-1)),M(l("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>w.target_team_id=a)},[(o(!0),r(O,null,U(ce.value,a=>(o(),r("option",{key:a.team_id,value:a.team_id},d(a.name),9,Va))),128))],512),[[ue,w.target_team_id]])]),l("label",null,[e[60]||(e[60]=l("span",null,"上传凭证",-1)),M(l("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=a=>w.upload_token=a),placeholder:"粘贴上传后的 token"},null,512),[[W,w.upload_token,void 0,{trim:!0}]])]),l("label",null,[e[61]||(e[61]=l("span",null,"通知邮箱（可选）",-1)),M(l("input",{type:"email","onUpdate:modelValue":e[12]||(e[12]=a=>w.notify_email=a),placeholder:"ops@example.com"},null,512),[[W,w.notify_email,void 0,{trim:!0}]])]),l("label",Oa,[M(l("input",{type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=a=>w.dry_run=a)},null,512),[[bt,w.dry_run]]),e[62]||(e[62]=l("span",null,"仅校验，不落库",-1))])],32)]),_:1},8,["modelValue"]),y(pe,{modelValue:ne.value,"onUpdate:modelValue":e[19]||(e[19]=a=>ne.value=a),onConfirm:$e},{title:m(()=>[...e[65]||(e[65]=[h("批量转移成员",-1)])]),footer:m(()=>[y(k,{variant:"secondary",onClick:e[18]||(e[18]=a=>ne.value=!1)},{default:m(()=>[...e[68]||(e[68]=[h("取消",-1)])]),_:1}),y(k,{variant:"primary",disabled:!X.target_team_id,loading:f.value,onClick:$e},{default:m(()=>[...e[69]||(e[69]=[h("确认转移",-1)])]),_:1},8,["disabled","loading"])]),default:m(()=>[l("p",Ua,"已选择 "+d(_.value.length)+" 人，转移后将继承目标团队权限。",1),l("label",Da,[e[67]||(e[67]=l("span",null,"目标团队",-1)),M(l("select",{"onUpdate:modelValue":e[17]||(e[17]=a=>X.target_team_id=a)},[e[66]||(e[66]=l("option",{value:""},"选择团队",-1)),(o(!0),r(O,null,U(ce.value,a=>(o(),r("option",{key:a.team_id,value:a.team_id,disabled:a.team_id===u.value},d(a.name),9,Pa))),128))],512),[[ue,X.target_team_id]])])]),_:1},8,["modelValue"]),y(pe,{modelValue:se.value,"onUpdate:modelValue":e[23]||(e[23]=a=>se.value=a),onConfirm:Ve},{title:m(()=>[...e[70]||(e[70]=[h("授予团队权限",-1)])]),footer:m(()=>[y(k,{variant:"secondary",onClick:e[22]||(e[22]=a=>se.value=!1)},{default:m(()=>[...e[73]||(e[73]=[h("取消",-1)])]),_:1}),y(k,{variant:"primary",loading:f.value,onClick:Ve},{default:m(()=>[...e[74]||(e[74]=[h("保存",-1)])]),_:1},8,["loading"])]),default:m(()=>[l("form",{class:"modal-form",onSubmit:e[21]||(e[21]=Q(()=>{},["prevent"]))},[l("fieldset",za,[e[71]||(e[71]=l("legend",null,"可见角色",-1)),(o(),r(O,null,U(je,a=>l("label",{key:a.value,class:"checkbox"},[l("input",{type:"checkbox",value:a.value,checked:N.roles.includes(a.value),onChange:b=>at(a.value,b)},null,40,Ia),l("span",null,d(a.label),1)])),64))]),l("label",null,[e[72]||(e[72]=l("span",null,"截止时间（可选）",-1)),M(l("input",{type:"datetime-local","onUpdate:modelValue":e[20]||(e[20]=a=>N.expires_at=a)},null,512),[[W,N.expires_at]])])],32)]),_:1},8,["modelValue"])])}}}),La=kt(Ea,[["__scopeId","data-v-64b848f2"]]);export{La as default};
