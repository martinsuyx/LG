var $=e=>{throw TypeError(e)};var O=(e,t,r)=>t.has(e)||$("Cannot "+r);var o=(e,t,r)=>(O(e,t,"read from private field"),r?r.call(e):t.get(e)),y=(e,t,r)=>t.has(e)?$("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),h=(e,t,r,n)=>(O(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);class A extends Error{constructor(t,r,n){super(n),this.name="ApiError",this.url=r.url,this.status=r.status,this.statusText=r.statusText,this.body=r.body,this.request=t}}class q extends Error{constructor(t){super(t),this.name="CancelError"}get isCancelled(){return!0}}var u,f,d,l,p,S,b;class N{constructor(t){y(this,u);y(this,f);y(this,d);y(this,l);y(this,p);y(this,S);y(this,b);h(this,u,!1),h(this,f,!1),h(this,d,!1),h(this,l,[]),h(this,p,new Promise((r,n)=>{h(this,S,r),h(this,b,n);const s=c=>{o(this,u)||o(this,f)||o(this,d)||(h(this,u,!0),o(this,S)&&o(this,S).call(this,c))},i=c=>{o(this,u)||o(this,f)||o(this,d)||(h(this,f,!0),o(this,b)&&o(this,b).call(this,c))},a=c=>{o(this,u)||o(this,f)||o(this,d)||o(this,l).push(c)};return Object.defineProperty(a,"isResolved",{get:()=>o(this,u)}),Object.defineProperty(a,"isRejected",{get:()=>o(this,f)}),Object.defineProperty(a,"isCancelled",{get:()=>o(this,d)}),t(s,i,a)}))}get[Symbol.toStringTag](){return"Cancellable Promise"}then(t,r){return o(this,p).then(t,r)}catch(t){return o(this,p).catch(t)}finally(t){return o(this,p).finally(t)}cancel(){if(!(o(this,u)||o(this,f)||o(this,d))){if(h(this,d,!0),o(this,l).length)try{for(const t of o(this,l))t()}catch(t){console.warn("Cancellation threw an error",t);return}o(this,l).length=0,o(this,b)&&o(this,b).call(this,new q("Request aborted"))}}get isCancelled(){return o(this,d)}}u=new WeakMap,f=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakMap,S=new WeakMap,b=new WeakMap;const C=e=>e!=null,w=e=>typeof e=="string",E=e=>w(e)&&e!=="",T=e=>typeof e=="object"&&typeof e.type=="string"&&typeof e.stream=="function"&&typeof e.arrayBuffer=="function"&&typeof e.constructor=="function"&&typeof e.constructor.name=="string"&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]),B=e=>e instanceof FormData,P=e=>{try{return btoa(e)}catch{return Buffer.from(e).toString("base64")}},F=e=>{const t=[],r=(s,i)=>{t.push(`${encodeURIComponent(s)}=${encodeURIComponent(String(i))}`)},n=(s,i)=>{C(i)&&(Array.isArray(i)?i.forEach(a=>{n(s,a)}):typeof i=="object"?Object.entries(i).forEach(([a,c])=>{n(`${s}[${a}]`,c)}):r(s,i))};return Object.entries(e).forEach(([s,i])=>{n(s,i)}),t.length>0?`?${t.join("&")}`:""},H=(e,t)=>{const r=encodeURI,n=t.url.replace("{api-version}",e.VERSION).replace(/{(.*?)}/g,(i,a)=>{var c;return(c=t.path)!=null&&c.hasOwnProperty(a)?r(String(t.path[a])):i}),s=`${e.BASE}${n}`;return t.query?`${s}${F(t.query)}`:s},U=e=>{if(e.formData){const t=new FormData,r=(n,s)=>{w(s)||T(s)?t.append(n,s):t.append(n,JSON.stringify(s))};return Object.entries(e.formData).filter(([n,s])=>C(s)).forEach(([n,s])=>{Array.isArray(s)?s.forEach(i=>r(n,i)):r(n,s)}),t}},j=async(e,t)=>typeof t=="function"?t(e):t,J=async(e,t)=>{const[r,n,s,i]=await Promise.all([j(t,e.TOKEN),j(t,e.USERNAME),j(t,e.PASSWORD),j(t,e.HEADERS)]),a=Object.entries({Accept:"application/json",...i,...t.headers}).filter(([c,g])=>C(g)).reduce((c,[g,m])=>({...c,[g]:String(m)}),{});if(E(r)&&(a.Authorization=`Bearer ${r}`),E(n)&&E(s)){const c=P(`${n}:${s}`);a.Authorization=`Basic ${c}`}return t.body&&(t.mediaType?a["Content-Type"]=t.mediaType:T(t.body)?a["Content-Type"]=t.body.type||"application/octet-stream":w(t.body)?a["Content-Type"]="text/plain":B(t.body)||(a["Content-Type"]="application/json")),new Headers(a)},I=e=>{var t;if(e.body!==void 0)return(t=e.mediaType)!=null&&t.includes("/json")?JSON.stringify(e.body):w(e.body)||T(e.body)||B(e.body)?e.body:JSON.stringify(e.body)},z=async(e,t,r,n,s,i,a)=>{const c=new AbortController,g={headers:i,body:n??s,method:t.method,signal:c.signal};return a(()=>c.abort()),await fetch(r,g)},W=(e,t)=>{if(t){const r=e.headers.get(t);if(w(r))return r}},k=async e=>{if(e.status!==204)try{const t=e.headers.get("Content-Type");if(t)return["application/json","application/problem+json"].some(s=>t.toLowerCase().startsWith(s))?await e.json():await e.text()}catch(t){console.error(t)}},G=(e,t)=>{const n={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[t.status];if(n)throw new A(e,t,n);if(!t.ok){const s=t.status??"unknown",i=t.statusText??"unknown",a=(()=>{try{return JSON.stringify(t.body,null,2)}catch{return}})();throw new A(e,t,`Generic Error: status: ${s}; status text: ${i}; body: ${a}`)}},_=(e,t)=>new N(async(r,n,s)=>{try{const i=H(e,t),a=U(t),c=I(t),g=await J(e,t);if(!s.isCancelled){const m=await z(e,t,i,c,a,g,s),x=await k(m),D=W(m,t.responseHeader),R={url:i,ok:m.ok,status:m.status,statusText:m.statusText,body:D??x};G(t,R),r(R.body)}}catch(i){n(i)}});export{_ as r};
