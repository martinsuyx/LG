import{O as De,d as cs,a as te,r as U,c as ae,w as ps,b as o,e as s,f as k,t as r,i as d,j as F,F as S,h as T,v as m,k as fs,s as j,y as Q,q as n,_ as bs}from"./index-DvtP9USg.js";function z(){return{"Content-Type":"application/json",...De.HEADERS||{}}}function I(c,b){var oe;const V=((oe=De.BASE)==null?void 0:oe.replace(/\/$/,""))||"";if(!b)return`${V}${c}`;const L=new URLSearchParams;Object.entries(b).forEach(([ne,M])=>{if(!(M==null||M===""||Number.isNaN(M)))if(Array.isArray(M)){if(!M.length)return;L.append(ne,M.join(","))}else L.append(ne,String(M))});const X=L.toString();return X?`${V}${c}?${X}`:`${V}${c}`}async function A(c,b){const V=await fetch(c,b);if(!V.ok){const L=await V.text();throw new Error(L||`Request failed with ${V.status}`)}if(V.status!==204)return await V.json()}const R={async listTasks(c){const b=I("/api/v1/tasks",c);return A(b,{method:"GET",headers:z()})},async getTask(c){const b=I(`/api/v1/tasks/${encodeURIComponent(c)}`);return A(b,{method:"GET",headers:z()})},async createTask(c){const b=I("/api/v1/tasks");return A(b,{method:"POST",headers:z(),body:JSON.stringify(c)})},async updateTask(c,b){const V=I(`/api/v1/tasks/${encodeURIComponent(c)}`);return A(V,{method:"PUT",headers:z(),body:JSON.stringify(b)})},async validateTask(c){const b=I(`/api/v1/tasks/${encodeURIComponent(c)}/validate`);return A(b,{method:"POST",headers:z()})},async publishTask(c){const b=I(`/api/v1/tasks/${encodeURIComponent(c)}/publish`);return A(b,{method:"POST",headers:z()})},async offlineTask(c,b){const V=I(`/api/v1/tasks/${encodeURIComponent(c)}/offline`);return A(V,{method:"POST",headers:z(),body:JSON.stringify({reason:b})})},async cloneTask(c){const b=I(`/api/v1/tasks/${encodeURIComponent(c)}/clone`);return A(b,{method:"POST",headers:z()})},async listVersions(c,b=1,V=20){const L=I(`/api/v1/tasks/${encodeURIComponent(c)}/versions`,{page:b,page_size:V});return A(L,{method:"GET",headers:z()})},async exportTasks(c){const b=I("/api/v1/exports/tasks");return A(b,{method:"POST",headers:z(),body:JSON.stringify(c)})}},ms={class:"tasks"},ks={class:"tasks__head"},ys={class:"tasks__actions"},hs=["disabled"],gs=["disabled"],ws={class:"filters__row"},Vs={class:"filters__field"},Cs=["value"],Us={class:"filters__field"},Ss=["value"],Ts={class:"filters__field"},xs=["value"],$s={class:"filters__field"},Ds=["value"],Os={class:"filters__field filters__field--keyword"},Rs={class:"filters__field"},Es={class:"filters__field"},Fs={class:"filters__actions"},Ls=["disabled"],Ms=["disabled"],Ns={class:"tasks__table"},Ps={key:0},zs={key:1},Is=["onClick"],As=["data-status"],qs={class:"col-actions"},js={class:"row-actions"},Bs=["onClick","disabled"],Js=["onClick","disabled"],Zs=["onClick","disabled"],Gs=["onClick","disabled"],Hs={key:2},Ws={key:0,class:"tasks__pager"},Ks=["disabled"],Qs=["disabled"],Xs={class:"pager__size"},Ys=["value"],el=["value"],sl={key:1,class:"feedback feedback--error"},ll={key:2,class:"feedback"},tl={key:3,class:"tasks-drawer"},al={class:"tasks-drawer__panel",role:"dialog","aria-modal":"true"},ol={class:"tasks-drawer__header"},nl={class:"drawer-title"},il=["data-status"],rl={class:"drawer-actions"},dl=["disabled"],ul=["disabled"],vl=["disabled"],_l=["disabled"],cl={class:"tasks-drawer__steps"},pl=["data-active","disabled","onClick"],fl={class:"drawer-step__index"},bl={class:"tasks-drawer__body"},ml={key:0,class:"step-block"},kl={class:"form-grid"},yl=["data-error"],hl=["disabled"],gl={key:0,class:"form-error"},wl=["data-error"],Vl=["disabled"],Cl={key:0,class:"form-error"},Ul=["data-error"],Sl=["disabled"],Tl=["data-error"],xl=["disabled"],$l={key:0,class:"form-error"},Dl=["data-error"],Ol=["disabled"],Rl={key:0,class:"form-error"},El={class:"form-field form-field--full"},Fl={class:"checkbox-group"},Ll=["value","disabled"],Ml=["data-error"],Nl={class:"scope-group"},Pl={class:"checkbox-group"},zl=["value","disabled"],Il={class:"checkbox-group"},Al=["value","disabled"],ql={class:"checkbox-group checkbox-group--columns"},jl=["value","disabled"],Bl={key:0,class:"form-error"},Jl={key:1,class:"step-block"},Zl={class:"form-grid"},Gl=["data-error"],Hl=["disabled"],Wl=["value"],Kl={key:0,class:"form-error"},Ql={class:"form-field"},Xl=["disabled"],Yl={class:"dsl-map-head"},et=["disabled"],st={key:0,class:"form-error"},lt={key:1,class:"empty"},tt={class:"form-field"},at=["onUpdate:modelValue","disabled"],ot={class:"form-field"},nt=["onUpdate:modelValue","disabled"],it={class:"form-field mapping-checkbox"},rt=["onUpdate:modelValue","disabled"],dt={class:"form-field"},ut=["value","disabled","onChange"],vt={key:0,class:"form-field"},_t=["onUpdate:modelValue","disabled"],ct={key:1,class:"range-grid"},pt={class:"form-field"},ft=["onUpdate:modelValue","disabled"],bt={class:"form-field"},mt=["onUpdate:modelValue","disabled"],kt=["onClick","disabled"],yt={key:2,class:"step-block"},ht={class:"plans-head"},gt=["disabled"],wt={key:0,class:"empty"},Vt={class:"form-field"},Ct=["onUpdate:modelValue","disabled"],Ut={class:"form-field"},St=["onUpdate:modelValue","disabled"],Tt={class:"form-field"},xt=["onUpdate:modelValue","disabled"],$t={class:"form-field form-field--full"},Dt=["onUpdate:modelValue","disabled"],Ot=["onClick","disabled"],Rt={class:"plans-head"},Et=["disabled"],Ft={key:1,class:"empty"},Lt={class:"form-field"},Mt=["onUpdate:modelValue","disabled"],Nt={class:"form-field"},Pt=["onUpdate:modelValue","disabled"],zt={class:"form-field"},It=["onUpdate:modelValue","disabled"],At={class:"form-field"},qt=["onUpdate:modelValue","disabled"],jt=["onClick","disabled"],Bt={class:"flow-grid"},Jt={class:"form-field"},Zt=["disabled"],Gt={class:"form-field"},Ht=["disabled"],Wt={class:"form-field form-field--switch"},Kt=["disabled"],Qt={class:"form-field"},Xt=["disabled"],Yt={key:3,class:"step-block"},ea={class:"form-grid"},sa={class:"form-field"},la=["disabled"],ta=["value"],aa={class:"form-field"},oa=["disabled"],na={key:4,class:"step-block flow-grid"},ia={class:"form-field"},ra=["disabled"],da={key:0,class:"form-field"},ua=["disabled"],va={key:1,class:"form-field"},_a=["disabled"],ca={class:"form-field"},pa=["disabled"],fa={key:2,class:"form-error"},ba={key:5,class:"step-block"},ma={class:"versions-head"},ka=["disabled"],ya={key:0,class:"empty"},ha={key:1,class:"version-list"},ga={key:0,class:"version-diff"},wa={class:"tasks-drawer__footer"},Va=["disabled"],Ca=["disabled"],Ua=["disabled"],Sa={key:4,class:"offline-modal"},Ta={class:"offline-modal__panel",role:"dialog","aria-modal":"true"},xa={key:0,class:"form-error"},$a=["disabled"],Da=cs({__name:"TasksPage",setup(c){const b=[{value:"draft",label:"草稿"},{value:"published",label:"已发布"},{value:"offline",label:"已下架"},{value:"deprecated",label:"已废弃"}],V=[{value:"F123",label:"F123 · 实名开户"},{value:"F208",label:"F208 · 回访表单"},{value:"F305",label:"F305 · 材料补充"}],L=[{value:"R001",label:"R001 · 身份核验"},{value:"R006",label:"R006 · 黑名单拦截"},{value:"R008",label:"R008 · 资料抽查"}],X=[{value:"operator",label:"运营人员"},{value:"promoter",label:"推广人员"},{value:"store_owner",label:"门店负责人"},{value:"reviewer",label:"审核员"}],oe=["华南事业部","华中事业部","华北事业部"],ne=[{value:"GZ",label:"广州"},{value:"SZ",label:"深圳"},{value:"FS",label:"佛山"},{value:"DG",label:"东莞"}],M=[{value:"S001",label:"S001 天河旗舰店"},{value:"S002",label:"S002 海珠江畔店"},{value:"SZ101",label:"SZ101 福田中心店"},{value:"FS002",label:"FS002 顺德乐从店"}],Z=[{key:"basic",label:"基本信息"},{key:"dsl",label:"表单绑定"},{key:"rules",label:"审核规则"},{key:"risk",label:"风控策略"},{key:"flow",label:"发布策略"},{key:"versions",label:"版本日志"}],u=te({status:"",form_dsl_id:"",risk_policy_id:"",role:"",keyword:"",page:1,page_size:10,sort_key:"start_time",sort_order:"desc"}),ue=U([]),ve=U(0),q=U(!1),ie=U(!1),C=U(!1),_e=U(!1),Y=U(!1),w=U(""),O=U(""),Oe=[10,20,50],H=U(!1),x=U("create"),$=U(0),l=te({name:"",code:"",desc:"",start_time:"",end_time:"",visible_to_roles:[],scope:{companies:[],cities:[],stores:[]},form_dsl_id:"",form_dsl:{schema_version:"",fields:[],fields_map:[]},review_rules:{auto_checks:[],thresholds:[],sampling:{percent:0,seed:""},double_review:!1,sla:60},risk_policy_id:"",risk_action:"queue",release:{mode:"immediate",schedule_time:"",gray_percent:0,rollback_to_version:null}}),ce=U({}),h=U(null),D=U("draft"),G=te({total:0,items:[]}),re=U(!1),p=te({name:"",code:"",desc:"",start_time:"",end_time:""}),E=te({form_dsl_id:"",fields_map:""}),W=U(""),K=U(""),Re=ae(()=>x.value==="create"?"新建任务":x.value==="edit"?"编辑任务":"任务详情"),de=ae(()=>u.page_size?Math.max(1,Math.ceil(ve.value/u.page_size)):1),ee=ae(()=>Z[$.value]),i=ae(()=>x.value==="view"),ke=ae({get:()=>{var a;return((a=l.release)==null?void 0:a.schedule_time)||""},set:a=>{l.release||(l.release={}),l.release.schedule_time=a}});function ye(a){switch(a){case"draft":return"草稿";case"published":return"已发布";case"offline":return"已下架";case"deprecated":return"已废弃";default:return a}}function pe(a){return a==="draft"||a==="offline"}function fe(a){return a==="draft"||a==="offline"}async function N(){q.value=!0,w.value="";try{const a=await R.listTasks(u);ue.value=a.items||[],ve.value=a.total||0}catch(a){w.value=P(a)}finally{q.value=!1}}function Ee(){u.page=1,N()}function Fe(){u.status="",u.form_dsl_id="",u.risk_policy_id="",u.role="",u.keyword="",u.page=1,u.page_size=10,u.sort_key="start_time",u.sort_order="desc",N()}function he(a){a<1||a>de.value||(u.page=a,N())}function Le(a){const e=Number(a.target.value);u.page_size=e||10,u.page=1,N()}function P(a){return typeof a=="string"?a:a&&typeof a=="object"&&"message"in a?String(a.message):"操作失败，请稍后再试"}function Me(){l.name="",l.code="",l.desc="",l.start_time="",l.end_time="",l.visible_to_roles=[],l.scope.companies=[],l.scope.cities=[],l.scope.stores=[],l.form_dsl_id="",l.form_dsl.schema_version="",l.form_dsl.fields=[],l.form_dsl.fields_map=[],l.review_rules.auto_checks=[],l.review_rules.thresholds=[],l.review_rules.sampling={percent:0,seed:""},l.review_rules.double_review=!1,l.review_rules.sla=60,l.risk_policy_id="",l.risk_action="queue",l.release={mode:"immediate",schedule_time:"",gray_percent:0,rollback_to_version:null}}function ge(a){var e,_,g,t,v,f,B,J,se,le;l.name=a.name,l.code=a.code,l.desc=a.desc||"",l.start_time=a.start_time?a.start_time.slice(0,16):"",l.end_time=a.end_time?a.end_time.slice(0,16):"",l.visible_to_roles=[...a.visible_to_roles||[]],l.scope.companies=a.scope.companies?[...a.scope.companies]:[],l.scope.cities=a.scope.cities?[...a.scope.cities]:[],l.scope.stores=a.scope.stores?[...a.scope.stores]:[],l.form_dsl_id=a.form_dsl_id,l.form_dsl.schema_version=((e=a.form_dsl)==null?void 0:e.schema_version)||"",l.form_dsl.fields=(_=a.form_dsl)!=null&&_.fields?[...a.form_dsl.fields]:[],l.form_dsl.fields_map=(g=a.form_dsl)!=null&&g.fields_map?a.form_dsl.fields_map.map(y=>({...y,validation:y.validation?{...y.validation}:void 0})):[],l.review_rules.auto_checks=(t=a.review_rules)!=null&&t.auto_checks?a.review_rules.auto_checks.map(y=>({...y})):[],l.review_rules.thresholds=(v=a.review_rules)!=null&&v.thresholds?a.review_rules.thresholds.map(y=>({...y})):[],l.review_rules.sampling=(f=a.review_rules)!=null&&f.sampling?{...a.review_rules.sampling}:{percent:0,seed:""},l.review_rules.double_review=!!((B=a.review_rules)!=null&&B.double_review),l.review_rules.sla=((J=a.review_rules)==null?void 0:J.sla)??60,l.risk_policy_id=a.risk_policy_id||"",l.risk_action=a.risk_action||"queue",l.release=a.release?{...a.release}:{mode:"immediate",schedule_time:"",gray_percent:0,rollback_to_version:null},l.release&&l.release.schedule_time&&(l.release.schedule_time=l.release.schedule_time.slice(0,16)),G.total=((se=a.versions)==null?void 0:se.total)||0,G.items=(le=a.versions)!=null&&le.items?[...a.versions.items]:[]}function Ne(){Me(),x.value="create",H.value=!0,$.value=0,h.value=null,D.value="draft",Ce(),G.total=0,G.items=[]}async function Pe(a){await we("view",a),$.value=Z.length-1}async function ze(a){await we("edit",a)}async function we(a,e){x.value=a,H.value=!0,$.value=0,Ce();try{const g=ce.value[e.task_id]||await R.getTask(e.task_id);ce.value[e.task_id]=g,ge(g),h.value=g.task_id,D.value=g.status}catch(_){w.value=P(_),H.value=!1}}function be(){H.value=!1}function Ie(){pe(D.value)&&(x.value="edit",$.value=0)}function Ae(){$.value>=Z.length-1||me($.value)&&($.value+=1)}function qe(){$.value!==0&&($.value-=1)}function Ve(a){if(i.value||a<=$.value)return!0;for(let e=0;e<a;e+=1)if(!me(e))return!1;return!0}function je(a){Ve(a)&&($.value=a)}function Ce(){p.name="",p.code="",p.desc="",p.start_time="",p.end_time="",E.form_dsl_id="",E.fields_map="",W.value="",K.value=""}function me(a){const e=Z[a].key;return e==="basic"?Be():e==="dsl"?Je():e==="rules"?Ze():e==="flow"?Ge():!0}function Be(){var g,t,v,f;let a=!0;p.name="",p.code="",p.start_time="",p.end_time="",W.value="",(!l.name||l.name.trim().length<2||l.name.trim().length>40)&&(p.name="请输入 2-40 字名称",a=!1);const e=(g=l.code)==null?void 0:g.trim();if(/^[A-Z0-9]{3,16}$/.test(e)||(p.code="任务码需为 3-16 位大写字母或数字",a=!1),l.start_time||(p.start_time="请选择开始时间",a=!1),l.end_time||(p.end_time="请选择结束时间",a=!1),l.start_time&&l.end_time){const B=new Date(l.start_time).getTime(),J=new Date(l.end_time).getTime();Number.isFinite(B)&&Number.isFinite(J)&&B>=J&&(p.end_time="结束时间需晚于开始时间",a=!1)}return(((t=l.scope.companies)==null?void 0:t.length)||0)+(((v=l.scope.cities)==null?void 0:v.length)||0)+(((f=l.scope.stores)==null?void 0:f.length)||0)||(W.value="至少选择一个范围维度",a=!1),a}function Je(){E.form_dsl_id="",E.fields_map="";let a=!0;return l.form_dsl_id||(E.form_dsl_id="请选择表单 DSL",a=!1),(!l.form_dsl.fields_map||!l.form_dsl.fields_map.length)&&(E.fields_map="请至少配置一个字段映射",a=!1),a}function Ze(){var e;const a=((e=l.review_rules.sampling)==null?void 0:e.percent)??0;return a<0||a>100?(O.value="抽审比例需在 0-100 之间",!1):!0}function Ge(){var a,e;if(K.value="",((a=l.release)==null?void 0:a.mode)==="scheduled"&&!l.release.schedule_time)return K.value="请选择定时发布时间",!1;if(((e=l.release)==null?void 0:e.mode)==="gray"){const _=l.release.gray_percent??0;if(_<0||_>100)return K.value="灰度比例需在 0-100 之间",!1}return!0}function Ue(){return Z.every((a,e)=>me(e))}function Se(){var a;return{name:l.name.trim(),code:l.code.trim(),desc:(a=l.desc)==null?void 0:a.trim(),start_time:l.start_time?new Date(l.start_time).toISOString():"",end_time:l.end_time?new Date(l.end_time).toISOString():"",visible_to_roles:[...l.visible_to_roles],scope:{companies:l.scope.companies?[...l.scope.companies]:[],cities:l.scope.cities?[...l.scope.cities]:[],stores:l.scope.stores?[...l.scope.stores]:[]},form_dsl_id:l.form_dsl_id,form_dsl:{schema_version:l.form_dsl.schema_version,fields:l.form_dsl.fields?l.form_dsl.fields.map(e=>({...e})):[],fields_map:l.form_dsl.fields_map?l.form_dsl.fields_map.map(e=>({...e})):[]},review_rules:{auto_checks:l.review_rules.auto_checks?l.review_rules.auto_checks.map(e=>({...e})):[],thresholds:l.review_rules.thresholds?l.review_rules.thresholds.map(e=>({...e})):[],sampling:l.review_rules.sampling?{...l.review_rules.sampling}:void 0,double_review:l.review_rules.double_review,sla:l.review_rules.sla},risk_policy_id:l.risk_policy_id||null,risk_action:l.risk_action,release:(()=>{if(!l.release)return;const e={...l.release};return e.schedule_time&&(e.schedule_time=new Date(e.schedule_time).toISOString()),e})()}}async function Te(){if(Ue()){Y.value=!0,w.value="",O.value="";try{const a=Se();if(h.value){const e=await R.updateTask(h.value,a);D.value=e.status||D.value,O.value="草稿已保存"}else{const e=await R.createTask(a);h.value=e.task_id,D.value=e.status||"draft",O.value="草稿创建成功"}await N(),x.value="edit"}catch(a){w.value=P(a)}finally{Y.value=!1}}}async function He(){var a;if(!(!h.value&&(await Te(),!h.value))){_e.value=!0,w.value="",O.value="";try{const e=await R.validateTask(h.value);e.ok?O.value=(a=e.warnings)!=null&&a.length?`校验通过：${e.warnings.map(_=>_.message).join("；")}`:"校验通过":w.value=`校验失败：缺少字段 ${e.missing_fields.join(", ")} / 规则错误 ${e.invalid_rules.map(_=>`${_.key||"-"} ${_.reason||""}`).join("；")}`}catch(e){w.value=P(e)}finally{_e.value=!1}}}async function We(a){if(fe(a.status)){C.value=!0,w.value="";try{await R.publishTask(a.task_id),O.value="任务已发布",await N()}catch(e){w.value=P(e)}finally{C.value=!1}}}async function Ke(){if(h.value&&Ue()){C.value=!0,w.value="";try{if(x.value!=="view"){const a=Se();await R.updateTask(h.value,a)}await R.publishTask(h.value),D.value="published",O.value="任务已发布",await N(),x.value="view"}catch(a){w.value=P(a)}finally{C.value=!1}}}function Qe(a){h.value=a.task_id,offlineReason.value="",offlineError.value="",offlineModalVisible.value=!0}function Xe(){h.value&&(offlineReason.value="",offlineError.value="",offlineModalVisible.value=!0)}function xe(){offlineModalVisible.value=!1}async function Ye(){if(h.value){if(!offlineReason.value||offlineReason.value.trim().length<5){offlineError.value="请输入不少于 5 个字的原因";return}C.value=!0,offlineError.value="";try{await R.offlineTask(h.value,offlineReason.value.trim()),D.value="offline",O.value="任务已下架",offlineModalVisible.value=!1,await N(),x.value!=="create"&&(x.value="view")}catch(a){offlineError.value=P(a)}finally{C.value=!1}}}async function $e(a){C.value=!0,w.value="";try{const e=await R.cloneTask(a.task_id);O.value="复制成功，已生成草稿",await N();const _=await R.getTask(e.task_id);ce.value[e.task_id]=_,ge(_),h.value=_.task_id,D.value=_.status,x.value="edit",H.value=!0,$.value=0}catch(e){w.value=P(e)}finally{C.value=!1}}async function es(){h.value&&await $e({task_id:h.value,name:l.name,code:l.code,status:D.value,version:0,start_time:new Date(l.start_time).toISOString(),end_time:new Date(l.end_time).toISOString(),form_dsl_id:l.form_dsl_id,risk_policy_id:l.risk_policy_id||void 0,visible_to_roles:[...l.visible_to_roles],scope:{...l.scope}})}async function ss(){ie.value=!0,w.value="",O.value="";try{await R.exportTasks(u),O.value="导出任务已提交"}catch(a){w.value=P(a)}finally{ie.value=!1}}async function ls(){if(h.value){re.value=!0;try{const a=await R.listVersions(h.value);G.total=a.total,G.items=a.items||[]}catch(a){w.value=P(a)}finally{re.value=!1}}}function ts(){i.value||(l.form_dsl.fields_map||(l.form_dsl.fields_map=[]),l.form_dsl.fields_map.push({dsl_key:"",biz_key:"",required:!0}))}function as(a){var e;i.value||(e=l.form_dsl.fields_map)==null||e.splice(a,1)}function os(a,e){if(i.value)return;const _=e.target.value;if(!l.form_dsl.fields_map)return;if(!_){l.form_dsl.fields_map[a].validation=void 0;return}const g=l.form_dsl.fields_map[a].validation||{};g.type=_,_==="range"?(g.min=0,g.max=100):g.value="",l.form_dsl.fields_map[a].validation=g}function ns(){i.value||(l.review_rules.auto_checks||(l.review_rules.auto_checks=[]),l.review_rules.auto_checks.push({key:"",rule:"",level:"error",message:""}))}function is(a){var e;i.value||(e=l.review_rules.auto_checks)==null||e.splice(a,1)}function rs(){i.value||(l.review_rules.thresholds||(l.review_rules.thresholds=[]),l.review_rules.thresholds.push({key:"",op:">=",value:0,action:"manual_review"}))}function ds(a){var e;i.value||(e=l.review_rules.thresholds)==null||e.splice(a,1)}function us(a,e){if(!a||!e)return"-";const _=new Date(a).toLocaleString("zh-CN",{hour12:!1}),g=new Date(e).toLocaleString("zh-CN",{hour12:!1});return`${_} ~ ${g}`}function vs(a){return new Date(a).toLocaleString("zh-CN",{hour12:!1})}function _s(a){return a?JSON.stringify(a,null,2):""}return ps(()=>l.code,a=>{if(typeof a!="string")return;const e=a.toUpperCase().replace(/[^A-Z0-9]/g,"");e!==a&&(l.code=e)}),N(),(a,e)=>{var _,g;return n(),o("section",ms,[s("header",ks,[e[32]||(e[32]=s("div",null,[s("h1",{class:"tasks__title"},"任务管理"),s("p",{class:"tasks__subtitle"},"组合表单 DSL、审核规则与风控策略，驱动前线采集与后台审核。")],-1)),s("div",ys,[s("button",{type:"button",class:"btn btn--ghost",onClick:ss,disabled:q.value||ie.value},r(ie.value?"导出中…":"导出到导出中心"),9,hs),s("button",{type:"button",class:"btn",onClick:Ne,disabled:q.value},"新建任务",8,gs)])]),s("form",{class:"tasks__filters",onSubmit:fs(Ee,["prevent"])},[s("div",ws,[s("label",Vs,[e[34]||(e[34]=s("span",null,"状态",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[0]||(e[0]=t=>u.status=t)},[e[33]||(e[33]=s("option",{value:""},"全部",-1)),(n(),o(S,null,T(b,t=>s("option",{key:t.value,value:t.value},r(t.label),9,Cs)),64))],512),[[F,u.status]])]),s("label",Us,[e[36]||(e[36]=s("span",null,"表单 DSL",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[1]||(e[1]=t=>u.form_dsl_id=t)},[e[35]||(e[35]=s("option",{value:""},"全部",-1)),(n(),o(S,null,T(V,t=>s("option",{key:t.value,value:t.value},r(t.label),9,Ss)),64))],512),[[F,u.form_dsl_id]])]),s("label",Ts,[e[38]||(e[38]=s("span",null,"风控模板",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[2]||(e[2]=t=>u.risk_policy_id=t)},[e[37]||(e[37]=s("option",{value:""},"全部",-1)),(n(),o(S,null,T(L,t=>s("option",{key:t.value,value:t.value},r(t.label),9,xs)),64))],512),[[F,u.risk_policy_id]])]),s("label",$s,[e[40]||(e[40]=s("span",null,"可见角色",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[3]||(e[3]=t=>u.role=t)},[e[39]||(e[39]=s("option",{value:""},"全部",-1)),(n(),o(S,null,T(X,t=>s("option",{key:t.value,value:t.value},r(t.label),9,Ds)),64))],512),[[F,u.role]])]),s("label",Os,[e[41]||(e[41]=s("span",null,"关键词",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>u.keyword=t),placeholder:"名称 / 任务码"},null,512),[[m,u.keyword,void 0,{trim:!0}]])]),s("label",Rs,[e[43]||(e[43]=s("span",null,"排序字段",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[5]||(e[5]=t=>u.sort_key=t)},[...e[42]||(e[42]=[s("option",{value:"start_time"},"开始时间",-1),s("option",{value:"end_time"},"结束时间",-1),s("option",{value:"name"},"名称",-1),s("option",{value:"version"},"版本",-1)])],512),[[F,u.sort_key]])]),s("label",Es,[e[45]||(e[45]=s("span",null,"排序方向",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[6]||(e[6]=t=>u.sort_order=t)},[...e[44]||(e[44]=[s("option",{value:"desc"},"降序",-1),s("option",{value:"asc"},"升序",-1)])],512),[[F,u.sort_order]])])]),s("div",Fs,[s("button",{type:"submit",class:"btn",disabled:q.value},"应用筛选",8,Ls),s("button",{type:"button",class:"btn btn--ghost",onClick:Fe,disabled:q.value},"重置",8,Ms)])],32),s("div",Ns,[s("table",null,[e[48]||(e[48]=s("thead",null,[s("tr",null,[s("th",null,"任务名称"),s("th",null,"任务码"),s("th",null,"状态"),s("th",null,"版本"),s("th",null,"表单 DSL"),s("th",null,"风控模板"),s("th",null,"有效期"),s("th",{class:"col-actions"},"操作")])],-1)),q.value?(n(),o("tbody",Ps,[(n(),o(S,null,T(4,t=>s("tr",{key:`loading-${t}`},[...e[46]||(e[46]=[s("td",{colspan:8,class:"table-skeleton"},null,-1)])])),64))])):ue.value.length?(n(),o("tbody",zs,[(n(!0),o(S,null,T(ue.value,t=>(n(),o("tr",{key:t.task_id},[s("td",null,[s("button",{type:"button",class:"link-btn",onClick:v=>Pe(t)},r(t.name),9,Is)]),s("td",null,r(t.code),1),s("td",null,[s("span",{class:"status-tag","data-status":t.status},r(ye(t.status)),9,As)]),s("td",null,r(t.version),1),s("td",null,r(t.form_dsl_id),1),s("td",null,r(t.risk_policy_id||"-"),1),s("td",null,r(us(t.start_time,t.end_time)),1),s("td",qs,[s("div",js,[s("button",{type:"button",class:"link-btn",onClick:v=>ze(t),disabled:!pe(t.status)},"编辑",8,Bs),s("button",{type:"button",class:"link-btn",onClick:v=>We(t),disabled:!fe(t.status)||C.value},"发布",8,Js),s("button",{type:"button",class:"link-btn",onClick:v=>Qe(t),disabled:t.status!=="published"||C.value},"下架",8,Zs),s("button",{type:"button",class:"link-btn",onClick:v=>$e(t),disabled:C.value},"复制",8,Gs)])])]))),128))])):(n(),o("tbody",Hs,[...e[47]||(e[47]=[s("tr",null,[s("td",{colspan:8,class:"empty"},"暂无符合条件的任务")],-1)])]))])]),de.value>1?(n(),o("footer",Ws,[s("button",{type:"button",class:"btn btn--ghost",disabled:u.page<=1||q.value,onClick:e[7]||(e[7]=t=>he(u.page-1))},"上一页",8,Ks),s("span",null,"第 "+r(u.page)+" / "+r(de.value)+" 页",1),s("button",{type:"button",class:"btn btn--ghost",disabled:u.page>=de.value||q.value,onClick:e[8]||(e[8]=t=>he(u.page+1))},"下一页",8,Qs),s("label",Xs,[e[49]||(e[49]=s("span",null,"每页",-1)),s("select",{class:"input",value:u.page_size,onChange:e[9]||(e[9]=t=>Le(t))},[(n(),o(S,null,T(Oe,t=>s("option",{key:t,value:t},r(t),9,el)),64))],40,Ys)]),s("span",null,"共 "+r(ve.value)+" 条",1)])):k("",!0),w.value?(n(),o("p",sl,r(w.value),1)):O.value?(n(),o("p",ll,r(O.value),1)):k("",!0),H.value?(n(),o("div",tl,[s("div",{class:"tasks-drawer__backdrop",onClick:be}),s("aside",al,[s("header",ol,[s("div",nl,[s("h2",null,r(Re.value),1),s("span",{class:"status-tag","data-status":D.value},r(ye(D.value)),9,il)]),s("div",rl,[x.value!=="view"?(n(),o("button",{key:0,type:"button",class:"btn btn--ghost",onClick:He,disabled:Y.value||C.value},r(_e.value?"校验中…":"校验配置"),9,dl)):k("",!0),x.value==="view"&&pe(D.value)?(n(),o("button",{key:1,type:"button",class:"btn btn--ghost",onClick:Ie},"编辑草稿")):k("",!0),x.value!=="create"&&fe(D.value)?(n(),o("button",{key:2,type:"button",class:"btn",onClick:Ke,disabled:C.value},r(C.value?"发布中…":"发布"),9,ul)):k("",!0),x.value!=="create"&&D.value==="published"?(n(),o("button",{key:3,type:"button",class:"btn btn--ghost",onClick:Xe,disabled:C.value},"下架",8,vl)):k("",!0),x.value!=="create"?(n(),o("button",{key:4,type:"button",class:"btn btn--ghost",onClick:es,disabled:C.value},"复制",8,_l)):k("",!0),s("button",{type:"button",class:"btn btn--ghost",onClick:be},"关闭")])]),s("nav",cl,[(n(),o(S,null,T(Z,(t,v)=>s("button",{key:t.key,type:"button",class:"drawer-step","data-active":v===$.value,disabled:!Ve(v),onClick:f=>je(v)},[s("span",fl,r(v+1),1),s("span",null,r(t.label),1)],8,pl)),64))]),s("section",bl,[ee.value.key==="basic"?(n(),o("div",ml,[s("div",kl,[s("label",{class:"form-field","data-error":p.name},[e[50]||(e[50]=s("span",null,[j("任务名称"),s("em",null,"*")],-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":e[10]||(e[10]=t=>l.name=t),disabled:i.value,placeholder:"2-40 字"},null,8,hl),[[m,l.name,void 0,{trim:!0}]]),p.name?(n(),o("span",gl,r(p.name),1)):k("",!0)],8,yl),s("label",{class:"form-field","data-error":p.code},[e[51]||(e[51]=s("span",null,[j("任务码"),s("em",null,"*")],-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":e[11]||(e[11]=t=>l.code=t),disabled:i.value,placeholder:"大写字母数字"},null,8,Vl),[[m,l.code]]),p.code?(n(),o("span",Cl,r(p.code),1)):k("",!0)],8,wl),s("label",{class:"form-field form-field--full","data-error":p.desc},[e[52]||(e[52]=s("span",null,"任务描述",-1)),d(s("textarea",{class:"textarea",rows:"3","onUpdate:modelValue":e[12]||(e[12]=t=>l.desc=t),disabled:i.value,placeholder:"不超过 200 字"},null,8,Sl),[[m,l.desc,void 0,{trim:!0}]])],8,Ul),s("label",{class:"form-field","data-error":p.start_time},[e[53]||(e[53]=s("span",null,[j("开始时间"),s("em",null,"*")],-1)),d(s("input",{class:"input",type:"datetime-local","onUpdate:modelValue":e[13]||(e[13]=t=>l.start_time=t),disabled:i.value},null,8,xl),[[m,l.start_time]]),p.start_time?(n(),o("span",$l,r(p.start_time),1)):k("",!0)],8,Tl),s("label",{class:"form-field","data-error":p.end_time},[e[54]||(e[54]=s("span",null,[j("结束时间"),s("em",null,"*")],-1)),d(s("input",{class:"input",type:"datetime-local","onUpdate:modelValue":e[14]||(e[14]=t=>l.end_time=t),disabled:i.value},null,8,Ol),[[m,l.end_time]]),p.end_time?(n(),o("span",Rl,r(p.end_time),1)):k("",!0)],8,Dl),s("fieldset",El,[e[55]||(e[55]=s("legend",null,"可见角色",-1)),s("div",Fl,[(n(),o(S,null,T(X,t=>s("label",{key:t.value},[d(s("input",{type:"checkbox",value:t.value,"onUpdate:modelValue":e[15]||(e[15]=v=>l.visible_to_roles=v),disabled:i.value},null,8,Ll),[[Q,l.visible_to_roles]]),j(" "+r(t.label),1)])),64))])]),s("fieldset",{class:"form-field form-field--full","data-error":W.value},[e[59]||(e[59]=s("legend",null,"适用范围",-1)),s("div",Nl,[s("div",null,[e[56]||(e[56]=s("strong",null,"公司",-1)),s("div",Pl,[(n(),o(S,null,T(oe,t=>s("label",{key:t},[d(s("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[16]||(e[16]=v=>l.scope.companies=v),disabled:i.value},null,8,zl),[[Q,l.scope.companies]]),j(" "+r(t),1)])),64))])]),s("div",null,[e[57]||(e[57]=s("strong",null,"城市",-1)),s("div",Il,[(n(),o(S,null,T(ne,t=>s("label",{key:t.value},[d(s("input",{type:"checkbox",value:t.value,"onUpdate:modelValue":e[17]||(e[17]=v=>l.scope.cities=v),disabled:i.value},null,8,Al),[[Q,l.scope.cities]]),j(" "+r(t.label),1)])),64))])]),s("div",null,[e[58]||(e[58]=s("strong",null,"门店",-1)),s("div",ql,[(n(),o(S,null,T(M,t=>s("label",{key:t.value},[d(s("input",{type:"checkbox",value:t.value,"onUpdate:modelValue":e[18]||(e[18]=v=>l.scope.stores=v),disabled:i.value},null,8,jl),[[Q,l.scope.stores]]),j(" "+r(t.label),1)])),64))])])]),W.value?(n(),o("span",Bl,r(W.value),1)):k("",!0)],8,Ml)])])):ee.value.key==="dsl"?(n(),o("div",Jl,[s("div",Zl,[s("label",{class:"form-field","data-error":E.form_dsl_id},[e[61]||(e[61]=s("span",null,[j("绑定表单 DSL"),s("em",null,"*")],-1)),d(s("select",{class:"input","onUpdate:modelValue":e[19]||(e[19]=t=>l.form_dsl_id=t),disabled:i.value},[e[60]||(e[60]=s("option",{value:""},"请选择",-1)),(n(),o(S,null,T(V,t=>s("option",{key:t.value,value:t.value},r(t.label),9,Wl)),64))],8,Hl),[[F,l.form_dsl_id]]),E.form_dsl_id?(n(),o("span",Kl,r(E.form_dsl_id),1)):k("",!0)],8,Gl),s("label",Ql,[e[62]||(e[62]=s("span",null,"DSL 版本",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":e[20]||(e[20]=t=>l.form_dsl.schema_version=t),disabled:i.value,placeholder:"例如 1.4.2"},null,8,Xl),[[m,l.form_dsl.schema_version,void 0,{trim:!0}]])])]),s("div",Yl,[e[63]||(e[63]=s("h3",null,"字段映射",-1)),s("button",{type:"button",class:"btn btn--ghost",onClick:ts,disabled:i.value},"新增映射",8,et)]),E.fields_map?(n(),o("p",st,r(E.fields_map),1)):k("",!0),l.form_dsl.fields_map.length?k("",!0):(n(),o("div",lt,"尚未配置字段映射。")),(n(!0),o(S,null,T(l.form_dsl.fields_map,(t,v)=>{var f,B,J,se,le;return n(),o("div",{key:v,class:"mapping-row"},[s("label",tt,[e[64]||(e[64]=s("span",null,"DSL 字段",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":y=>t.dsl_key=y,disabled:i.value,placeholder:"dsl_key"},null,8,at),[[m,t.dsl_key,void 0,{trim:!0}]])]),s("label",ot,[e[65]||(e[65]=s("span",null,"业务字段",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":y=>t.biz_key=y,disabled:i.value,placeholder:"biz_key"},null,8,nt),[[m,t.biz_key,void 0,{trim:!0}]])]),s("label",it,[d(s("input",{type:"checkbox","onUpdate:modelValue":y=>t.required=y,disabled:i.value},null,8,rt),[[Q,t.required]]),e[66]||(e[66]=s("span",null,"必填",-1))]),s("label",dt,[e[68]||(e[68]=s("span",null,"校验规则",-1)),s("select",{class:"input",value:((f=t.validation)==null?void 0:f.type)||"",disabled:i.value,onChange:y=>os(v,y)},[...e[67]||(e[67]=[s("option",{value:""},"无",-1),s("option",{value:"regex"},"正则",-1),s("option",{value:"enum"},"枚举",-1),s("option",{value:"range"},"范围",-1)])],40,ut)]),((B=t.validation)==null?void 0:B.type)==="regex"||((J=t.validation)==null?void 0:J.type)==="enum"?(n(),o("label",vt,[s("span",null,r(((se=t.validation)==null?void 0:se.type)==="regex"?"正则表达式":"枚举列表"),1),d(s("input",{class:"input",type:"text","onUpdate:modelValue":y=>t.validation.value=y,disabled:i.value,placeholder:"如 ^\\\\d+$ 或 A,B,C"},null,8,_t),[[m,t.validation.value,void 0,{trim:!0}]])])):((le=t.validation)==null?void 0:le.type)==="range"?(n(),o("div",ct,[s("label",pt,[e[69]||(e[69]=s("span",null,"最小值",-1)),d(s("input",{class:"input",type:"number","onUpdate:modelValue":y=>t.validation.min=y,disabled:i.value},null,8,ft),[[m,t.validation.min,void 0,{number:!0}]])]),s("label",bt,[e[70]||(e[70]=s("span",null,"最大值",-1)),d(s("input",{class:"input",type:"number","onUpdate:modelValue":y=>t.validation.max=y,disabled:i.value},null,8,mt),[[m,t.validation.max,void 0,{number:!0}]])])])):k("",!0),s("button",{type:"button",class:"link-btn",onClick:y=>as(v),disabled:i.value},"移除",8,kt)])}),128))])):ee.value.key==="rules"?(n(),o("div",yt,[s("div",ht,[e[71]||(e[71]=s("h3",null,"自动校验",-1)),s("button",{type:"button",class:"btn btn--ghost",onClick:ns,disabled:i.value},"新增校验",8,gt)]),(_=l.review_rules.auto_checks)!=null&&_.length?k("",!0):(n(),o("div",wt,"暂无自动校验规则。")),(n(!0),o(S,null,T(l.review_rules.auto_checks,(t,v)=>(n(),o("section",{key:v,class:"rule-block"},[s("label",Vt,[e[72]||(e[72]=s("span",null,"字段",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.key=f,disabled:i.value,placeholder:"如 id_number"},null,8,Ct),[[m,t.key,void 0,{trim:!0}]])]),s("label",Ut,[e[73]||(e[73]=s("span",null,"规则",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.rule=f,disabled:i.value,placeholder:"如 regex_cn_id"},null,8,St),[[m,t.rule,void 0,{trim:!0}]])]),s("label",Tt,[e[75]||(e[75]=s("span",null,"级别",-1)),d(s("select",{class:"input","onUpdate:modelValue":f=>t.level=f,disabled:i.value},[...e[74]||(e[74]=[s("option",{value:"error"},"错误",-1),s("option",{value:"warn"},"提醒",-1)])],8,xt),[[F,t.level]])]),s("label",$t,[e[76]||(e[76]=s("span",null,"提示",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.message=f,disabled:i.value,placeholder:"提示信息"},null,8,Dt),[[m,t.message,void 0,{trim:!0}]])]),s("button",{type:"button",class:"link-btn",onClick:f=>is(v),disabled:i.value},"移除",8,Ot)]))),128)),s("div",Rt,[e[77]||(e[77]=s("h3",null,"阈值策略",-1)),s("button",{type:"button",class:"btn btn--ghost",onClick:rs,disabled:i.value},"新增阈值",8,Et)]),(g=l.review_rules.thresholds)!=null&&g.length?k("",!0):(n(),o("div",Ft,"暂无阈值策略。")),(n(!0),o(S,null,T(l.review_rules.thresholds,(t,v)=>(n(),o("section",{key:v,class:"rule-block"},[s("label",Lt,[e[78]||(e[78]=s("span",null,"字段",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.key=f,disabled:i.value,placeholder:"如 amount"},null,8,Mt),[[m,t.key,void 0,{trim:!0}]])]),s("label",Nt,[e[79]||(e[79]=s("span",null,"比较符",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.op=f,disabled:i.value,placeholder:">="},null,8,Pt),[[m,t.op,void 0,{trim:!0}]])]),s("label",zt,[e[80]||(e[80]=s("span",null,"阈值",-1)),d(s("input",{class:"input",type:"number","onUpdate:modelValue":f=>t.value=f,disabled:i.value},null,8,It),[[m,t.value,void 0,{number:!0}]])]),s("label",At,[e[81]||(e[81]=s("span",null,"动作",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":f=>t.action=f,disabled:i.value,placeholder:"如 manual_review"},null,8,qt),[[m,t.action,void 0,{trim:!0}]])]),s("button",{type:"button",class:"link-btn",onClick:f=>ds(v),disabled:i.value},"移除",8,jt)]))),128)),s("div",Bt,[s("label",Jt,[e[82]||(e[82]=s("span",null,"抽审比例 %",-1)),d(s("input",{class:"input",type:"number",min:"0",max:"100","onUpdate:modelValue":e[21]||(e[21]=t=>l.review_rules.sampling.percent=t),disabled:i.value},null,8,Zt),[[m,l.review_rules.sampling.percent,void 0,{number:!0}]])]),s("label",Gt,[e[83]||(e[83]=s("span",null,"抽审种子",-1)),d(s("input",{class:"input",type:"text","onUpdate:modelValue":e[22]||(e[22]=t=>l.review_rules.sampling.seed=t),disabled:i.value,placeholder:"可选"},null,8,Ht),[[m,l.review_rules.sampling.seed,void 0,{trim:!0}]])]),s("label",Wt,[d(s("input",{type:"checkbox","onUpdate:modelValue":e[23]||(e[23]=t=>l.review_rules.double_review=t),disabled:i.value},null,8,Kt),[[Q,l.review_rules.double_review]]),e[84]||(e[84]=s("span",null,"启用双人复核",-1))]),s("label",Qt,[e[85]||(e[85]=s("span",null,"审核 SLA (分钟)",-1)),d(s("input",{class:"input",type:"number",min:"0","onUpdate:modelValue":e[24]||(e[24]=t=>l.review_rules.sla=t),disabled:i.value},null,8,Xt),[[m,l.review_rules.sla,void 0,{number:!0}]])])])])):ee.value.key==="risk"?(n(),o("div",Yt,[s("div",ea,[s("label",sa,[e[87]||(e[87]=s("span",null,"风控模板",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[25]||(e[25]=t=>l.risk_policy_id=t),disabled:i.value},[e[86]||(e[86]=s("option",{value:""},"未绑定",-1)),(n(),o(S,null,T(L,t=>s("option",{key:t.value,value:t.value},r(t.label),9,ta)),64))],8,la),[[F,l.risk_policy_id]])]),s("label",aa,[e[89]||(e[89]=s("span",null,"命中动作",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[26]||(e[26]=t=>l.risk_action=t),disabled:i.value},[...e[88]||(e[88]=[s("option",{value:"queue"},"进入工单",-1),s("option",{value:"block"},"拦截提交",-1),s("option",{value:"flag"},"仅标记",-1)])],8,oa),[[F,l.risk_action]])])])])):ee.value.key==="flow"?(n(),o("div",na,[s("label",ia,[e[91]||(e[91]=s("span",null,"流程模式",-1)),d(s("select",{class:"input","onUpdate:modelValue":e[27]||(e[27]=t=>l.release.mode=t),disabled:i.value},[...e[90]||(e[90]=[s("option",{value:"immediate"},"立即发布",-1),s("option",{value:"scheduled"},"定时发布",-1),s("option",{value:"gray"},"灰度发布",-1)])],8,ra),[[F,l.release.mode]])]),l.release.mode==="scheduled"?(n(),o("label",da,[e[92]||(e[92]=s("span",null,"定时发布时间",-1)),d(s("input",{class:"input",type:"datetime-local","onUpdate:modelValue":e[28]||(e[28]=t=>ke.value=t),disabled:i.value},null,8,ua),[[m,ke.value]])])):k("",!0),l.release.mode==="gray"?(n(),o("label",va,[e[93]||(e[93]=s("span",null,"灰度比例 %",-1)),d(s("input",{class:"input",type:"number",min:"0",max:"100","onUpdate:modelValue":e[29]||(e[29]=t=>l.release.gray_percent=t),disabled:i.value},null,8,_a),[[m,l.release.gray_percent,void 0,{number:!0}]])])):k("",!0),s("label",ca,[e[94]||(e[94]=s("span",null,"回滚版本",-1)),d(s("input",{class:"input",type:"number",min:"0","onUpdate:modelValue":e[30]||(e[30]=t=>l.release.rollback_to_version=t),disabled:i.value,placeholder:"可选"},null,8,pa),[[m,l.release.rollback_to_version,void 0,{number:!0}]])]),K.value?(n(),o("p",fa,r(K.value),1)):k("",!0)])):(n(),o("div",ba,[s("div",ma,[e[95]||(e[95]=s("h3",null,"版本日志",-1)),s("button",{type:"button",class:"btn btn--ghost",onClick:ls,disabled:!h.value||re.value},"刷新",8,ka)]),re.value?(n(),o("div",ya,"版本数据加载中…")):(n(),o("ul",ha,[(n(!0),o(S,null,T(G.items,t=>(n(),o("li",{key:t.version,class:"version-item"},[s("header",null,[s("strong",null,"V"+r(t.version),1),s("span",null,r(vs(t.time)),1),s("span",null,r(t.operator),1)]),s("p",null,r(t.changelog),1),t.diff?(n(),o("pre",ga,r(_s(t.diff)),1)):k("",!0)]))),128))]))]))]),s("footer",wa,[s("button",{type:"button",class:"btn btn--ghost",onClick:be},"取消"),s("button",{type:"button",class:"btn btn--ghost",onClick:qe,disabled:$.value===0},"上一步",8,Va),$.value<Z.length-1?(n(),o("button",{key:0,type:"button",class:"btn",onClick:Ae,disabled:i.value}," 下一步 ",8,Ca)):(n(),o("button",{key:1,type:"button",class:"btn",onClick:Te,disabled:Y.value||i.value},r(Y.value?"保存中…":"保存草稿"),9,Ua))])])])):k("",!0),a.offlineModalVisible?(n(),o("div",Sa,[s("div",{class:"offline-modal__backdrop",onClick:xe}),s("div",Ta,[e[97]||(e[97]=s("header",null,[s("h3",null,"下架原因")],-1)),s("section",null,[e[96]||(e[96]=s("p",null,"请说明下架原因，以便留存记录。",-1)),d(s("textarea",{class:"textarea",rows:"4","onUpdate:modelValue":e[31]||(e[31]=t=>a.offlineReason=t),placeholder:"不少于 5 个字"},null,512),[[m,a.offlineReason,void 0,{trim:!0}]]),a.offlineError?(n(),o("p",xa,r(a.offlineError),1)):k("",!0)]),s("footer",null,[s("button",{type:"button",class:"btn btn--ghost",onClick:xe},"取消"),s("button",{type:"button",class:"btn",onClick:Ye,disabled:C.value},r(C.value?"提交中…":"确认下架"),9,$a)])])])):k("",!0)])}}}),Ra=bs(Da,[["__scopeId","data-v-84ace26d"]]);export{Ra as default};
